(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7938],{6394:function(e,t,n){Promise.resolve().then(n.bind(n,3618))},3618:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var s=n(7437),r=n(2265),i=n(5854),l=n(4631),a=n(5139);let c={summary:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return(0,a.S)("/hotel/billing/summary?limit=".concat(e))}};function o(){var e;let[t,n]=(0,r.useState)(null),[a,o]=(0,r.useState)(!0),[u,d]=(0,r.useState)(null),h=async()=>{o(!0),d(null);try{let e=await c.summary(20);n(e)}catch(e){d(e instanceof Error?e.message:"Failed to load billing summary")}finally{o(!1)}};return(0,r.useEffect)(()=>{h()},[]),(0,s.jsx)(i.n,{permission:"hotel:billing:read",fallback:(0,s.jsxs)(l.W,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have permission to view billing."})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Subscription & Billing"}),(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Review plan details, subscription status, and invoices."})]}),a?(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Loading billing summary..."}):(0,s.jsxs)(s.Fragment,{children:[u&&(0,s.jsx)("p",{className:"text-sm text-red-400",children:u}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)(l.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Current Plan"}),(null==t?void 0:t.plan)?(0,s.jsxs)("div",{className:"mt-4 space-y-2 text-sm",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:"Name:"})," ",t.plan.name]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:"Code:"})," ",t.plan.code]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:"Price:"})," ",(t.plan.price_cents/100).toFixed(2)," ",t.plan.currency," /",t.plan.billing_interval]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:"Status:"})," ",t.plan.is_active?"Active":"Inactive"]})]}):(0,s.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No plan assigned yet."})]}),(0,s.jsxs)(l.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Subscription"}),(null==t?void 0:t.subscription)?(0,s.jsxs)("div",{className:"mt-4 space-y-2 text-sm",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:"Status:"})," ",t.subscription.status]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:"Period Start:"})," ",t.subscription.current_period_start?new Date(t.subscription.current_period_start).toLocaleDateString():"-"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:"Period End:"})," ",t.subscription.current_period_end?new Date(t.subscription.current_period_end).toLocaleDateString():"-"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:"Cancel At:"})," ",t.subscription.cancel_at?new Date(t.subscription.cancel_at).toLocaleDateString():"-"]})]}):(0,s.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No subscription data available."})]})]}),(0,s.jsxs)(l.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Invoices"}),(null==t?void 0:null===(e=t.invoices)||void 0===e?void 0:e.length)?(0,s.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"text-left text-[color:var(--muted)]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"pb-3",children:"Invoice"}),(0,s.jsx)("th",{className:"pb-3",children:"Status"}),(0,s.jsx)("th",{className:"pb-3",children:"Amount"}),(0,s.jsx)("th",{className:"pb-3",children:"Issued"}),(0,s.jsx)("th",{className:"pb-3",children:"Due"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/10",children:t.invoices.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-3 font-medium",children:e.invoice_number}),(0,s.jsx)("td",{className:"py-3",children:e.status}),(0,s.jsxs)("td",{className:"py-3",children:[(e.amount_cents/100).toFixed(2)," ",e.currency]}),(0,s.jsx)("td",{className:"py-3",children:e.issued_at?new Date(e.issued_at).toLocaleDateString():"-"}),(0,s.jsx)("td",{className:"py-3",children:e.due_at?new Date(e.due_at).toLocaleDateString():"-"})]},e.id))})]})}):(0,s.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No invoices yet."})]})]})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return i},E:function(){return l}});var s=n(7437),r=n(3301);function i(e){let{permission:t,children:n,fallback:i=null}=e,{permissions:l,loading:a}=(0,r.a)();return a?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let s=0;s<e.length;s+=1)if("*"!==e[s]&&e[s]!==n[s]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(l,t)?(0,s.jsx)(s.Fragment,{children:i}):(0,s.jsx)(s.Fragment,{children:n})}function l(e){let{userType:t,children:n,fallback:i=null}=e,{user:l,loading:a}=(0,r.a)();return a?null:l&&l.user_type===t?(0,s.jsx)(s.Fragment,{children:n}):(0,s.jsx)("div",{className:"auth-layout",children:(0,s.jsxs)("div",{className:"glass-card auth-card",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),i]})})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return c},E:function(){return o}});var s=n(7437),r=n(2265),i=n(5139);let l={login:(e,t)=>(0,i.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,i.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,i.S)("/auth/logout",{method:"POST"}),me:()=>(0,i.S)("/auth/me"),startImpersonation:e=>(0,i.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,i.S)("/auth/impersonation/stop",{method:"POST"})},a=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[n,i]=(0,r.useState)(null),[c,o]=(0,r.useState)([]),[u,d]=(0,r.useState)(null),[h,m]=(0,r.useState)(null),[p,f]=(0,r.useState)(!0),x=(0,r.useCallback)(e=>{var t,n;i(e.user),o(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),m(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),v=(0,r.useCallback)(async()=>{try{let e=await l.me();x(e)}catch(e){try{let e=await l.refresh();x(e)}catch(e){i(null),o([]),d(null),m(null)}}finally{f(!1)}},[x]);(0,r.useEffect)(()=>{v()},[v]);let j=(0,r.useCallback)(async(e,t)=>{let n=await l.login(e,t);return x(n),n},[x]),g=(0,r.useCallback)(async()=>{await l.logout(),i(null),o([]),d(null),m(null)},[]),y=(0,r.useCallback)(async()=>{x(await l.refresh())},[x]),N=(0,r.useCallback)(async e=>{let t=await l.startImpersonation(e);return x(t),t},[x]),b=(0,r.useCallback)(async()=>{let e=await l.stopImpersonation();return x(e),e},[x]),w=(0,r.useMemo)(()=>({user:n,permissions:c,tenant:u,impersonation:h,loading:p,login:j,logout:g,refresh:y,startImpersonation:N,stopImpersonation:b}),[n,c,u,h,p,j,g,y,N,b]);return(0,s.jsx)(a.Provider,{value:w,children:t})}function o(){let e=(0,r.useContext)(a);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return i}});var s=n(7437),r=n(4839);function i(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("glass-card",n),children:t})}},5139:function(e,t,n){"use strict";var s;n.d(t,{S:function(){return i}});let r=null!==(s=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api";async function i(e){var t,n,s;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l="".concat(r).concat(e),a=new Headers(null!==(n=i.headers)&&void 0!==n?n:{}),c=null!==(s=null===(t=i.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==s?s:"GET";if("GET"!==c&&"HEAD"!==c){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&a.set("X-CSRF-Token",e),a.has("Content-Type")||a.set("Content-Type","application/json")}let o=await fetch(l,{...i,headers:a,credentials:"include"});if(!o.ok)throw Error(await o.text()||o.statusText);if(204===o.status)return;let u=await o.text();if(u)return JSON.parse(u)}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var s=n(1288);function r(){return(0,s.E)()}},357:function(e,t,n){"use strict";var s,r;e.exports=(null==(s=n.g.process)?void 0:s.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,s,r=e.exports={};function i(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:l}catch(e){n=l}}();var c=[],o=!1,u=-1;function d(){o&&s&&(o=!1,s.length?c=s.concat(c):u=-1,c.length&&h())}function h(){if(!o){var e=a(d);o=!0;for(var t=c.length;t;){for(s=c,c=[];++u<t;)s&&s[u].run();u=-1,t=c.length}s=null,o=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===l||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new m(e,t)),1!==c.length||o||a(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}},l=!0;try{t[e](i,i.exports,s),l=!1}finally{l&&delete n[e]}return i.exports}s.ab="//";var r=s(229);e.exports=r}()},4839:function(e,t,n){"use strict";t.Z=function(){for(var e,t,n=0,s="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=function e(t){var n,s,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t){if(Array.isArray(t)){var i=t.length;for(n=0;n<i;n++)t[n]&&(s=e(t[n]))&&(r&&(r+=" "),r+=s)}else for(s in t)t[s]&&(r&&(r+=" "),r+=s)}return r}(e))&&(s&&(s+=" "),s+=t);return s}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=6394)}),_N_E=e.O()}]);