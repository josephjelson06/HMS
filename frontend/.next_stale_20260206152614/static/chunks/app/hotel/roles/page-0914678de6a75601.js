(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2259],{6450:function(e,t,n){Promise.resolve().then(n.bind(n,1750))},1750:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var s=n(7437),r=n(7138),l=n(2265),i=n(5854),a=n(2145),o=n(6572),c=n(6053),u=n(22),d=n(4024),h=n(5205),m=n(4631),f=n(5427),x=n(8802);function p(){let[e,t]=(0,l.useState)([]),[n,p]=(0,l.useState)(!0),[j,v]=(0,l.useState)(null),y=(0,l.useCallback)(async()=>{p(!0),v(null);try{let e=await x.X.list();t(e)}catch(e){v(e instanceof Error?e.message:"Failed to load roles")}finally{p(!1)}},[]);(0,l.useEffect)(()=>{y()},[y]);let g=async e=>{if(e.is_system){v("System roles cannot be deleted");return}if(confirm("Delete ".concat(e.display_name,"? This cannot be undone.")))try{await x.X.remove(e.id),await y()}catch(e){v(e instanceof Error?e.message:"Failed to delete role")}};return(0,s.jsx)(i.n,{permission:"hotel:roles:read",fallback:(0,s.jsxs)(m.W,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view hotel roles."})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(a.m,{title:"Hotel Roles",description:"Manage hotel role definitions and open matrix editor for permissions.",count:e.length,countLabel:"Roles",rightSlot:(0,s.jsx)(i.n,{permission:"hotel:roles:create",children:(0,s.jsx)(r.default,{href:"/hotel/roles/new",className:"ui-btn ui-btn-primary ui-btn-sm ui-anim",children:"Add Role"})})}),j?(0,s.jsx)(d.o,{tone:"error",message:j}):null,n?(0,s.jsx)(d.o,{tone:"info",message:"Loading roles..."}):0===e.length?(0,s.jsx)(u.u,{description:"No roles created yet."}):(0,s.jsx)(c.r,{title:"Role Directory",table:(0,s.jsx)(o.w,{columns:[{key:"role",header:"Role",cellClassName:"font-medium",render:e=>e.display_name},{key:"key",header:"Key",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>e.name},{key:"system",header:"System",render:e=>e.is_system?"Yes":"No"},{key:"permissions",header:"Permissions",render:e=>e.permissions.length},{key:"actions",header:"Actions",render:e=>(0,s.jsxs)(h.l,{children:[(0,s.jsx)(i.n,{permission:"hotel:roles:update",children:(0,s.jsx)(r.default,{href:"/hotel/roles/".concat(e.id),className:"ui-btn ui-btn-outline ui-btn-sm ui-anim",children:e.is_system?"View":"Edit"})}),(0,s.jsx)(i.n,{permission:"hotel:roles:delete",children:(0,s.jsx)(f.z,{size:"sm",variant:"danger",onClick:()=>void g(e),disabled:e.is_system,children:"Delete"})})]})}],rows:e,rowKey:e=>e.id})})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return l},E:function(){return i}});var s=n(7437),r=n(3301);function l(e){let{permission:t,children:n,fallback:l=null}=e,{permissions:i,loading:a}=(0,r.a)();return a?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let s=0;s<e.length;s+=1)if("*"!==e[s]&&e[s]!==n[s]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(i,t)?(0,s.jsx)(s.Fragment,{children:l}):(0,s.jsx)(s.Fragment,{children:n})}function i(e){let{userType:t,children:n,fallback:l=null}=e,{user:i,loading:a}=(0,r.a)();return a?null:i&&i.user_type===t?(0,s.jsx)(s.Fragment,{children:n}):(0,s.jsx)("div",{className:"auth-layout",children:(0,s.jsxs)("div",{className:"glass-card auth-card",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),l]})})}},2145:function(e,t,n){"use strict";n.d(t,{m:function(){return i}});var s=n(7437),r=n(4839),l=n(7282);function i(e){let{title:t,description:n,rightSlot:i,count:a,countLabel:o,className:c}=e;return(0,s.jsxs)("div",{className:(0,r.Z)("ui-page-header",c),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"ui-page-title",children:t}),n?(0,s.jsx)("p",{className:"ui-page-subtitle",children:n}):null]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["number"==typeof a?(0,s.jsxs)(l.C,{variant:"accent",children:[a,o?" ".concat(o):""]}):null,i]})]})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return o},E:function(){return c}});var s=n(7437),r=n(2265),l=n(5139);let i={login:(e,t)=>(0,l.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,l.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,l.S)("/auth/logout",{method:"POST"}),me:()=>(0,l.S)("/auth/me"),startImpersonation:e=>(0,l.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,l.S)("/auth/impersonation/stop",{method:"POST"})},a=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[n,l]=(0,r.useState)(null),[o,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(null),[h,m]=(0,r.useState)(null),[f,x]=(0,r.useState)(!0),p=(0,r.useCallback)(e=>{var t,n;l(e.user),c(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),m(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),j=(0,r.useCallback)(async()=>{try{let e=await i.me();p(e)}catch(e){try{let e=await i.refresh();p(e)}catch(e){l(null),c([]),d(null),m(null)}}finally{x(!1)}},[p]);(0,r.useEffect)(()=>{j()},[j]);let v=(0,r.useCallback)(async(e,t)=>{let n=await i.login(e,t);return p(n),n},[p]),y=(0,r.useCallback)(async()=>{await i.logout(),l(null),c([]),d(null),m(null)},[]),g=(0,r.useCallback)(async()=>{p(await i.refresh())},[p]),N=(0,r.useCallback)(async e=>{let t=await i.startImpersonation(e);return p(t),t},[p]),b=(0,r.useCallback)(async()=>{let e=await i.stopImpersonation();return p(e),e},[p]),S=(0,r.useMemo)(()=>({user:n,permissions:o,tenant:u,impersonation:h,loading:f,login:v,logout:y,refresh:g,startImpersonation:N,stopImpersonation:b}),[n,o,u,h,f,v,y,g,N,b]);return(0,s.jsx)(a.Provider,{value:S,children:t})}function c(){let e=(0,r.useContext)(a);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},6572:function(e,t,n){"use strict";n.d(t,{w:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{columns:t,rows:n,rowKey:l,emptyFallback:i=null,className:a}=e;return 0===n.length?(0,s.jsx)(s.Fragment,{children:i}):(0,s.jsxs)("table",{className:(0,r.Z)("ui-table",a),children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:t.map(e=>(0,s.jsx)("th",{className:(0,r.Z)("pb-3",e.headerClassName),children:e.header},e.key))})}),(0,s.jsx)("tbody",{children:n.map((e,n)=>(0,s.jsx)("tr",{children:t.map(t=>(0,s.jsx)("td",{className:(0,r.Z)("py-3",t.cellClassName),children:t.render(e,n)},t.key))},l(e,n)))})]})}},6053:function(e,t,n){"use strict";n.d(t,{r:function(){return i}});var s=n(7437),r=n(6430),l=n(7606);function i(e){let{title:t,table:n,footer:i}=e;return(0,s.jsxs)(l.q,{title:t,children:[(0,s.jsx)(r.K,{children:n}),i?(0,s.jsx)("div",{className:"mt-3",children:i}):null]})}},22:function(e,t,n){"use strict";n.d(t,{u:function(){return l}});var s=n(7437),r=n(4631);function l(e){let{title:t="Nothing here yet",description:n}=e;return(0,s.jsxs)(r.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:t}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:n})]})}},4024:function(e,t,n){"use strict";n.d(t,{o:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{tone:t="info",message:n,className:l}=e;return(0,s.jsx)("p",{className:(0,r.Z)("ui-inline-alert","ui-inline-alert-".concat(t),l),children:n})}},6430:function(e,t,n){"use strict";n.d(t,{K:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("ui-table-wrap",n),children:t})}},7606:function(e,t,n){"use strict";n.d(t,{q:function(){return i}});var s=n(7437),r=n(4839),l=n(4631);function i(e){let{title:t,actions:n,children:i,className:a}=e;return(0,s.jsxs)(l.W,{className:(0,r.Z)("p-6 ui-reveal",a),children:[(t||n)&&(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t?(0,s.jsx)("h3",{className:"text-lg",children:t}):(0,s.jsx)("span",{}),n]}),(0,s.jsx)("div",{className:(0,r.Z)((t||n)&&"mt-4"),children:i})]})}},5205:function(e,t,n){"use strict";n.d(t,{l:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("flex flex-wrap gap-2",n),children:t})}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("glass-card",n),children:t})}},7282:function(e,t,n){"use strict";n.d(t,{C:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{variant:t="accent",className:n,children:l,...i}=e;return(0,s.jsx)("span",{className:(0,r.Z)("badge","badge-".concat(t),n),...i,children:l})}},5427:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{className:t,variant:n="secondary",size:l="md",children:i,...a}=e;return(0,s.jsx)("button",{className:(0,r.Z)("ui-btn ui-anim","ui-btn-".concat(n),"sm"===l&&"ui-btn-sm","md"===l&&"ui-btn-md","lg"===l&&"ui-btn-lg",t),...a,children:i})}},5139:function(e,t,n){"use strict";var s;n.d(t,{S:function(){return l}});let r=null!==(s=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api";async function l(e){var t,n,s;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="".concat(r).concat(e),a=new Headers(null!==(n=l.headers)&&void 0!==n?n:{}),o=null!==(s=null===(t=l.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==s?s:"GET";if("GET"!==o&&"HEAD"!==o){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&a.set("X-CSRF-Token",e),a.has("Content-Type")||a.set("Content-Type","application/json")}let c=await fetch(i,{...l,headers:a,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let u=await c.text();if(u)return JSON.parse(u)}},8802:function(e,t,n){"use strict";n.d(t,{X:function(){return r}});var s=n(5139);let r={list:()=>(0,s.S)("/hotel/roles"),get:e=>(0,s.S)("/hotel/roles/".concat(e)),create:e=>(0,s.S)("/hotel/roles",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,s.S)("/hotel/roles/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,s.S)("/hotel/roles/".concat(e),{method:"DELETE"}),permissions:()=>(0,s.S)("/hotel/roles/permissions")}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var s=n(1288);function r(){return(0,s.E)()}}},function(e){e.O(0,[3751,2971,7023,1744],function(){return e(e.s=6450)}),_N_E=e.O()}]);