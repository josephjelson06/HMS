(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5118],{7457:function(e,t,n){Promise.resolve().then(n.bind(n,5617))},5617:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var r=n(7437),i=n(2265),s=n(5854),a=n(2145),l=n(4862),o=n(6572),c=n(6053),u=n(22),d=n(4024),f=n(4631),h=n(5427),m=n(7032),x=n(6243),p=n(5139);let v={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.set("page",String(e.page)),e.limit&&t.set("limit",String(e.limit)),e.user_id&&t.set("user_id",e.user_id),e.action&&t.set("action",e.action),e.date_from&&t.set("date_from",e.date_from),e.date_to&&t.set("date_to",e.date_to);let n=t.toString();return(0,p.S)("/hotel/audit?".concat(n))}},g={action:"",user_id:"",date_from:"",date_to:""};function j(){let[e,t]=(0,i.useState)([]),[n,p]=(0,i.useState)(g),[j,y]=(0,i.useState)(!0),[b,N]=(0,i.useState)(null),_=(0,i.useCallback)(async e=>{y(!0),N(null);try{let n=await v.list({page:1,limit:50,action:e.action||void 0,user_id:e.user_id||void 0,date_from:e.date_from||void 0,date_to:e.date_to||void 0});t(n.items)}catch(e){N(e instanceof Error?e.message:"Failed to load audit logs")}finally{y(!1)}},[]);(0,i.useEffect)(()=>{_(g)},[_]);let w=(e,t)=>{p(n=>({...n,[e]:t}))},S=(0,i.useMemo)(()=>e.length>0,[e]);return(0,r.jsx)(s.n,{permission:"hotel:audit:read",fallback:(0,r.jsxs)(f.W,{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view audit logs."})]}),children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(a.m,{title:"Audit Logs",description:"Activity trail for your hotel operations.",count:e.length,countLabel:"Records"}),(0,r.jsx)(l.y,{title:"Filters",children:(0,r.jsxs)("form",{className:"grid gap-4 md:grid-cols-3",onSubmit:e=>{e.preventDefault(),_(n)},children:[(0,r.jsx)(m.g,{label:"Action",children:(0,r.jsx)(x.o,{value:n.action,onChange:e=>w("action",e.target.value),placeholder:"guest.created"})}),(0,r.jsx)(m.g,{label:"User ID",children:(0,r.jsx)(x.o,{value:n.user_id,onChange:e=>w("user_id",e.target.value),placeholder:"UUID"})}),(0,r.jsx)(m.g,{label:"From",children:(0,r.jsx)(x.o,{type:"date",value:n.date_from,onChange:e=>w("date_from",e.target.value)})}),(0,r.jsx)(m.g,{label:"To",children:(0,r.jsx)(x.o,{type:"date",value:n.date_to,onChange:e=>w("date_to",e.target.value)})}),(0,r.jsxs)("div",{className:"md:col-span-3 flex flex-wrap gap-3",children:[(0,r.jsx)(h.z,{type:"submit",variant:"primary",children:"Apply Filters"}),(0,r.jsx)(h.z,{type:"button",variant:"secondary",onClick:()=>{p(g),_(g)},children:"Reset"})]})]})}),b?(0,r.jsx)(d.o,{tone:"error",message:b}):null,j?(0,r.jsx)(d.o,{tone:"info",message:"Loading audit logs..."}):S?(0,r.jsx)(c.r,{title:"Recent Activity",table:(0,r.jsx)(o.w,{columns:[{key:"action",header:"Action",cellClassName:"font-medium",render:e=>e.action},{key:"resource",header:"Resource",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.resource_type)&&void 0!==t?t:"-"}},{key:"user",header:"User",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.user_id)&&void 0!==t?t:"-"}},{key:"when",header:"When",render:e=>e.created_at?new Date(e.created_at).toLocaleString():"-"}],rows:e,rowKey:e=>e.id})}):(0,r.jsx)(u.u,{description:"No audit activity yet."})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return s},E:function(){return a}});var r=n(7437),i=n(3301);function s(e){let{permission:t,children:n,fallback:s=null}=e,{permissions:a,loading:l}=(0,i.a)();return l?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let r=0;r<e.length;r+=1)if("*"!==e[r]&&e[r]!==n[r]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(a,t)?(0,r.jsx)(r.Fragment,{children:s}):(0,r.jsx)(r.Fragment,{children:n})}function a(e){let{userType:t,children:n,fallback:s=null}=e,{user:a,loading:l}=(0,i.a)();return l?null:a&&a.user_type===t?(0,r.jsx)(r.Fragment,{children:n}):(0,r.jsx)("div",{className:"auth-layout",children:(0,r.jsxs)("div",{className:"glass-card auth-card",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),s]})})}},2145:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});var r=n(7437),i=n(4839),s=n(7282);function a(e){let{title:t,description:n,rightSlot:a,count:l,countLabel:o,className:c}=e;return(0,r.jsxs)("div",{className:(0,i.Z)("ui-page-header",c),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"ui-page-title",children:t}),n?(0,r.jsx)("p",{className:"ui-page-subtitle",children:n}):null]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:["number"==typeof l?(0,r.jsxs)(s.C,{variant:"accent",children:[l,o?" ".concat(o):""]}):null,a]})]})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return o},E:function(){return c}});var r=n(7437),i=n(2265),s=n(5139);let a={login:(e,t)=>(0,s.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,s.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,s.S)("/auth/logout",{method:"POST"}),me:()=>(0,s.S)("/auth/me"),startImpersonation:e=>(0,s.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,s.S)("/auth/impersonation/stop",{method:"POST"})},l=(0,i.createContext)(void 0);function o(e){let{children:t}=e,[n,s]=(0,i.useState)(null),[o,c]=(0,i.useState)([]),[u,d]=(0,i.useState)(null),[f,h]=(0,i.useState)(null),[m,x]=(0,i.useState)(!0),p=(0,i.useCallback)(e=>{var t,n;s(e.user),c(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),h(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),v=(0,i.useCallback)(async()=>{try{let e=await a.me();p(e)}catch(e){try{let e=await a.refresh();p(e)}catch(e){s(null),c([]),d(null),h(null)}}finally{x(!1)}},[p]);(0,i.useEffect)(()=>{v()},[v]);let g=(0,i.useCallback)(async(e,t)=>{let n=await a.login(e,t);return p(n),n},[p]),j=(0,i.useCallback)(async()=>{await a.logout(),s(null),c([]),d(null),h(null)},[]),y=(0,i.useCallback)(async()=>{p(await a.refresh())},[p]),b=(0,i.useCallback)(async e=>{let t=await a.startImpersonation(e);return p(t),t},[p]),N=(0,i.useCallback)(async()=>{let e=await a.stopImpersonation();return p(e),e},[p]),_=(0,i.useMemo)(()=>({user:n,permissions:o,tenant:u,impersonation:f,loading:m,login:g,logout:j,refresh:y,startImpersonation:b,stopImpersonation:N}),[n,o,u,f,m,g,j,y,b,N]);return(0,r.jsx)(l.Provider,{value:_,children:t})}function c(){let e=(0,i.useContext)(l);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4862:function(e,t,n){"use strict";n.d(t,{y:function(){return s}});var r=n(7437),i=n(7606);function s(e){let{title:t,children:n}=e;return(0,r.jsx)(i.q,{title:t,children:n})}},6572:function(e,t,n){"use strict";n.d(t,{w:function(){return s}});var r=n(7437),i=n(4839);function s(e){let{columns:t,rows:n,rowKey:s,emptyFallback:a=null,className:l}=e;return 0===n.length?(0,r.jsx)(r.Fragment,{children:a}):(0,r.jsxs)("table",{className:(0,i.Z)("ui-table",l),children:[(0,r.jsx)("thead",{children:(0,r.jsx)("tr",{children:t.map(e=>(0,r.jsx)("th",{className:(0,i.Z)("pb-3",e.headerClassName),children:e.header},e.key))})}),(0,r.jsx)("tbody",{children:n.map((e,n)=>(0,r.jsx)("tr",{children:t.map(t=>(0,r.jsx)("td",{className:(0,i.Z)("py-3",t.cellClassName),children:t.render(e,n)},t.key))},s(e,n)))})]})}},6053:function(e,t,n){"use strict";n.d(t,{r:function(){return a}});var r=n(7437),i=n(6430),s=n(7606);function a(e){let{title:t,table:n,footer:a}=e;return(0,r.jsxs)(s.q,{title:t,children:[(0,r.jsx)(i.K,{children:n}),a?(0,r.jsx)("div",{className:"mt-3",children:a}):null]})}},22:function(e,t,n){"use strict";n.d(t,{u:function(){return s}});var r=n(7437),i=n(4631);function s(e){let{title:t="Nothing here yet",description:n}=e;return(0,r.jsxs)(i.W,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg",children:t}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:n})]})}},4024:function(e,t,n){"use strict";n.d(t,{o:function(){return s}});var r=n(7437),i=n(4839);function s(e){let{tone:t="info",message:n,className:s}=e;return(0,r.jsx)("p",{className:(0,i.Z)("ui-inline-alert","ui-inline-alert-".concat(t),s),children:n})}},6430:function(e,t,n){"use strict";n.d(t,{K:function(){return s}});var r=n(7437),i=n(4839);function s(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,i.Z)("ui-table-wrap",n),children:t})}},7606:function(e,t,n){"use strict";n.d(t,{q:function(){return a}});var r=n(7437),i=n(4839),s=n(4631);function a(e){let{title:t,actions:n,children:a,className:l}=e;return(0,r.jsxs)(s.W,{className:(0,i.Z)("p-6 ui-reveal",l),children:[(t||n)&&(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t?(0,r.jsx)("h3",{className:"text-lg",children:t}):(0,r.jsx)("span",{}),n]}),(0,r.jsx)("div",{className:(0,i.Z)((t||n)&&"mt-4"),children:a})]})}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return s}});var r=n(7437),i=n(4839);function s(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,i.Z)("glass-card",n),children:t})}},7282:function(e,t,n){"use strict";n.d(t,{C:function(){return s}});var r=n(7437),i=n(4839);function s(e){let{variant:t="accent",className:n,children:s,...a}=e;return(0,r.jsx)("span",{className:(0,i.Z)("badge","badge-".concat(t),n),...a,children:s})}},5427:function(e,t,n){"use strict";n.d(t,{z:function(){return s}});var r=n(7437),i=n(4839);function s(e){let{className:t,variant:n="secondary",size:s="md",children:a,...l}=e;return(0,r.jsx)("button",{className:(0,i.Z)("ui-btn ui-anim","ui-btn-".concat(n),"sm"===s&&"ui-btn-sm","md"===s&&"ui-btn-md","lg"===s&&"ui-btn-lg",t),...l,children:a})}},7032:function(e,t,n){"use strict";n.d(t,{g:function(){return s}});var r=n(7437),i=n(4839);function s(e){let{label:t,required:n,hint:s,error:a,className:l,children:o}=e;return(0,r.jsxs)("div",{className:(0,i.Z)("space-y-2",l),children:[(0,r.jsxs)("label",{className:"text-sm",children:[t,n&&(0,r.jsx)("span",{className:"ml-1 text-[color:var(--color-accent)]",children:"*"})]}),o,a?(0,r.jsx)("p",{className:"text-xs text-red-400",children:a}):s?(0,r.jsx)("p",{className:"text-xs text-[color:var(--color-text-muted)]",children:s}):null]})}},6243:function(e,t,n){"use strict";n.d(t,{o:function(){return s}});var r=n(7437),i=n(4839);function s(e){let{className:t,...n}=e;return(0,r.jsx)("input",{className:(0,i.Z)("ui-input",t),...n})}},5139:function(e,t,n){"use strict";var r;n.d(t,{S:function(){return s}});let i=null!==(r=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:8000/api";async function s(e){var t,n,r;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(i).concat(e),l=new Headers(null!==(n=s.headers)&&void 0!==n?n:{}),o=null!==(r=null===(t=s.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==r?r:"GET";if("GET"!==o&&"HEAD"!==o){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&l.set("X-CSRF-Token",e),l.has("Content-Type")||l.set("Content-Type","application/json")}let c=await fetch(a,{...s,headers:l,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let u=await c.text();if(u)return JSON.parse(u)}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return i}});var r=n(1288);function i(){return(0,r.E)()}},357:function(e,t,n){"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,i=e.exports={};function s(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var o=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?o=r.concat(o):u=-1,o.length&&f())}function f(){if(!c){var e=l(d);c=!0;for(var t=o.length;t;){for(r=o,o=[];++u<t;)r&&r[u].run();u=-1,t=o.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new h(e,t)),1!==o.length||c||l(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}},a=!0;try{t[e](s,s.exports,r),a=!1}finally{a&&delete n[e]}return s.exports}r.ab="//";var i=r(229);e.exports=i}()},4839:function(e,t,n){"use strict";t.Z=function(){for(var e,t,n=0,r="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=function e(t){var n,r,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t){if(Array.isArray(t)){var s=t.length;for(n=0;n<s;n++)t[n]&&(r=e(t[n]))&&(i&&(i+=" "),i+=r)}else for(r in t)t[r]&&(i&&(i+=" "),i+=r)}return i}(e))&&(r&&(r+=" "),r+=t);return r}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=7457)}),_N_E=e.O()}]);