(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1820],{7532:function(e,t,r){Promise.resolve().then(r.bind(r,7767))},7767:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(7437),n=r(2265),l=r(5854),a=r(4631),i=r(5139);let o={list:e=>{let t=new URLSearchParams;(null==e?void 0:e.page)&&t.set("page",e.page.toString()),(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString()),(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.status)&&t.set("status",e.status),(null==e?void 0:e.severity)&&t.set("severity",e.severity);let r=t.toString();return(0,i.S)("/hotel/incidents".concat(r?"?".concat(r):""))},create:e=>(0,i.S)("/hotel/incidents",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,i.S)("/hotel/incidents/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,i.S)("/hotel/incidents/".concat(e),{method:"DELETE"})},c={title:"",description:"",status:"open",severity:"medium",category:"",occurred_at:"",resolved_at:""},d=e=>{if(!e)return;let t=new Date(e);return isNaN(t.getTime())?void 0:t.toISOString()},u=e=>e?e.slice(0,10):"";function h(){let[e,t]=(0,n.useState)([]),[r,i]=(0,n.useState)(!0),[h,m]=(0,n.useState)(c),[x,p]=(0,n.useState)(null),[v,f]=(0,n.useState)(null),[g,y]=(0,n.useState)(""),[b,j]=(0,n.useState)(""),[w,N]=(0,n.useState)(""),S=(0,n.useCallback)(async e=>{var r,s,n;let l=null!==(r=null==e?void 0:e.search)&&void 0!==r?r:"",a=null!==(s=null==e?void 0:e.status)&&void 0!==s?s:"",c=null!==(n=null==e?void 0:e.severity)&&void 0!==n?n:"";i(!0);try{let e=await o.list({page:1,limit:50,search:l||void 0,status:a||void 0,severity:c||void 0});t(e.items)}catch(e){f(e instanceof Error?e.message:"Failed to load incidents")}finally{i(!1)}},[]),C=(0,n.useCallback)(()=>S({search:g,status:b,severity:w}),[S,g,w,b]);(0,n.useEffect)(()=>{S()},[S]);let T=(e,t)=>{m(r=>({...r,[e]:t}))},_=()=>{m(c),p(null)},k=(0,n.useMemo)(()=>({title:h.title,description:h.description||void 0,status:h.status||void 0,severity:h.severity||void 0,category:h.category||void 0,occurred_at:d(h.occurred_at),resolved_at:d(h.resolved_at)}),[h]),E=(0,n.useMemo)(()=>({title:h.title||void 0,description:h.description||void 0,status:h.status||void 0,severity:h.severity||void 0,category:h.category||void 0,occurred_at:d(h.occurred_at),resolved_at:d(h.resolved_at)}),[h]),O=async e=>{e.preventDefault(),f(null);try{x?await o.update(x.id,E):await o.create(k),_(),await C()}catch(e){f(e instanceof Error?e.message:"Failed to save incident")}},A=e=>{var t,r;p(e),m({title:e.title,description:null!==(t=e.description)&&void 0!==t?t:"",status:e.status,severity:e.severity,category:null!==(r=e.category)&&void 0!==r?r:"",occurred_at:u(e.occurred_at),resolved_at:u(e.resolved_at)})},I=async e=>{if(confirm('Delete incident "'.concat(e.title,'"? This cannot be undone.')))try{await o.remove(e.id),await C()}catch(e){f(e instanceof Error?e.message:"Failed to delete incident")}};return(0,s.jsx)(l.n,{permission:"hotel:incidents:read",fallback:(0,s.jsxs)(a.W,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have permission to view incidents."})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Incidents Record"}),(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Track maintenance, guest issues, and safety incidents."})]}),(0,s.jsxs)("span",{className:"badge",children:[e.length," Incidents"]})]}),(0,s.jsxs)(a.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Filters"}),(0,s.jsxs)("div",{className:"mt-4 flex flex-wrap gap-3",children:[(0,s.jsx)("input",{value:g,onChange:e=>y(e.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm md:w-72",placeholder:"Search title or description"}),(0,s.jsx)("input",{value:b,onChange:e=>j(e.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm md:w-40",placeholder:"status"}),(0,s.jsx)("input",{value:w,onChange:e=>N(e.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm md:w-40",placeholder:"severity"}),(0,s.jsx)("button",{className:"rounded-xl border border-white/20 px-6 py-3 text-sm",onClick:()=>{C()},children:"Apply"})]})]}),(0,s.jsx)(l.n,{permission:x?"hotel:incidents:update":"hotel:incidents:create",children:(0,s.jsxs)(a.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:x?"Edit Incident":"Log Incident"}),(0,s.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:O,children:[(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"Title"}),(0,s.jsx)("input",{value:h.title,onChange:e=>T("title",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"Water leak in room 204",required:!0})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"Description"}),(0,s.jsx)("textarea",{value:h.description,onChange:e=>T("description",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",rows:3})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Status"}),(0,s.jsx)("input",{value:h.status,onChange:e=>T("status",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"open"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Severity"}),(0,s.jsx)("input",{value:h.severity,onChange:e=>T("severity",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"medium"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Category"}),(0,s.jsx)("input",{value:h.category,onChange:e=>T("category",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"maintenance"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Occurred At"}),(0,s.jsx)("input",{type:"date",value:h.occurred_at,onChange:e=>T("occurred_at",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Resolved At"}),(0,s.jsx)("input",{type:"date",value:h.resolved_at,onChange:e=>T("resolved_at",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm"})]}),(0,s.jsxs)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:[(0,s.jsx)("button",{type:"submit",className:"rounded-xl bg-[color:var(--accent)] px-6 py-3 text-sm font-semibold text-black shadow-glow",children:x?"Save Changes":"Create Incident"}),x&&(0,s.jsx)("button",{type:"button",className:"rounded-xl border border-white/20 px-6 py-3 text-sm",onClick:_,children:"Cancel"})]})]})]})}),(0,s.jsxs)(a.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Incident Log"}),v&&(0,s.jsx)("p",{className:"mt-2 text-sm text-red-400",children:v}),r?(0,s.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"Loading incidents..."}):0===e.length?(0,s.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No incidents logged yet."}):(0,s.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"text-left text-[color:var(--muted)]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"pb-3",children:"Title"}),(0,s.jsx)("th",{className:"pb-3",children:"Status"}),(0,s.jsx)("th",{className:"pb-3",children:"Severity"}),(0,s.jsx)("th",{className:"pb-3",children:"Category"}),(0,s.jsx)("th",{className:"pb-3",children:"Occurred"}),(0,s.jsx)("th",{className:"pb-3",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/10",children:e.map(e=>{var t;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-3 font-medium",children:e.title}),(0,s.jsx)("td",{className:"py-3",children:e.status}),(0,s.jsx)("td",{className:"py-3",children:e.severity}),(0,s.jsx)("td",{className:"py-3 text-[color:var(--muted)]",children:null!==(t=e.category)&&void 0!==t?t:"-"}),(0,s.jsx)("td",{className:"py-3",children:e.occurred_at?new Date(e.occurred_at).toLocaleDateString():"-"}),(0,s.jsxs)("td",{className:"py-3 flex flex-wrap gap-2",children:[(0,s.jsx)(l.n,{permission:"hotel:incidents:update",children:(0,s.jsx)("button",{className:"rounded-full border border-white/20 px-3 py-1 text-xs",onClick:()=>A(e),children:"Edit"})}),(0,s.jsx)(l.n,{permission:"hotel:incidents:delete",children:(0,s.jsx)("button",{className:"rounded-full border border-red-400/40 px-3 py-1 text-xs text-red-300",onClick:()=>I(e),children:"Delete"})})]})]},e.id)})})]})})]})]})})}},5854:function(e,t,r){"use strict";r.d(t,{n:function(){return l},E:function(){return a}});var s=r(7437),n=r(3301);function l(e){let{permission:t,children:r,fallback:l=null}=e,{permissions:a,loading:i}=(0,n.a)();return i?null:!function(e,t){if(e.includes(t))return!0;let r=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===r.length){let t=!0;for(let s=0;s<e.length;s+=1)if("*"!==e[s]&&e[s]!==r[s]){t=!1;break}if(t)return!0}if(e.length<r.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===r.slice(0,e.length-1).join(":"))return!0}return!1}(a,t)?(0,s.jsx)(s.Fragment,{children:l}):(0,s.jsx)(s.Fragment,{children:r})}function a(e){let{userType:t,children:r,fallback:l=null}=e,{user:a,loading:i}=(0,n.a)();return i?null:a&&a.user_type===t?(0,s.jsx)(s.Fragment,{children:r}):(0,s.jsx)("div",{className:"auth-layout",children:(0,s.jsxs)("div",{className:"glass-card auth-card",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),l]})})}},1288:function(e,t,r){"use strict";r.d(t,{H:function(){return o},E:function(){return c}});var s=r(7437),n=r(2265),l=r(5139);let a={login:(e,t)=>(0,l.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,l.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,l.S)("/auth/logout",{method:"POST"}),me:()=>(0,l.S)("/auth/me"),startImpersonation:e=>(0,l.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,l.S)("/auth/impersonation/stop",{method:"POST"})},i=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[r,l]=(0,n.useState)(null),[o,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(null),[x,p]=(0,n.useState)(!0),v=(0,n.useCallback)(e=>{var t,r;l(e.user),c(e.permissions),u(null!==(t=e.tenant)&&void 0!==t?t:null),m(null!==(r=e.impersonation)&&void 0!==r?r:null)},[]),f=(0,n.useCallback)(async()=>{try{let e=await a.me();v(e)}catch(e){try{let e=await a.refresh();v(e)}catch(e){l(null),c([]),u(null),m(null)}}finally{p(!1)}},[v]);(0,n.useEffect)(()=>{f()},[f]);let g=(0,n.useCallback)(async(e,t)=>{let r=await a.login(e,t);return v(r),r},[v]),y=(0,n.useCallback)(async()=>{await a.logout(),l(null),c([]),u(null),m(null)},[]),b=(0,n.useCallback)(async()=>{v(await a.refresh())},[v]),j=(0,n.useCallback)(async e=>{let t=await a.startImpersonation(e);return v(t),t},[v]),w=(0,n.useCallback)(async()=>{let e=await a.stopImpersonation();return v(e),e},[v]),N=(0,n.useMemo)(()=>({user:r,permissions:o,tenant:d,impersonation:h,loading:x,login:g,logout:y,refresh:b,startImpersonation:j,stopImpersonation:w}),[r,o,d,h,x,g,y,b,j,w]);return(0,s.jsx)(i.Provider,{value:N,children:t})}function c(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4631:function(e,t,r){"use strict";r.d(t,{W:function(){return l}});var s=r(7437),n=r(4839);function l(e){let{children:t,className:r}=e;return(0,s.jsx)("div",{className:(0,n.Z)("glass-card",r),children:t})}},5139:function(e,t,r){"use strict";var s;r.d(t,{S:function(){return l}});let n=null!==(s=r(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api";async function l(e){var t,r,s;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(n).concat(e),i=new Headers(null!==(r=l.headers)&&void 0!==r?r:{}),o=null!==(s=null===(t=l.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==s?s:"GET";if("GET"!==o&&"HEAD"!==o){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&i.set("X-CSRF-Token",e),i.has("Content-Type")||i.set("Content-Type","application/json")}let c=await fetch(a,{...l,headers:i,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let d=await c.text();if(d)return JSON.parse(d)}},3301:function(e,t,r){"use strict";r.d(t,{a:function(){return n}});var s=r(1288);function n(){return(0,s.E)()}},357:function(e,t,r){"use strict";var s,n;e.exports=(null==(s=r.g.process)?void 0:s.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(8081)},8081:function(e){!function(){var t={229:function(e){var t,r,s,n=e.exports={};function l(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var o=[],c=!1,d=-1;function u(){c&&s&&(c=!1,s.length?o=s.concat(o):d=-1,o.length&&h())}function h(){if(!c){var e=i(u);c=!0;for(var t=o.length;t;){for(s=o,o=[];++d<t;)s&&s[d].run();d=-1,t=o.length}s=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function x(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new m(e,t)),1!==o.length||c||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=x,n.addListener=x,n.once=x,n.off=x,n.removeListener=x,n.removeAllListeners=x,n.emit=x,n.prependListener=x,n.prependOnceListener=x,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var l=r[e]={exports:{}},a=!0;try{t[e](l,l.exports,s),a=!1}finally{a&&delete r[e]}return l.exports}s.ab="//";var n=s(229);e.exports=n}()},4839:function(e,t,r){"use strict";t.Z=function(){for(var e,t,r=0,s="",n=arguments.length;r<n;r++)(e=arguments[r])&&(t=function e(t){var r,s,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(r=0;r<l;r++)t[r]&&(s=e(t[r]))&&(n&&(n+=" "),n+=s)}else for(s in t)t[s]&&(n&&(n+=" "),n+=s)}return n}(e))&&(s&&(s+=" "),s+=t);return s}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=7532)}),_N_E=e.O()}]);