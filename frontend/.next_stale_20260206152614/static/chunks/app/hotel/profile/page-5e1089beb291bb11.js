(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4377],{8195:function(e,t,n){Promise.resolve().then(n.bind(n,136))},136:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(7437),s=n(2265),a=n(5854),l=n(4631),o=n(5139);let i={get:()=>(0,o.S)("/hotel/profile"),update:e=>(0,o.S)("/hotel/profile",{method:"PUT",body:JSON.stringify(e)})};var u=n(3301);let c={first_name:"",last_name:"",current_password:"",new_password:""};function d(){let{refresh:e}=(0,u.a)(),[t,n]=(0,s.useState)(null),[o,d]=(0,s.useState)(c),[m,f]=(0,s.useState)(!0),[h,p]=(0,s.useState)(null),[x,v]=(0,s.useState)(null),w=async()=>{f(!0),p(null);try{var e,t;let r=await i.get();n(r),d({first_name:null!==(e=r.first_name)&&void 0!==e?e:"",last_name:null!==(t=r.last_name)&&void 0!==t?t:"",current_password:"",new_password:""})}catch(e){p(e instanceof Error?e.message:"Failed to load profile")}finally{f(!1)}};(0,s.useEffect)(()=>{w()},[]);let g=(e,t)=>{d(n=>({...n,[e]:t}))},y=async t=>{t.preventDefault(),p(null),v(null);try{await i.update({first_name:o.first_name||void 0,last_name:o.last_name||void 0,current_password:o.current_password||void 0,new_password:o.new_password||void 0}),await e(),v("Profile updated successfully."),d(e=>({...e,current_password:"",new_password:""})),await w()}catch(e){p(e instanceof Error?e.message:"Failed to update profile")}};return(0,r.jsx)(a.n,{permission:"hotel:profile:read",fallback:(0,r.jsxs)(l.W,{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have permission to view your profile."})]}),children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl",children:"My Profile"}),(0,r.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Manage your account details and password."})]}),(0,r.jsx)(l.W,{className:"p-6",children:m?(0,r.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Loading profile..."}):t?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Email"}),(0,r.jsx)("p",{className:"mt-1 text-sm font-semibold",children:t.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Role"}),(0,r.jsx)("p",{className:"mt-1 text-sm font-semibold capitalize",children:t.user_type})]})]}),(0,r.jsxs)("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:y,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"First Name"}),(0,r.jsx)("input",{value:o.first_name,onChange:e=>g("first_name",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"First name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"Last Name"}),(0,r.jsx)("input",{value:o.last_name,onChange:e=>g("last_name",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"Last name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"Current Password"}),(0,r.jsx)("input",{type:"password",value:o.current_password,onChange:e=>g("current_password",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"••••••••"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"New Password"}),(0,r.jsx)("input",{type:"password",value:o.new_password,onChange:e=>g("new_password",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"••••••••"})]}),(0,r.jsx)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:(0,r.jsx)(a.n,{permission:"hotel:profile:update",children:(0,r.jsx)("button",{type:"submit",className:"rounded-xl bg-[color:var(--accent)] px-6 py-3 text-sm font-semibold text-black shadow-glow",children:"Save Changes"})})})]}),h&&(0,r.jsx)("p",{className:"text-sm text-red-400",children:h}),x&&(0,r.jsx)("p",{className:"text-sm text-emerald-300",children:x})]}):(0,r.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Profile not available."})})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return a},E:function(){return l}});var r=n(7437),s=n(3301);function a(e){let{permission:t,children:n,fallback:a=null}=e,{permissions:l,loading:o}=(0,s.a)();return o?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let r=0;r<e.length;r+=1)if("*"!==e[r]&&e[r]!==n[r]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(l,t)?(0,r.jsx)(r.Fragment,{children:a}):(0,r.jsx)(r.Fragment,{children:n})}function l(e){let{userType:t,children:n,fallback:a=null}=e,{user:l,loading:o}=(0,s.a)();return o?null:l&&l.user_type===t?(0,r.jsx)(r.Fragment,{children:n}):(0,r.jsx)("div",{className:"auth-layout",children:(0,r.jsxs)("div",{className:"glass-card auth-card",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),a]})})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return i},E:function(){return u}});var r=n(7437),s=n(2265),a=n(5139);let l={login:(e,t)=>(0,a.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,a.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,a.S)("/auth/logout",{method:"POST"}),me:()=>(0,a.S)("/auth/me"),startImpersonation:e=>(0,a.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,a.S)("/auth/impersonation/stop",{method:"POST"})},o=(0,s.createContext)(void 0);function i(e){let{children:t}=e,[n,a]=(0,s.useState)(null),[i,u]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),[m,f]=(0,s.useState)(null),[h,p]=(0,s.useState)(!0),x=(0,s.useCallback)(e=>{var t,n;a(e.user),u(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),f(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),v=(0,s.useCallback)(async()=>{try{let e=await l.me();x(e)}catch(e){try{let e=await l.refresh();x(e)}catch(e){a(null),u([]),d(null),f(null)}}finally{p(!1)}},[x]);(0,s.useEffect)(()=>{v()},[v]);let w=(0,s.useCallback)(async(e,t)=>{let n=await l.login(e,t);return x(n),n},[x]),g=(0,s.useCallback)(async()=>{await l.logout(),a(null),u([]),d(null),f(null)},[]),y=(0,s.useCallback)(async()=>{x(await l.refresh())},[x]),b=(0,s.useCallback)(async e=>{let t=await l.startImpersonation(e);return x(t),t},[x]),j=(0,s.useCallback)(async()=>{let e=await l.stopImpersonation();return x(e),e},[x]),N=(0,s.useMemo)(()=>({user:n,permissions:i,tenant:c,impersonation:m,loading:h,login:w,logout:g,refresh:y,startImpersonation:b,stopImpersonation:j}),[n,i,c,m,h,w,g,y,b,j]);return(0,r.jsx)(o.Provider,{value:N,children:t})}function u(){let e=(0,s.useContext)(o);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return a}});var r=n(7437),s=n(4839);function a(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,s.Z)("glass-card",n),children:t})}},5139:function(e,t,n){"use strict";var r;n.d(t,{S:function(){return a}});let s=null!==(r=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:8000/api";async function a(e){var t,n,r;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l="".concat(s).concat(e),o=new Headers(null!==(n=a.headers)&&void 0!==n?n:{}),i=null!==(r=null===(t=a.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==r?r:"GET";if("GET"!==i&&"HEAD"!==i){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&o.set("X-CSRF-Token",e),o.has("Content-Type")||o.set("Content-Type","application/json")}let u=await fetch(l,{...a,headers:o,credentials:"include"});if(!u.ok)throw Error(await u.text()||u.statusText);if(204===u.status)return;let c=await u.text();if(c)return JSON.parse(c)}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return s}});var r=n(1288);function s(){return(0,r.E)()}},357:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:l}catch(e){n=l}}();var i=[],u=!1,c=-1;function d(){u&&r&&(u=!1,r.length?i=r.concat(i):c=-1,i.length&&m())}function m(){if(!u){var e=o(d);u=!0;for(var t=i.length;t;){for(r=i,i=[];++c<t;)r&&r[c].run();c=-1,t=i.length}r=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===l||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new f(e,t)),1!==i.length||u||o(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=h,s.addListener=h,s.once=h,s.off=h,s.removeListener=h,s.removeAllListeners=h,s.emit=h,s.prependListener=h,s.prependOnceListener=h,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}},l=!0;try{t[e](a,a.exports,r),l=!1}finally{l&&delete n[e]}return a.exports}r.ab="//";var s=r(229);e.exports=s}()},4839:function(e,t,n){"use strict";t.Z=function(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=function e(t){var n,r,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t)){var a=t.length;for(n=0;n<a;n++)t[n]&&(r=e(t[n]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r)}return s}(e))&&(r&&(r+=" "),r+=t);return r}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=8195)}),_N_E=e.O()}]);