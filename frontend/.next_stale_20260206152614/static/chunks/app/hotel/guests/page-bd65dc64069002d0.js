(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9018],{5582:function(e,t,a){Promise.resolve().then(a.bind(a,2724))},2724:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var s=a(7437),n=a(2265),l=a(5854),i=a(2145),o=a(4862),c=a(6572),r=a(6053),u=a(22),d=a(4024),h=a(6865),m=a(5205),g=a(4631),_=a(5427),v=a(7032),x=a(6243),p=a(7868),k=a(5139);let j={list:e=>{let t=new URLSearchParams;(null==e?void 0:e.page)&&t.set("page",e.page.toString()),(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString()),(null==e?void 0:e.search)&&t.set("search",e.search);let a=t.toString();return(0,k.S)("/hotel/guests".concat(a?"?".concat(a):""))},create:e=>(0,k.S)("/hotel/guests",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,k.S)("/hotel/guests/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,k.S)("/hotel/guests/".concat(e),{method:"DELETE"})},f={first_name:"",last_name:"",email:"",phone:"",status:"active",check_in_at:"",check_out_at:"",notes:""},y=e=>{if(!e)return;let t=new Date(e);return isNaN(t.getTime())?void 0:t.toISOString()},S=e=>e?e.slice(0,10):"";function C(){let[e,t]=(0,n.useState)([]),[a,k]=(0,n.useState)(!0),[C,b]=(0,n.useState)(f),[N,w]=(0,n.useState)(null),[E,D]=(0,n.useState)(null),[G,O]=(0,n.useState)(""),z=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";k(!0),D(null);try{let a=await j.list({page:1,limit:50,search:e||void 0});t(a.items)}catch(e){D(e instanceof Error?e.message:"Failed to load guests")}finally{k(!1)}},[]);(0,n.useEffect)(()=>{z()},[z]);let L=(e,t)=>{b(a=>({...a,[e]:t}))},T=()=>{b(f),w(null)},F=(0,n.useMemo)(()=>({first_name:C.first_name,last_name:C.last_name,email:C.email||void 0,phone:C.phone||void 0,status:C.status||void 0,check_in_at:y(C.check_in_at),check_out_at:y(C.check_out_at),notes:C.notes||void 0}),[C]),P=(0,n.useMemo)(()=>({first_name:C.first_name||void 0,last_name:C.last_name||void 0,email:C.email||void 0,phone:C.phone||void 0,status:C.status||void 0,check_in_at:y(C.check_in_at),check_out_at:y(C.check_out_at),notes:C.notes||void 0}),[C]),A=async e=>{e.preventDefault(),D(null);try{N?await j.update(N.id,P):await j.create(F),T(),await z(G)}catch(e){D(e instanceof Error?e.message:"Failed to save guest")}},I=e=>{var t,a,s;w(e),b({first_name:e.first_name,last_name:e.last_name,email:null!==(t=e.email)&&void 0!==t?t:"",phone:null!==(a=e.phone)&&void 0!==a?a:"",status:e.status,check_in_at:S(e.check_in_at),check_out_at:S(e.check_out_at),notes:null!==(s=e.notes)&&void 0!==s?s:""})},q=async e=>{if(confirm("Delete ".concat(e.first_name," ").concat(e.last_name,"? This cannot be undone.")))try{await j.remove(e.id),await z(G)}catch(e){D(e instanceof Error?e.message:"Failed to delete guest")}};return(0,s.jsx)(l.n,{permission:"hotel:guests:read",fallback:(0,s.jsxs)(g.W,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view the guest registry."})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(i.m,{title:"Guest Registry",description:"Track active and upcoming guests for your property.",count:e.length,countLabel:"Guests"}),(0,s.jsx)(o.y,{title:"Search Guests",children:(0,s.jsxs)(h.B,{children:[(0,s.jsx)(x.o,{value:G,onChange:e=>O(e.target.value),className:"md:w-80",placeholder:"Search by name or email"}),(0,s.jsx)(_.z,{variant:"secondary",onClick:()=>void z(G),children:"Search"})]})}),(0,s.jsx)(l.n,{permission:N?"hotel:guests:update":"hotel:guests:create",children:(0,s.jsx)(o.y,{title:N?"Edit Guest":"Add Guest",children:(0,s.jsxs)("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:A,children:[(0,s.jsx)(v.g,{label:"First Name",required:!0,children:(0,s.jsx)(x.o,{value:C.first_name,onChange:e=>L("first_name",e.target.value)})}),(0,s.jsx)(v.g,{label:"Last Name",required:!0,children:(0,s.jsx)(x.o,{value:C.last_name,onChange:e=>L("last_name",e.target.value)})}),(0,s.jsx)(v.g,{label:"Email",children:(0,s.jsx)(x.o,{value:C.email,onChange:e=>L("email",e.target.value),placeholder:"guest@example.com"})}),(0,s.jsx)(v.g,{label:"Phone",children:(0,s.jsx)(x.o,{value:C.phone,onChange:e=>L("phone",e.target.value),placeholder:"+1 555 123 4567"})}),(0,s.jsx)(v.g,{label:"Status",children:(0,s.jsx)(x.o,{value:C.status,onChange:e=>L("status",e.target.value)})}),(0,s.jsx)(v.g,{label:"Check In",children:(0,s.jsx)(x.o,{type:"date",value:C.check_in_at,onChange:e=>L("check_in_at",e.target.value)})}),(0,s.jsx)(v.g,{label:"Check Out",children:(0,s.jsx)(x.o,{type:"date",value:C.check_out_at,onChange:e=>L("check_out_at",e.target.value)})}),(0,s.jsx)(v.g,{label:"Notes",className:"md:col-span-2",children:(0,s.jsx)(p.F,{value:C.notes,onChange:e=>L("notes",e.target.value),rows:3})}),(0,s.jsxs)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:[(0,s.jsx)(_.z,{type:"submit",variant:"primary",children:N?"Save Changes":"Create Guest"}),N?(0,s.jsx)(_.z,{type:"button",variant:"secondary",onClick:T,children:"Cancel"}):null]})]})})}),E?(0,s.jsx)(d.o,{tone:"error",message:E}):null,a?(0,s.jsx)(d.o,{tone:"info",message:"Loading guests..."}):0===e.length?(0,s.jsx)(u.u,{description:"No guests added yet."}):(0,s.jsx)(r.r,{title:"Guest Directory",table:(0,s.jsx)(c.w,{columns:[{key:"guest",header:"Guest",cellClassName:"font-medium",render:e=>"".concat(e.first_name," ").concat(e.last_name)},{key:"email",header:"Email",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.email)&&void 0!==t?t:"-"}},{key:"status",header:"Status",render:e=>e.status},{key:"check_in",header:"Check In",render:e=>e.check_in_at?new Date(e.check_in_at).toLocaleDateString():"-"},{key:"check_out",header:"Check Out",render:e=>e.check_out_at?new Date(e.check_out_at).toLocaleDateString():"-"},{key:"actions",header:"Actions",render:e=>(0,s.jsxs)(m.l,{children:[(0,s.jsx)(l.n,{permission:"hotel:guests:update",children:(0,s.jsx)(_.z,{size:"sm",variant:"outline",onClick:()=>I(e),children:"Edit"})}),(0,s.jsx)(l.n,{permission:"hotel:guests:delete",children:(0,s.jsx)(_.z,{size:"sm",variant:"danger",onClick:()=>void q(e),children:"Delete"})})]})}],rows:e,rowKey:e=>e.id})})]})})}}},function(e){e.O(0,[2602,2971,7023,1744],function(){return e(e.s=5582)}),_N_E=e.O()}]);