(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2820],{5132:function(e,t,r){Promise.resolve().then(r.bind(r,3397))},3397:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s,n=r(7437),l=r(2265),a=r(6463),o=r(5854),i=r(4631),c=r(3805);let u=null!==(s=r(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api",d=e=>new Promise(t=>setTimeout(t,e));function h(){var e;let t=(0,a.useParams)().code,[r,s]=(0,l.useState)(null),[h,m]=(0,l.useState)(!0),[f,p]=(0,l.useState)(""),[x,v]=(0,l.useState)(""),[g,j]=(0,l.useState)(""),[y,b]=(0,l.useState)(null),[N,w]=(0,l.useState)(null),[S,T]=(0,l.useState)("csv"),[_,k]=(0,l.useState)(!1),C=(0,l.useCallback)(async(e,t)=>{if(e){m(!0),b(null);try{let r=await c.h.get(e,t);s(r)}catch(e){b(e instanceof Error?e.message:"Failed to load report")}finally{m(!1)}}},[]);(0,l.useEffect)(()=>{t&&C(t)},[C,t]);let E=async()=>{if(t){b(null),k(!0);try{let e=await c.h.export(t,{format:S,date_from:f||void 0,date_to:x||void 0,status:g||void 0});if(w(e),"pending"===e.status||"processing"===e.status)for(let t=0;t<60;t+=1){await d(1e3);let t=await c.h.getExport(e.id);if(w(t),"completed"===t.status||"failed"===t.status)break}}catch(e){b(e instanceof Error?e.message:"Failed to export report")}finally{k(!1)}}},P=(0,l.useMemo)(()=>(null==N?void 0:N.download_path)?"".concat(u).concat(N.download_path):null,[N]);return(0,n.jsx)(o.n,{permission:"hotel:reports:read",fallback:(0,n.jsxs)(i.W,{className:"p-6",children:[(0,n.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have permission to view this report."})]}),children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl",children:null!==(e=null==r?void 0:r.title)&&void 0!==e?e:"Report"}),(0,n.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:null==r?void 0:r.description})]}),(0,n.jsxs)(i.W,{className:"p-6",children:[(0,n.jsx)("h3",{className:"text-lg",children:"Filters"}),(0,n.jsxs)("div",{className:"mt-4 flex flex-wrap gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"From"}),(0,n.jsx)("input",{type:"date",value:f,onChange:e=>p(e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"To"}),(0,n.jsx)("input",{type:"date",value:x,onChange:e=>v(e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Status"}),(0,n.jsx)("input",{value:g,onChange:e=>j(e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"optional"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Export Format"}),(0,n.jsxs)("select",{value:S,onChange:e=>T(e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",children:[(0,n.jsx)("option",{value:"csv",children:"CSV"}),(0,n.jsx)("option",{value:"pdf",children:"PDF"}),(0,n.jsx)("option",{value:"excel",children:"Excel"})]})]}),(0,n.jsxs)("div",{className:"flex items-end gap-3",children:[(0,n.jsx)("button",{className:"rounded-xl bg-[color:var(--accent)] px-6 py-3 text-sm font-semibold text-black shadow-glow",onClick:()=>void C(t,{date_from:f||void 0,date_to:x||void 0,status:g||void 0}),children:"Apply"}),(0,n.jsx)(o.n,{permission:"hotel:reports:export",children:(0,n.jsx)("button",{className:"rounded-xl border border-white/20 px-6 py-3 text-sm",onClick:()=>void E(),disabled:_,children:_?"Queuing...":"Request Export"})})]})]}),N&&(0,n.jsxs)("div",{className:"mt-3 space-y-1 text-sm",children:[(0,n.jsxs)("p",{children:["Export status: ",(0,n.jsx)("span",{className:"font-semibold capitalize",children:N.status})," ","(",N.export_format.toUpperCase(),")"]}),P&&(0,n.jsxs)("p",{children:["File ready:"," ",(0,n.jsxs)("a",{className:"underline",href:P,target:"_blank",rel:"noreferrer",children:["Download ",N.export_format.toUpperCase()]})]}),"failed"===N.status&&N.error_message&&(0,n.jsx)("p",{className:"text-red-400",children:N.error_message})]}),y&&(0,n.jsx)("p",{className:"mt-3 text-sm text-red-400",children:y})]}),h?(0,n.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Loading report..."}):r?(0,n.jsxs)("div",{className:"space-y-4",children:[r.summary.length>0&&(0,n.jsxs)(i.W,{className:"p-6",children:[(0,n.jsx)("h3",{className:"text-lg",children:"Summary"}),(0,n.jsx)("div",{className:"mt-4 grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:r.summary.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-[color:var(--muted)]",children:e.label}),(0,n.jsx)("span",{className:"font-semibold",children:e.value})]},e.label))})]}),r.columns.length>0?(0,n.jsxs)(i.W,{className:"p-6",children:[(0,n.jsx)("h3",{className:"text-lg",children:"Report Data"}),0===r.rows.length?(0,n.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No data for the selected filters."}):(0,n.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{className:"text-left text-[color:var(--muted)]",children:(0,n.jsx)("tr",{children:r.columns.map(e=>(0,n.jsx)("th",{className:"pb-3",children:e.label},e.key))})}),(0,n.jsx)("tbody",{className:"divide-y divide-white/10",children:r.rows.map((e,t)=>(0,n.jsx)("tr",{children:r.columns.map(t=>{var r;return(0,n.jsx)("td",{className:"py-3",children:null!==(r=e[t.key])&&void 0!==r?r:"-"},t.key)})},t))})]})})]}):(0,n.jsx)(i.W,{className:"p-6",children:(0,n.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"This report provides summary metrics only."})})]}):null]})})}},5854:function(e,t,r){"use strict";r.d(t,{n:function(){return l},E:function(){return a}});var s=r(7437),n=r(3301);function l(e){let{permission:t,children:r,fallback:l=null}=e,{permissions:a,loading:o}=(0,n.a)();return o?null:!function(e,t){if(e.includes(t))return!0;let r=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===r.length){let t=!0;for(let s=0;s<e.length;s+=1)if("*"!==e[s]&&e[s]!==r[s]){t=!1;break}if(t)return!0}if(e.length<r.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===r.slice(0,e.length-1).join(":"))return!0}return!1}(a,t)?(0,s.jsx)(s.Fragment,{children:l}):(0,s.jsx)(s.Fragment,{children:r})}function a(e){let{userType:t,children:r,fallback:l=null}=e,{user:a,loading:o}=(0,n.a)();return o?null:a&&a.user_type===t?(0,s.jsx)(s.Fragment,{children:r}):(0,s.jsx)("div",{className:"auth-layout",children:(0,s.jsxs)("div",{className:"glass-card auth-card",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),l]})})}},1288:function(e,t,r){"use strict";r.d(t,{H:function(){return i},E:function(){return c}});var s=r(7437),n=r(2265),l=r(5139);let a={login:(e,t)=>(0,l.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,l.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,l.S)("/auth/logout",{method:"POST"}),me:()=>(0,l.S)("/auth/me"),startImpersonation:e=>(0,l.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,l.S)("/auth/impersonation/stop",{method:"POST"})},o=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[r,l]=(0,n.useState)(null),[i,c]=(0,n.useState)([]),[u,d]=(0,n.useState)(null),[h,m]=(0,n.useState)(null),[f,p]=(0,n.useState)(!0),x=(0,n.useCallback)(e=>{var t,r;l(e.user),c(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),m(null!==(r=e.impersonation)&&void 0!==r?r:null)},[]),v=(0,n.useCallback)(async()=>{try{let e=await a.me();x(e)}catch(e){try{let e=await a.refresh();x(e)}catch(e){l(null),c([]),d(null),m(null)}}finally{p(!1)}},[x]);(0,n.useEffect)(()=>{v()},[v]);let g=(0,n.useCallback)(async(e,t)=>{let r=await a.login(e,t);return x(r),r},[x]),j=(0,n.useCallback)(async()=>{await a.logout(),l(null),c([]),d(null),m(null)},[]),y=(0,n.useCallback)(async()=>{x(await a.refresh())},[x]),b=(0,n.useCallback)(async e=>{let t=await a.startImpersonation(e);return x(t),t},[x]),N=(0,n.useCallback)(async()=>{let e=await a.stopImpersonation();return x(e),e},[x]),w=(0,n.useMemo)(()=>({user:r,permissions:i,tenant:u,impersonation:h,loading:f,login:g,logout:j,refresh:y,startImpersonation:b,stopImpersonation:N}),[r,i,u,h,f,g,j,y,b,N]);return(0,s.jsx)(o.Provider,{value:w,children:t})}function c(){let e=(0,n.useContext)(o);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4631:function(e,t,r){"use strict";r.d(t,{W:function(){return l}});var s=r(7437),n=r(4839);function l(e){let{children:t,className:r}=e;return(0,s.jsx)("div",{className:(0,n.Z)("glass-card",r),children:t})}},5139:function(e,t,r){"use strict";var s;r.d(t,{S:function(){return l}});let n=null!==(s=r(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api";async function l(e){var t,r,s;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(n).concat(e),o=new Headers(null!==(r=l.headers)&&void 0!==r?r:{}),i=null!==(s=null===(t=l.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==s?s:"GET";if("GET"!==i&&"HEAD"!==i){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&o.set("X-CSRF-Token",e),o.has("Content-Type")||o.set("Content-Type","application/json")}let c=await fetch(a,{...l,headers:o,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let u=await c.text();if(u)return JSON.parse(u)}},3805:function(e,t,r){"use strict";r.d(t,{h:function(){return l}});var s=r(5139);let n=e=>{let t=new URLSearchParams;Object.entries(e).forEach(e=>{let[r,s]=e;s&&t.set(r,s)});let r=t.toString();return r?"?".concat(r):""},l={list:e=>(0,s.S)("/hotel/reports".concat(n({date_from:null==e?void 0:e.date_from,date_to:null==e?void 0:e.date_to}))),get:(e,t)=>(0,s.S)("/hotel/reports/".concat(e).concat(n({date_from:null==t?void 0:t.date_from,date_to:null==t?void 0:t.date_to,status:null==t?void 0:t.status}))),export:(e,t)=>(0,s.S)("/hotel/reports/".concat(e,"/export"),{method:"POST",body:JSON.stringify(t)}),getExport:e=>(0,s.S)("/hotel/reports/exports/".concat(e))}},3301:function(e,t,r){"use strict";r.d(t,{a:function(){return n}});var s=r(1288);function n(){return(0,s.E)()}},6463:function(e,t,r){"use strict";var s=r(1169);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},357:function(e,t,r){"use strict";var s,n;e.exports=(null==(s=r.g.process)?void 0:s.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(8081)},8081:function(e){!function(){var t={229:function(e){var t,r,s,n=e.exports={};function l(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var i=[],c=!1,u=-1;function d(){c&&s&&(c=!1,s.length?i=s.concat(i):u=-1,i.length&&h())}function h(){if(!c){var e=o(d);c=!0;for(var t=i.length;t;){for(s=i,i=[];++u<t;)s&&s[u].run();u=-1,t=i.length}s=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.push(new m(e,t)),1!==i.length||c||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=f,n.addListener=f,n.once=f,n.off=f,n.removeListener=f,n.removeAllListeners=f,n.emit=f,n.prependListener=f,n.prependOnceListener=f,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var l=r[e]={exports:{}},a=!0;try{t[e](l,l.exports,s),a=!1}finally{a&&delete r[e]}return l.exports}s.ab="//";var n=s(229);e.exports=n}()},4839:function(e,t,r){"use strict";t.Z=function(){for(var e,t,r=0,s="",n=arguments.length;r<n;r++)(e=arguments[r])&&(t=function e(t){var r,s,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(r=0;r<l;r++)t[r]&&(s=e(t[r]))&&(n&&(n+=" "),n+=s)}else for(s in t)t[s]&&(n&&(n+=" "),n+=s)}return n}(e))&&(s&&(s+=" "),s+=t);return s}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=5132)}),_N_E=e.O()}]);