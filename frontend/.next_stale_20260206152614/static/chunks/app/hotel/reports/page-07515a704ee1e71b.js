(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3875],{352:function(e,t,n){Promise.resolve().then(n.bind(n,4463))},4463:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var s=n(7437),r=n(7138),l=n(2265),a=n(5854),i=n(2145),c=n(4862),o=n(22),u=n(4024),d=n(4631),h=n(5427),m=n(7032),f=n(6243),x=n(3805);function p(){let[e,t]=(0,l.useState)([]),[n,p]=(0,l.useState)(!0),[v,j]=(0,l.useState)(""),[g,N]=(0,l.useState)(""),[b,y]=(0,l.useState)(null),S=(0,l.useCallback)(async e=>{p(!0),y(null);try{let n=await x.h.list({date_from:null==e?void 0:e.date_from,date_to:null==e?void 0:e.date_to});t(n.items)}catch(e){y(e instanceof Error?e.message:"Failed to load reports")}finally{p(!1)}},[]);return(0,l.useEffect)(()=>{S()},[S]),(0,s.jsx)(a.n,{permission:"hotel:reports:read",fallback:(0,s.jsxs)(d.W,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view reports."})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(i.m,{title:"Reports",description:"Operational insights tailored for your hotel.",count:e.length,countLabel:"Reports"}),(0,s.jsxs)(c.y,{title:"Date Filters",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsx)(m.g,{label:"From",children:(0,s.jsx)(f.o,{type:"date",value:v,onChange:e=>j(e.target.value)})}),(0,s.jsx)(m.g,{label:"To",children:(0,s.jsx)(f.o,{type:"date",value:g,onChange:e=>N(e.target.value)})}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsx)(h.z,{variant:"primary",onClick:()=>void S({date_from:v||void 0,date_to:g||void 0}),children:"Apply Filters"})})]}),b?(0,s.jsx)(u.o,{tone:"error",message:b,className:"mt-3"}):null]}),n?(0,s.jsx)(u.o,{tone:"info",message:"Loading reports..."}):0===e.length?(0,s.jsx)(o.u,{description:"No reports available yet."}):(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:e.map(e=>(0,s.jsxs)(d.W,{className:"p-6 flex flex-col justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg",children:e.title}),(0,s.jsx)("p",{className:"mt-1 text-sm text-[color:var(--color-text-muted)]",children:e.description}),(0,s.jsx)("div",{className:"mt-4 space-y-2",children:e.metrics.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-[color:var(--color-text-muted)]",children:e.label}),(0,s.jsx)("span",{className:"font-semibold",children:e.value})]},e.label))})]}),(0,s.jsx)(r.default,{href:"/hotel/reports/".concat(e.code),className:"mt-5 ui-btn ui-btn-outline ui-btn-sm ui-anim",children:"View report"})]},e.code))})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return l},E:function(){return a}});var s=n(7437),r=n(3301);function l(e){let{permission:t,children:n,fallback:l=null}=e,{permissions:a,loading:i}=(0,r.a)();return i?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let s=0;s<e.length;s+=1)if("*"!==e[s]&&e[s]!==n[s]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(a,t)?(0,s.jsx)(s.Fragment,{children:l}):(0,s.jsx)(s.Fragment,{children:n})}function a(e){let{userType:t,children:n,fallback:l=null}=e,{user:a,loading:i}=(0,r.a)();return i?null:a&&a.user_type===t?(0,s.jsx)(s.Fragment,{children:n}):(0,s.jsx)("div",{className:"auth-layout",children:(0,s.jsxs)("div",{className:"glass-card auth-card",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),l]})})}},2145:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});var s=n(7437),r=n(4839),l=n(7282);function a(e){let{title:t,description:n,rightSlot:a,count:i,countLabel:c,className:o}=e;return(0,s.jsxs)("div",{className:(0,r.Z)("ui-page-header",o),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"ui-page-title",children:t}),n?(0,s.jsx)("p",{className:"ui-page-subtitle",children:n}):null]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["number"==typeof i?(0,s.jsxs)(l.C,{variant:"accent",children:[i,c?" ".concat(c):""]}):null,a]})]})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return c},E:function(){return o}});var s=n(7437),r=n(2265),l=n(5139);let a={login:(e,t)=>(0,l.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,l.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,l.S)("/auth/logout",{method:"POST"}),me:()=>(0,l.S)("/auth/me"),startImpersonation:e=>(0,l.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,l.S)("/auth/impersonation/stop",{method:"POST"})},i=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[n,l]=(0,r.useState)(null),[c,o]=(0,r.useState)([]),[u,d]=(0,r.useState)(null),[h,m]=(0,r.useState)(null),[f,x]=(0,r.useState)(!0),p=(0,r.useCallback)(e=>{var t,n;l(e.user),o(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),m(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),v=(0,r.useCallback)(async()=>{try{let e=await a.me();p(e)}catch(e){try{let e=await a.refresh();p(e)}catch(e){l(null),o([]),d(null),m(null)}}finally{x(!1)}},[p]);(0,r.useEffect)(()=>{v()},[v]);let j=(0,r.useCallback)(async(e,t)=>{let n=await a.login(e,t);return p(n),n},[p]),g=(0,r.useCallback)(async()=>{await a.logout(),l(null),o([]),d(null),m(null)},[]),N=(0,r.useCallback)(async()=>{p(await a.refresh())},[p]),b=(0,r.useCallback)(async e=>{let t=await a.startImpersonation(e);return p(t),t},[p]),y=(0,r.useCallback)(async()=>{let e=await a.stopImpersonation();return p(e),e},[p]),S=(0,r.useMemo)(()=>({user:n,permissions:c,tenant:u,impersonation:h,loading:f,login:j,logout:g,refresh:N,startImpersonation:b,stopImpersonation:y}),[n,c,u,h,f,j,g,N,b,y]);return(0,s.jsx)(i.Provider,{value:S,children:t})}function o(){let e=(0,r.useContext)(i);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4862:function(e,t,n){"use strict";n.d(t,{y:function(){return l}});var s=n(7437),r=n(7606);function l(e){let{title:t,children:n}=e;return(0,s.jsx)(r.q,{title:t,children:n})}},22:function(e,t,n){"use strict";n.d(t,{u:function(){return l}});var s=n(7437),r=n(4631);function l(e){let{title:t="Nothing here yet",description:n}=e;return(0,s.jsxs)(r.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:t}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:n})]})}},4024:function(e,t,n){"use strict";n.d(t,{o:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{tone:t="info",message:n,className:l}=e;return(0,s.jsx)("p",{className:(0,r.Z)("ui-inline-alert","ui-inline-alert-".concat(t),l),children:n})}},7606:function(e,t,n){"use strict";n.d(t,{q:function(){return a}});var s=n(7437),r=n(4839),l=n(4631);function a(e){let{title:t,actions:n,children:a,className:i}=e;return(0,s.jsxs)(l.W,{className:(0,r.Z)("p-6 ui-reveal",i),children:[(t||n)&&(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t?(0,s.jsx)("h3",{className:"text-lg",children:t}):(0,s.jsx)("span",{}),n]}),(0,s.jsx)("div",{className:(0,r.Z)((t||n)&&"mt-4"),children:a})]})}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("glass-card",n),children:t})}},7282:function(e,t,n){"use strict";n.d(t,{C:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{variant:t="accent",className:n,children:l,...a}=e;return(0,s.jsx)("span",{className:(0,r.Z)("badge","badge-".concat(t),n),...a,children:l})}},5427:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{className:t,variant:n="secondary",size:l="md",children:a,...i}=e;return(0,s.jsx)("button",{className:(0,r.Z)("ui-btn ui-anim","ui-btn-".concat(n),"sm"===l&&"ui-btn-sm","md"===l&&"ui-btn-md","lg"===l&&"ui-btn-lg",t),...i,children:a})}},7032:function(e,t,n){"use strict";n.d(t,{g:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{label:t,required:n,hint:l,error:a,className:i,children:c}=e;return(0,s.jsxs)("div",{className:(0,r.Z)("space-y-2",i),children:[(0,s.jsxs)("label",{className:"text-sm",children:[t,n&&(0,s.jsx)("span",{className:"ml-1 text-[color:var(--color-accent)]",children:"*"})]}),c,a?(0,s.jsx)("p",{className:"text-xs text-red-400",children:a}):l?(0,s.jsx)("p",{className:"text-xs text-[color:var(--color-text-muted)]",children:l}):null]})}},6243:function(e,t,n){"use strict";n.d(t,{o:function(){return l}});var s=n(7437),r=n(4839);function l(e){let{className:t,...n}=e;return(0,s.jsx)("input",{className:(0,r.Z)("ui-input",t),...n})}},5139:function(e,t,n){"use strict";var s;n.d(t,{S:function(){return l}});let r=null!==(s=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api";async function l(e){var t,n,s;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(r).concat(e),i=new Headers(null!==(n=l.headers)&&void 0!==n?n:{}),c=null!==(s=null===(t=l.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==s?s:"GET";if("GET"!==c&&"HEAD"!==c){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&i.set("X-CSRF-Token",e),i.has("Content-Type")||i.set("Content-Type","application/json")}let o=await fetch(a,{...l,headers:i,credentials:"include"});if(!o.ok)throw Error(await o.text()||o.statusText);if(204===o.status)return;let u=await o.text();if(u)return JSON.parse(u)}},3805:function(e,t,n){"use strict";n.d(t,{h:function(){return l}});var s=n(5139);let r=e=>{let t=new URLSearchParams;Object.entries(e).forEach(e=>{let[n,s]=e;s&&t.set(n,s)});let n=t.toString();return n?"?".concat(n):""},l={list:e=>(0,s.S)("/hotel/reports".concat(r({date_from:null==e?void 0:e.date_from,date_to:null==e?void 0:e.date_to}))),get:(e,t)=>(0,s.S)("/hotel/reports/".concat(e).concat(r({date_from:null==t?void 0:t.date_from,date_to:null==t?void 0:t.date_to,status:null==t?void 0:t.status}))),export:(e,t)=>(0,s.S)("/hotel/reports/".concat(e,"/export"),{method:"POST",body:JSON.stringify(t)}),getExport:e=>(0,s.S)("/hotel/reports/exports/".concat(e))}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var s=n(1288);function r(){return(0,s.E)()}}},function(e){e.O(0,[3751,2971,7023,1744],function(){return e(e.s=352)}),_N_E=e.O()}]);