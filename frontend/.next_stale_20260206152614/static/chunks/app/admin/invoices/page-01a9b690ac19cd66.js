(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4317],{428:function(e,t,n){Promise.resolve().then(n.bind(n,8840))},8840:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var i=n(7437),a=n(2265),s=n(5854),o=n(2145),r=n(4862),c=n(6572),l=n(6053),d=n(22),u=n(4024),m=n(5205),v=n(4631),_=n(5427),h=n(7032),p=n(9465),b=n(7868),g=n(6243),x=n(3828),j=n(5139);let y={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,j.S)("/admin/invoices?page=".concat(e,"&limit=").concat(t))},create:e=>(0,j.S)("/admin/invoices",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,j.S)("/admin/invoices/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,j.S)("/admin/invoices/".concat(e),{method:"DELETE"})};var f=n(6948);let S={tenant_id:"",subscription_id:"",invoice_number:"",status:"issued",amount_cents:0,currency:"USD",issued_at:"",due_at:"",paid_at:"",notes:""},N=e=>{if(!e)return;let t=new Date(e);return isNaN(t.getTime())?void 0:t.toISOString()},C=e=>e?e.slice(0,10):"";function k(){let[e,t]=(0,a.useState)([]),[n,j]=(0,a.useState)([]),[k,w]=(0,a.useState)([]),[E,D]=(0,a.useState)(!0),[I,O]=(0,a.useState)(S),[P,T]=(0,a.useState)(null),[A,q]=(0,a.useState)(null),z=(0,a.useCallback)(async()=>{D(!0),q(null);try{let[e,n,i]=await Promise.all([y.list(1,50),x.B.list(1,100),f.J.list(1,100)]);t(e.items),j(n.items),w(i.items)}catch(e){q(e instanceof Error?e.message:"Failed to load invoices")}finally{D(!1)}},[]);(0,a.useEffect)(()=>{z()},[z]);let J=(e,t)=>{O(n=>({...n,[e]:t}))},F=()=>{O(S),T(null)},L=(0,a.useMemo)(()=>({tenant_id:I.tenant_id,subscription_id:I.subscription_id,invoice_number:I.invoice_number||void 0,status:I.status,amount_cents:Number(I.amount_cents),currency:I.currency||void 0,issued_at:N(I.issued_at),due_at:N(I.due_at),paid_at:N(I.paid_at),notes:I.notes||void 0}),[I]),U=(0,a.useMemo)(()=>({tenant_id:I.tenant_id||void 0,subscription_id:I.subscription_id||void 0,invoice_number:I.invoice_number||void 0,status:I.status||void 0,amount_cents:Number(I.amount_cents),currency:I.currency||void 0,issued_at:N(I.issued_at),due_at:N(I.due_at),paid_at:N(I.paid_at),notes:I.notes||void 0}),[I]),H=async e=>{e.preventDefault(),q(null);try{P?await y.update(P.id,U):await y.create(L),F(),await z()}catch(e){q(e instanceof Error?e.message:"Failed to save invoice")}},M=e=>{var t;T(e),O({tenant_id:e.tenant_id,subscription_id:e.subscription_id,invoice_number:e.invoice_number,status:e.status,amount_cents:e.amount_cents,currency:e.currency,issued_at:C(e.issued_at),due_at:C(e.due_at),paid_at:C(e.paid_at),notes:null!==(t=e.notes)&&void 0!==t?t:""})},B=async e=>{if(confirm("Delete invoice ".concat(e.invoice_number,"? This cannot be undone.")))try{await y.remove(e.id),await z()}catch(e){q(e instanceof Error?e.message:"Failed to delete invoice")}};return(0,i.jsx)(s.n,{permission:"admin:invoices:read",fallback:(0,i.jsxs)(v.W,{className:"p-6",children:[(0,i.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,i.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view invoices."})]}),children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(o.m,{title:"Invoices",description:"Issue invoices for hotel subscriptions and track billing status.",count:e.length,countLabel:"Invoices"}),(0,i.jsx)(s.n,{permission:P?"admin:invoices:update":"admin:invoices:create",children:(0,i.jsx)(r.y,{title:P?"Edit Invoice":"Create Invoice",children:(0,i.jsxs)("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:H,children:[(0,i.jsx)(h.g,{label:"Hotel",required:!0,children:(0,i.jsxs)(p.l,{value:I.tenant_id,onChange:e=>J("tenant_id",e.target.value),required:!0,children:[(0,i.jsx)("option",{value:"",children:"Select hotel"}),n.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,i.jsx)(h.g,{label:"Subscription",required:!0,children:(0,i.jsxs)(p.l,{value:I.subscription_id,onChange:e=>J("subscription_id",e.target.value),required:!0,children:[(0,i.jsx)("option",{value:"",children:"Select subscription"}),k.map(e=>{var t,n,a;return(0,i.jsxs)("option",{value:e.id,children:[null!==(t=e.tenant_name)&&void 0!==t?t:e.tenant_id," -"," ",null!==(a=null!==(n=e.plan_name)&&void 0!==n?n:e.plan_code)&&void 0!==a?a:e.plan_id]},e.id)})]})}),(0,i.jsx)(h.g,{label:"Invoice Number",children:(0,i.jsx)(g.o,{value:I.invoice_number,onChange:e=>J("invoice_number",e.target.value),placeholder:"INV-0001"})}),(0,i.jsx)(h.g,{label:"Status",children:(0,i.jsx)(g.o,{value:I.status,onChange:e=>J("status",e.target.value),placeholder:"issued"})}),(0,i.jsx)(h.g,{label:"Amount (cents)",required:!0,children:(0,i.jsx)(g.o,{type:"number",min:0,value:I.amount_cents,onChange:e=>J("amount_cents",Number(e.target.value)),placeholder:"9900",required:!0})}),(0,i.jsx)(h.g,{label:"Currency",children:(0,i.jsx)(g.o,{value:I.currency,onChange:e=>J("currency",e.target.value),placeholder:"USD"})}),(0,i.jsx)(h.g,{label:"Issued At",children:(0,i.jsx)(g.o,{type:"date",value:I.issued_at,onChange:e=>J("issued_at",e.target.value)})}),(0,i.jsx)(h.g,{label:"Due At",children:(0,i.jsx)(g.o,{type:"date",value:I.due_at,onChange:e=>J("due_at",e.target.value)})}),(0,i.jsx)(h.g,{label:"Paid At",children:(0,i.jsx)(g.o,{type:"date",value:I.paid_at,onChange:e=>J("paid_at",e.target.value)})}),(0,i.jsx)(h.g,{label:"Notes",className:"md:col-span-2",children:(0,i.jsx)(b.F,{value:I.notes,onChange:e=>J("notes",e.target.value),rows:3,placeholder:"Optional internal notes"})}),(0,i.jsxs)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:[(0,i.jsx)(_.z,{type:"submit",variant:"primary",children:P?"Save Changes":"Create Invoice"}),P?(0,i.jsx)(_.z,{type:"button",variant:"secondary",onClick:F,children:"Cancel"}):null]})]})})}),A?(0,i.jsx)(u.o,{tone:"error",message:A}):null,E?(0,i.jsx)(u.o,{tone:"info",message:"Loading invoices..."}):0===e.length?(0,i.jsx)(d.u,{description:"No invoices created yet."}):(0,i.jsx)(l.r,{title:"Invoice Directory",table:(0,i.jsx)(c.w,{columns:[{key:"invoice",header:"Invoice",cellClassName:"font-medium",render:e=>e.invoice_number},{key:"hotel",header:"Hotel",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.tenant_name)&&void 0!==t?t:e.tenant_id}},{key:"plan",header:"Plan",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t,n;return null!==(n=null!==(t=e.plan_name)&&void 0!==t?t:e.plan_code)&&void 0!==n?n:"-"}},{key:"amount",header:"Amount",render:e=>"".concat((e.amount_cents/100).toFixed(2)," ").concat(e.currency)},{key:"status",header:"Status",render:e=>e.status},{key:"due",header:"Due",render:e=>e.due_at?new Date(e.due_at).toLocaleDateString():"-"},{key:"actions",header:"Actions",render:e=>(0,i.jsxs)(m.l,{children:[(0,i.jsx)(s.n,{permission:"admin:invoices:update",children:(0,i.jsx)(_.z,{size:"sm",variant:"outline",onClick:()=>M(e),children:"Edit"})}),(0,i.jsx)(s.n,{permission:"admin:invoices:delete",children:(0,i.jsx)(_.z,{size:"sm",variant:"danger",onClick:()=>void B(e),children:"Delete"})})]})}],rows:e,rowKey:e=>e.id})})]})})}},6948:function(e,t,n){"use strict";n.d(t,{J:function(){return a}});var i=n(5139);let a={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,i.S)("/admin/subscriptions?page=".concat(e,"&limit=").concat(t))},get:e=>(0,i.S)("/admin/subscriptions/".concat(e)),create:e=>(0,i.S)("/admin/subscriptions",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,i.S)("/admin/subscriptions/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,i.S)("/admin/subscriptions/".concat(e),{method:"DELETE"})}}},function(e){e.O(0,[9898,2971,7023,1744],function(){return e(e.s=428)}),_N_E=e.O()}]);