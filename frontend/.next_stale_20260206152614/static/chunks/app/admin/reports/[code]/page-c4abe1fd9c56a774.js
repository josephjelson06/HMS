(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4724],{1388:function(e,t,r){Promise.resolve().then(r.bind(r,325))},325:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var n,s=r(7437),l=r(2265),a=r(6463),o=r(5854),i=r(4631),c=r(2275);let u=null!==(n=r(357).env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:8000/api",d=e=>new Promise(t=>setTimeout(t,e));function m(){var e;let t=(0,a.useParams)().code,[r,n]=(0,l.useState)(null),[m,h]=(0,l.useState)(!0),[f,p]=(0,l.useState)(""),[x,v]=(0,l.useState)(""),[g,y]=(0,l.useState)(""),[j,b]=(0,l.useState)(null),[N,w]=(0,l.useState)(null),[S,T]=(0,l.useState)("csv"),[_,k]=(0,l.useState)(!1),C=(0,l.useCallback)(async(e,t)=>{if(e){h(!0),b(null);try{let r=await c.y.get(e,t);n(r)}catch(e){b(e instanceof Error?e.message:"Failed to load report")}finally{h(!1)}}},[]);(0,l.useEffect)(()=>{t&&C(t)},[C,t]);let E=async()=>{if(t){b(null),k(!0);try{let e=await c.y.export(t,{format:S,date_from:f||void 0,date_to:x||void 0,status:g||void 0});if(w(e),"pending"===e.status||"processing"===e.status)for(let t=0;t<60;t+=1){await d(1e3);let t=await c.y.getExport(e.id);if(w(t),"completed"===t.status||"failed"===t.status)break}}catch(e){b(e instanceof Error?e.message:"Failed to export report")}finally{k(!1)}}},P=(0,l.useMemo)(()=>(null==N?void 0:N.download_path)?"".concat(u).concat(N.download_path):null,[N]);return(0,s.jsx)(o.n,{permission:"admin:reports:read",fallback:(0,s.jsxs)(i.W,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have permission to view this report."})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl",children:null!==(e=null==r?void 0:r.title)&&void 0!==e?e:"Report"}),(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:null==r?void 0:r.description})]}),(0,s.jsxs)(i.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Filters"}),(0,s.jsxs)("div",{className:"mt-4 flex flex-wrap gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"From"}),(0,s.jsx)("input",{type:"date",value:f,onChange:e=>p(e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"To"}),(0,s.jsx)("input",{type:"date",value:x,onChange:e=>v(e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Status"}),(0,s.jsx)("input",{value:g,onChange:e=>y(e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"optional"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Export Format"}),(0,s.jsxs)("select",{value:S,onChange:e=>T(e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",children:[(0,s.jsx)("option",{value:"csv",children:"CSV"}),(0,s.jsx)("option",{value:"pdf",children:"PDF"}),(0,s.jsx)("option",{value:"excel",children:"Excel"})]})]}),(0,s.jsxs)("div",{className:"flex items-end gap-3",children:[(0,s.jsx)("button",{className:"rounded-xl bg-[color:var(--accent)] px-6 py-3 text-sm font-semibold text-black shadow-glow",onClick:()=>void C(t,{date_from:f||void 0,date_to:x||void 0,status:g||void 0}),children:"Apply"}),(0,s.jsx)(o.n,{permission:"admin:reports:export",children:(0,s.jsx)("button",{className:"rounded-xl border border-white/20 px-6 py-3 text-sm",onClick:()=>void E(),disabled:_,children:_?"Queuing...":"Request Export"})})]})]}),N&&(0,s.jsxs)("div",{className:"mt-3 space-y-1 text-sm",children:[(0,s.jsxs)("p",{children:["Export status: ",(0,s.jsx)("span",{className:"font-semibold capitalize",children:N.status})," ","(",N.export_format.toUpperCase(),")"]}),P&&(0,s.jsxs)("p",{children:["File ready:"," ",(0,s.jsxs)("a",{className:"underline",href:P,target:"_blank",rel:"noreferrer",children:["Download ",N.export_format.toUpperCase()]})]}),"failed"===N.status&&N.error_message&&(0,s.jsx)("p",{className:"text-red-400",children:N.error_message})]}),j&&(0,s.jsx)("p",{className:"mt-3 text-sm text-red-400",children:j})]}),m?(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Loading report..."}):r?(0,s.jsxs)("div",{className:"space-y-4",children:[r.summary.length>0&&(0,s.jsxs)(i.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Summary"}),(0,s.jsx)("div",{className:"mt-4 grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:r.summary.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-[color:var(--muted)]",children:e.label}),(0,s.jsx)("span",{className:"font-semibold",children:e.value})]},e.label))})]}),r.columns.length>0?(0,s.jsxs)(i.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Report Data"}),0===r.rows.length?(0,s.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No data for the selected filters."}):(0,s.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"text-left text-[color:var(--muted)]",children:(0,s.jsx)("tr",{children:r.columns.map(e=>(0,s.jsx)("th",{className:"pb-3",children:e.label},e.key))})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/10",children:r.rows.map((e,t)=>(0,s.jsx)("tr",{children:r.columns.map(t=>{var r;return(0,s.jsx)("td",{className:"py-3",children:null!==(r=e[t.key])&&void 0!==r?r:"-"},t.key)})},t))})]})})]}):(0,s.jsx)(i.W,{className:"p-6",children:(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"This report provides summary metrics only."})})]}):null]})})}},5854:function(e,t,r){"use strict";r.d(t,{n:function(){return l},E:function(){return a}});var n=r(7437),s=r(3301);function l(e){let{permission:t,children:r,fallback:l=null}=e,{permissions:a,loading:o}=(0,s.a)();return o?null:!function(e,t){if(e.includes(t))return!0;let r=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===r.length){let t=!0;for(let n=0;n<e.length;n+=1)if("*"!==e[n]&&e[n]!==r[n]){t=!1;break}if(t)return!0}if(e.length<r.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===r.slice(0,e.length-1).join(":"))return!0}return!1}(a,t)?(0,n.jsx)(n.Fragment,{children:l}):(0,n.jsx)(n.Fragment,{children:r})}function a(e){let{userType:t,children:r,fallback:l=null}=e,{user:a,loading:o}=(0,s.a)();return o?null:a&&a.user_type===t?(0,n.jsx)(n.Fragment,{children:r}):(0,n.jsx)("div",{className:"auth-layout",children:(0,n.jsxs)("div",{className:"glass-card auth-card",children:[(0,n.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),l]})})}},1288:function(e,t,r){"use strict";r.d(t,{H:function(){return i},E:function(){return c}});var n=r(7437),s=r(2265),l=r(5139);let a={login:(e,t)=>(0,l.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,l.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,l.S)("/auth/logout",{method:"POST"}),me:()=>(0,l.S)("/auth/me"),startImpersonation:e=>(0,l.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,l.S)("/auth/impersonation/stop",{method:"POST"})},o=(0,s.createContext)(void 0);function i(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[i,c]=(0,s.useState)([]),[u,d]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[f,p]=(0,s.useState)(!0),x=(0,s.useCallback)(e=>{var t,r;l(e.user),c(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),h(null!==(r=e.impersonation)&&void 0!==r?r:null)},[]),v=(0,s.useCallback)(async()=>{try{let e=await a.me();x(e)}catch(e){try{let e=await a.refresh();x(e)}catch(e){l(null),c([]),d(null),h(null)}}finally{p(!1)}},[x]);(0,s.useEffect)(()=>{v()},[v]);let g=(0,s.useCallback)(async(e,t)=>{let r=await a.login(e,t);return x(r),r},[x]),y=(0,s.useCallback)(async()=>{await a.logout(),l(null),c([]),d(null),h(null)},[]),j=(0,s.useCallback)(async()=>{x(await a.refresh())},[x]),b=(0,s.useCallback)(async e=>{let t=await a.startImpersonation(e);return x(t),t},[x]),N=(0,s.useCallback)(async()=>{let e=await a.stopImpersonation();return x(e),e},[x]),w=(0,s.useMemo)(()=>({user:r,permissions:i,tenant:u,impersonation:m,loading:f,login:g,logout:y,refresh:j,startImpersonation:b,stopImpersonation:N}),[r,i,u,m,f,g,y,j,b,N]);return(0,n.jsx)(o.Provider,{value:w,children:t})}function c(){let e=(0,s.useContext)(o);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4631:function(e,t,r){"use strict";r.d(t,{W:function(){return l}});var n=r(7437),s=r(4839);function l(e){let{children:t,className:r}=e;return(0,n.jsx)("div",{className:(0,s.Z)("glass-card",r),children:t})}},2275:function(e,t,r){"use strict";r.d(t,{y:function(){return l}});var n=r(5139);let s=e=>{let t=new URLSearchParams;Object.entries(e).forEach(e=>{let[r,n]=e;n&&t.set(r,n)});let r=t.toString();return r?"?".concat(r):""},l={list:e=>(0,n.S)("/admin/reports".concat(s({date_from:null==e?void 0:e.date_from,date_to:null==e?void 0:e.date_to}))),get:(e,t)=>(0,n.S)("/admin/reports/".concat(e).concat(s({date_from:null==t?void 0:t.date_from,date_to:null==t?void 0:t.date_to,status:null==t?void 0:t.status}))),export:(e,t)=>(0,n.S)("/admin/reports/".concat(e,"/export"),{method:"POST",body:JSON.stringify(t)}),getExport:e=>(0,n.S)("/admin/reports/exports/".concat(e))}},5139:function(e,t,r){"use strict";var n;r.d(t,{S:function(){return l}});let s=null!==(n=r(357).env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:8000/api";async function l(e){var t,r,n;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(s).concat(e),o=new Headers(null!==(r=l.headers)&&void 0!==r?r:{}),i=null!==(n=null===(t=l.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==n?n:"GET";if("GET"!==i&&"HEAD"!==i){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&o.set("X-CSRF-Token",e),o.has("Content-Type")||o.set("Content-Type","application/json")}let c=await fetch(a,{...l,headers:o,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let u=await c.text();if(u)return JSON.parse(u)}},3301:function(e,t,r){"use strict";r.d(t,{a:function(){return s}});var n=r(1288);function s(){return(0,n.E)()}},6463:function(e,t,r){"use strict";var n=r(1169);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},357:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(8081)},8081:function(e){!function(){var t={229:function(e){var t,r,n,s=e.exports={};function l(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var i=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?i=n.concat(i):u=-1,i.length&&m())}function m(){if(!c){var e=o(d);c=!0;for(var t=i.length;t;){for(n=i,i=[];++u<t;)n&&n[u].run();u=-1,t=i.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.push(new h(e,t)),1!==i.length||c||o(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var l=r[e]={exports:{}},a=!0;try{t[e](l,l.exports,n),a=!1}finally{a&&delete r[e]}return l.exports}n.ab="//";var s=n(229);e.exports=s}()},4839:function(e,t,r){"use strict";t.Z=function(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=function e(t){var r,n,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(r=0;r<l;r++)t[r]&&(n=e(t[r]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n)}return s}(e))&&(n&&(n+=" "),n+=t);return n}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=1388)}),_N_E=e.O()}]);