(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7719],{658:function(e,t,n){Promise.resolve().then(n.bind(n,3630))},3630:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var r=n(7437),s=n(2265),i=n(6463),a=n(5854),l=n(2145),o=n(4862),u=n(6572),c=n(6053),d=n(22),h=n(4024),f=n(5205),m=n(4631),p=n(5427),x=n(7032),v=n(6243),g=n(3828),j=n(3301);let y={name:"",slug:"",status:"active",subscription_tier:""};function b(){let e=(0,i.useRouter)(),{startImpersonation:t}=(0,j.a)(),[n,b]=(0,s.useState)([]),[N,w]=(0,s.useState)(!0),[S,C]=(0,s.useState)(y),[T,k]=(0,s.useState)(null),[E,_]=(0,s.useState)(null),[O,P]=(0,s.useState)(null),Z=(0,s.useCallback)(async()=>{w(!0),P(null);try{let e=await g.B.list(1,50);b(e.items)}catch(e){P(e instanceof Error?e.message:"Failed to load hotels")}finally{w(!1)}},[]);(0,s.useEffect)(()=>{Z()},[Z]);let A=(e,t)=>{C(n=>({...n,[e]:t}))},H=()=>{C(y),k(null)},L=(0,s.useMemo)(()=>({name:S.name,slug:S.slug||void 0,status:S.status||void 0,subscription_tier:S.subscription_tier||void 0}),[S]),z=async e=>{e.preventDefault(),P(null);try{T?await g.B.update(T.id,L):await g.B.create(L),H(),await Z()}catch(e){P(e instanceof Error?e.message:"Failed to save hotel")}},F=e=>{var t;k(e),C({name:e.name,slug:e.slug,status:e.status,subscription_tier:null!==(t=e.subscription_tier)&&void 0!==t?t:""})},I=async e=>{if(confirm("Delete ".concat(e.name,"? This cannot be undone.")))try{await g.B.remove(e.id),await Z()}catch(e){P(e instanceof Error?e.message:"Failed to delete hotel")}},R=async n=>{if(confirm("Start impersonation for ".concat(n.name,"?"))){P(null),_(n.id);try{await t({tenant_id:n.id}),e.push("/hotel/dashboard")}catch(e){P(e instanceof Error?e.message:"Failed to start impersonation"),_(null)}}};return(0,r.jsx)(a.n,{permission:"admin:hotels:read",fallback:(0,r.jsxs)(m.W,{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view the hotel registry."})]}),children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(l.m,{title:"Hotel Registry",description:"Manage tenants and onboard new hotels to the platform.",count:n.length,countLabel:"Hotels"}),(0,r.jsx)(a.n,{permission:T?"admin:hotels:update":"admin:hotels:create",children:(0,r.jsx)(o.y,{title:T?"Edit Hotel":"Add Hotel",children:(0,r.jsxs)("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:z,children:[(0,r.jsx)(x.g,{label:"Hotel Name",required:!0,children:(0,r.jsx)(v.o,{value:S.name,onChange:e=>A("name",e.target.value),placeholder:"Oceanview Suites"})}),(0,r.jsx)(x.g,{label:"Slug",children:(0,r.jsx)(v.o,{value:S.slug,onChange:e=>A("slug",e.target.value),placeholder:"oceanview-suites"})}),(0,r.jsx)(x.g,{label:"Status",children:(0,r.jsx)(v.o,{value:S.status,onChange:e=>A("status",e.target.value),placeholder:"active"})}),(0,r.jsx)(x.g,{label:"Subscription Tier",children:(0,r.jsx)(v.o,{value:S.subscription_tier,onChange:e=>A("subscription_tier",e.target.value),placeholder:"premium"})}),(0,r.jsxs)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:[(0,r.jsx)(p.z,{type:"submit",variant:"primary",children:T?"Save Changes":"Create Hotel"}),T?(0,r.jsx)(p.z,{type:"button",variant:"secondary",onClick:H,children:"Cancel"}):null]})]})})}),O?(0,r.jsx)(h.o,{tone:"error",message:O}):null,N?(0,r.jsx)(h.o,{tone:"info",message:"Loading hotels..."}):0===n.length?(0,r.jsx)(d.u,{description:"No hotels created yet."}):(0,r.jsx)(c.r,{title:"Hotel Directory",table:(0,r.jsx)(u.w,{columns:[{key:"name",header:"Name",cellClassName:"font-medium",render:e=>e.name},{key:"slug",header:"Slug",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>e.slug},{key:"status",header:"Status",render:e=>e.status},{key:"tier",header:"Tier",render:e=>{var t;return null!==(t=e.subscription_tier)&&void 0!==t?t:"-"}},{key:"actions",header:"Actions",render:e=>(0,r.jsxs)(f.l,{children:[(0,r.jsx)(a.n,{permission:"admin:hotels:update",children:(0,r.jsx)(p.z,{size:"sm",variant:"outline",onClick:()=>F(e),children:"Edit"})}),(0,r.jsx)(a.n,{permission:"admin:hotels:delete",children:(0,r.jsx)(p.z,{size:"sm",variant:"danger",onClick:()=>void I(e),children:"Delete"})}),(0,r.jsx)(a.n,{permission:"admin:impersonation:start",children:(0,r.jsx)(p.z,{size:"sm",variant:"secondary",onClick:()=>void R(e),disabled:E===e.id,children:E===e.id?"Starting...":"Impersonate"})})]})}],rows:n,rowKey:e=>e.id})})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return i},E:function(){return a}});var r=n(7437),s=n(3301);function i(e){let{permission:t,children:n,fallback:i=null}=e,{permissions:a,loading:l}=(0,s.a)();return l?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let r=0;r<e.length;r+=1)if("*"!==e[r]&&e[r]!==n[r]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(a,t)?(0,r.jsx)(r.Fragment,{children:i}):(0,r.jsx)(r.Fragment,{children:n})}function a(e){let{userType:t,children:n,fallback:i=null}=e,{user:a,loading:l}=(0,s.a)();return l?null:a&&a.user_type===t?(0,r.jsx)(r.Fragment,{children:n}):(0,r.jsx)("div",{className:"auth-layout",children:(0,r.jsxs)("div",{className:"glass-card auth-card",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),i]})})}},2145:function(e,t,n){"use strict";n.d(t,{m:function(){return a}});var r=n(7437),s=n(4839),i=n(7282);function a(e){let{title:t,description:n,rightSlot:a,count:l,countLabel:o,className:u}=e;return(0,r.jsxs)("div",{className:(0,s.Z)("ui-page-header",u),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"ui-page-title",children:t}),n?(0,r.jsx)("p",{className:"ui-page-subtitle",children:n}):null]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:["number"==typeof l?(0,r.jsxs)(i.C,{variant:"accent",children:[l,o?" ".concat(o):""]}):null,a]})]})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return o},E:function(){return u}});var r=n(7437),s=n(2265),i=n(5139);let a={login:(e,t)=>(0,i.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,i.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,i.S)("/auth/logout",{method:"POST"}),me:()=>(0,i.S)("/auth/me"),startImpersonation:e=>(0,i.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,i.S)("/auth/impersonation/stop",{method:"POST"})},l=(0,s.createContext)(void 0);function o(e){let{children:t}=e,[n,i]=(0,s.useState)(null),[o,u]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),[h,f]=(0,s.useState)(null),[m,p]=(0,s.useState)(!0),x=(0,s.useCallback)(e=>{var t,n;i(e.user),u(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),f(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),v=(0,s.useCallback)(async()=>{try{let e=await a.me();x(e)}catch(e){try{let e=await a.refresh();x(e)}catch(e){i(null),u([]),d(null),f(null)}}finally{p(!1)}},[x]);(0,s.useEffect)(()=>{v()},[v]);let g=(0,s.useCallback)(async(e,t)=>{let n=await a.login(e,t);return x(n),n},[x]),j=(0,s.useCallback)(async()=>{await a.logout(),i(null),u([]),d(null),f(null)},[]),y=(0,s.useCallback)(async()=>{x(await a.refresh())},[x]),b=(0,s.useCallback)(async e=>{let t=await a.startImpersonation(e);return x(t),t},[x]),N=(0,s.useCallback)(async()=>{let e=await a.stopImpersonation();return x(e),e},[x]),w=(0,s.useMemo)(()=>({user:n,permissions:o,tenant:c,impersonation:h,loading:m,login:g,logout:j,refresh:y,startImpersonation:b,stopImpersonation:N}),[n,o,c,h,m,g,j,y,b,N]);return(0,r.jsx)(l.Provider,{value:w,children:t})}function u(){let e=(0,s.useContext)(l);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4862:function(e,t,n){"use strict";n.d(t,{y:function(){return i}});var r=n(7437),s=n(7606);function i(e){let{title:t,children:n}=e;return(0,r.jsx)(s.q,{title:t,children:n})}},6572:function(e,t,n){"use strict";n.d(t,{w:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{columns:t,rows:n,rowKey:i,emptyFallback:a=null,className:l}=e;return 0===n.length?(0,r.jsx)(r.Fragment,{children:a}):(0,r.jsxs)("table",{className:(0,s.Z)("ui-table",l),children:[(0,r.jsx)("thead",{children:(0,r.jsx)("tr",{children:t.map(e=>(0,r.jsx)("th",{className:(0,s.Z)("pb-3",e.headerClassName),children:e.header},e.key))})}),(0,r.jsx)("tbody",{children:n.map((e,n)=>(0,r.jsx)("tr",{children:t.map(t=>(0,r.jsx)("td",{className:(0,s.Z)("py-3",t.cellClassName),children:t.render(e,n)},t.key))},i(e,n)))})]})}},6053:function(e,t,n){"use strict";n.d(t,{r:function(){return a}});var r=n(7437),s=n(6430),i=n(7606);function a(e){let{title:t,table:n,footer:a}=e;return(0,r.jsxs)(i.q,{title:t,children:[(0,r.jsx)(s.K,{children:n}),a?(0,r.jsx)("div",{className:"mt-3",children:a}):null]})}},22:function(e,t,n){"use strict";n.d(t,{u:function(){return i}});var r=n(7437),s=n(4631);function i(e){let{title:t="Nothing here yet",description:n}=e;return(0,r.jsxs)(s.W,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg",children:t}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:n})]})}},4024:function(e,t,n){"use strict";n.d(t,{o:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{tone:t="info",message:n,className:i}=e;return(0,r.jsx)("p",{className:(0,s.Z)("ui-inline-alert","ui-inline-alert-".concat(t),i),children:n})}},6430:function(e,t,n){"use strict";n.d(t,{K:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,s.Z)("ui-table-wrap",n),children:t})}},7606:function(e,t,n){"use strict";n.d(t,{q:function(){return a}});var r=n(7437),s=n(4839),i=n(4631);function a(e){let{title:t,actions:n,children:a,className:l}=e;return(0,r.jsxs)(i.W,{className:(0,s.Z)("p-6 ui-reveal",l),children:[(t||n)&&(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t?(0,r.jsx)("h3",{className:"text-lg",children:t}):(0,r.jsx)("span",{}),n]}),(0,r.jsx)("div",{className:(0,s.Z)((t||n)&&"mt-4"),children:a})]})}},5205:function(e,t,n){"use strict";n.d(t,{l:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,s.Z)("flex flex-wrap gap-2",n),children:t})}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,s.Z)("glass-card",n),children:t})}},7282:function(e,t,n){"use strict";n.d(t,{C:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{variant:t="accent",className:n,children:i,...a}=e;return(0,r.jsx)("span",{className:(0,s.Z)("badge","badge-".concat(t),n),...a,children:i})}},5427:function(e,t,n){"use strict";n.d(t,{z:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{className:t,variant:n="secondary",size:i="md",children:a,...l}=e;return(0,r.jsx)("button",{className:(0,s.Z)("ui-btn ui-anim","ui-btn-".concat(n),"sm"===i&&"ui-btn-sm","md"===i&&"ui-btn-md","lg"===i&&"ui-btn-lg",t),...l,children:a})}},7032:function(e,t,n){"use strict";n.d(t,{g:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{label:t,required:n,hint:i,error:a,className:l,children:o}=e;return(0,r.jsxs)("div",{className:(0,s.Z)("space-y-2",l),children:[(0,r.jsxs)("label",{className:"text-sm",children:[t,n&&(0,r.jsx)("span",{className:"ml-1 text-[color:var(--color-accent)]",children:"*"})]}),o,a?(0,r.jsx)("p",{className:"text-xs text-red-400",children:a}):i?(0,r.jsx)("p",{className:"text-xs text-[color:var(--color-text-muted)]",children:i}):null]})}},6243:function(e,t,n){"use strict";n.d(t,{o:function(){return i}});var r=n(7437),s=n(4839);function i(e){let{className:t,...n}=e;return(0,r.jsx)("input",{className:(0,s.Z)("ui-input",t),...n})}},3828:function(e,t,n){"use strict";n.d(t,{B:function(){return s}});var r=n(5139);let s={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,r.S)("/admin/hotels?page=".concat(e,"&limit=").concat(t))},get:e=>(0,r.S)("/admin/hotels/".concat(e)),create:e=>(0,r.S)("/admin/hotels",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,r.S)("/admin/hotels/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,r.S)("/admin/hotels/".concat(e),{method:"DELETE"})}},5139:function(e,t,n){"use strict";var r;n.d(t,{S:function(){return i}});let s=null!==(r=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:8000/api";async function i(e){var t,n,r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(s).concat(e),l=new Headers(null!==(n=i.headers)&&void 0!==n?n:{}),o=null!==(r=null===(t=i.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==r?r:"GET";if("GET"!==o&&"HEAD"!==o){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&l.set("X-CSRF-Token",e),l.has("Content-Type")||l.set("Content-Type","application/json")}let u=await fetch(a,{...i,headers:l,credentials:"include"});if(!u.ok)throw Error(await u.text()||u.statusText);if(204===u.status)return;let c=await u.text();if(c)return JSON.parse(c)}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return s}});var r=n(1288);function s(){return(0,r.E)()}},6463:function(e,t,n){"use strict";var r=n(1169);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},357:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function i(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var o=[],u=!1,c=-1;function d(){u&&r&&(u=!1,r.length?o=r.concat(o):c=-1,o.length&&h())}function h(){if(!u){var e=l(d);u=!0;for(var t=o.length;t;){for(r=o,o=[];++c<t;)r&&r[c].run();c=-1,t=o.length}r=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new f(e,t)),1!==o.length||u||l(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={exports:{}},a=!0;try{t[e](i,i.exports,r),a=!1}finally{a&&delete n[e]}return i.exports}r.ab="//";var s=r(229);e.exports=s}()},4839:function(e,t,n){"use strict";t.Z=function(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=function e(t){var n,r,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t)){var i=t.length;for(n=0;n<i;n++)t[n]&&(r=e(t[n]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r)}return s}(e))&&(r&&(r+=" "),r+=t);return r}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=658)}),_N_E=e.O()}]);