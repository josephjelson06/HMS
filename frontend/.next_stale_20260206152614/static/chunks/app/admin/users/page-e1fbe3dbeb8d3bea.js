(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9674],{3283:function(e,t,s){Promise.resolve().then(s.bind(s,2573))},2573:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var n=s(7437),r=s(2265),a=s(5854),l=s(4631),i=s(2312);let o={email:"",password:"",first_name:"",last_name:"",role_id:"",is_active:!0};function c(){let[e,t]=(0,r.useState)([]),[s,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(!0),[m,h]=(0,r.useState)(o),[f,x]=(0,r.useState)(null),[p,v]=(0,r.useState)(null),g=async()=>{d(!0);try{let[e,s]=await Promise.all([i.x.list(1,50),i.x.roles()]);t(e.items),c(s)}catch(e){v(e instanceof Error?e.message:"Failed to load users")}finally{d(!1)}};(0,r.useEffect)(()=>{g()},[]);let j=(e,t)=>{h(s=>({...s,[e]:t}))},y=()=>{h(o),x(null)},b=(0,r.useMemo)(()=>({email:m.email,password:m.password||void 0,first_name:m.first_name||void 0,last_name:m.last_name||void 0,role_id:m.role_id,is_active:m.is_active}),[m]),w=async e=>{e.preventDefault(),v(null);try{if(f)await i.x.update(f.id,b);else{if(!b.password){v("Password is required for new users");return}await i.x.create({email:b.email,password:b.password,first_name:b.first_name,last_name:b.last_name,role_id:b.role_id,is_active:b.is_active})}y(),await g()}catch(e){v(e instanceof Error?e.message:"Failed to save user")}},N=e=>{var t,n,r;let a=s.find(t=>t.name===e.roles[0]);x(e),h({email:e.email,password:"",first_name:null!==(t=e.first_name)&&void 0!==t?t:"",last_name:null!==(n=e.last_name)&&void 0!==n?n:"",role_id:null!==(r=null==a?void 0:a.id)&&void 0!==r?r:"",is_active:e.is_active})},_=async e=>{if(confirm("Delete ".concat(e.email,"? This cannot be undone.")))try{await i.x.remove(e.id),await g()}catch(e){v(e instanceof Error?e.message:"Failed to delete user")}};return(0,n.jsx)(a.n,{permission:"admin:users:read",fallback:(0,n.jsxs)(l.W,{className:"p-6",children:[(0,n.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have permission to view admin users."})]}),children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl",children:"Admin Users"}),(0,n.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Manage platform administrators and their roles."})]}),(0,n.jsxs)("span",{className:"badge",children:[e.length," Users"]})]}),(0,n.jsx)(a.n,{permission:f?"admin:users:update":"admin:users:create",children:(0,n.jsxs)(l.W,{className:"p-6",children:[(0,n.jsx)("h3",{className:"text-lg",children:f?"Edit Admin User":"Add Admin User"}),(0,n.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:w,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Email"}),(0,n.jsx)("input",{value:m.email,onChange:e=>j("email",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"admin@company.com",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"text-sm",children:["Password ",f?"(optional)":""]}),(0,n.jsx)("input",{value:m.password,onChange:e=>j("password",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:f?"Leave blank to keep":"••••••••",type:"password"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"First Name"}),(0,n.jsx)("input",{value:m.first_name,onChange:e=>j("first_name",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"Alex"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Last Name"}),(0,n.jsx)("input",{value:m.last_name,onChange:e=>j("last_name",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"Morgan"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Role"}),(0,n.jsxs)("select",{value:m.role_id,onChange:e=>j("role_id",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select a role"}),s.map(e=>(0,n.jsx)("option",{value:e.id,children:e.display_name},e.id))]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:m.is_active,onChange:e=>j("is_active",e.target.checked)}),(0,n.jsx)("span",{className:"text-sm",children:"Active"})]}),(0,n.jsxs)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:[(0,n.jsx)("button",{type:"submit",className:"rounded-xl bg-[color:var(--accent)] px-6 py-3 text-sm font-semibold text-black shadow-glow",children:f?"Save Changes":"Create User"}),f&&(0,n.jsx)("button",{type:"button",className:"rounded-xl border border-white/20 px-6 py-3 text-sm",onClick:y,children:"Cancel"})]})]})]})}),(0,n.jsxs)(l.W,{className:"p-6",children:[(0,n.jsx)("h3",{className:"text-lg",children:"Admin Directory"}),p&&(0,n.jsx)("p",{className:"mt-2 text-sm text-red-400",children:p}),u?(0,n.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"Loading users..."}):0===e.length?(0,n.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No admin users yet."}):(0,n.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{className:"text-left text-[color:var(--muted)]",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"pb-3",children:"Email"}),(0,n.jsx)("th",{className:"pb-3",children:"Name"}),(0,n.jsx)("th",{className:"pb-3",children:"Role"}),(0,n.jsx)("th",{className:"pb-3",children:"Status"}),(0,n.jsx)("th",{className:"pb-3",children:"Actions"})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-white/10",children:e.map(e=>{var t;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"py-3 font-medium",children:e.email}),(0,n.jsx)("td",{className:"py-3",children:[e.first_name,e.last_name].filter(Boolean).join(" ")||"—"}),(0,n.jsx)("td",{className:"py-3",children:null!==(t=e.roles[0])&&void 0!==t?t:"—"}),(0,n.jsx)("td",{className:"py-3",children:e.is_active?"Active":"Inactive"}),(0,n.jsxs)("td",{className:"py-3 flex flex-wrap gap-2",children:[(0,n.jsx)(a.n,{permission:"admin:users:update",children:(0,n.jsx)("button",{className:"rounded-full border border-white/20 px-3 py-1 text-xs",onClick:()=>N(e),children:"Edit"})}),(0,n.jsx)(a.n,{permission:"admin:users:delete",children:(0,n.jsx)("button",{className:"rounded-full border border-red-400/40 px-3 py-1 text-xs text-red-300",onClick:()=>_(e),children:"Delete"})})]})]},e.id)})})]})})]})]})})}},5854:function(e,t,s){"use strict";s.d(t,{n:function(){return a},E:function(){return l}});var n=s(7437),r=s(3301);function a(e){let{permission:t,children:s,fallback:a=null}=e,{permissions:l,loading:i}=(0,r.a)();return i?null:!function(e,t){if(e.includes(t))return!0;let s=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===s.length){let t=!0;for(let n=0;n<e.length;n+=1)if("*"!==e[n]&&e[n]!==s[n]){t=!1;break}if(t)return!0}if(e.length<s.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===s.slice(0,e.length-1).join(":"))return!0}return!1}(l,t)?(0,n.jsx)(n.Fragment,{children:a}):(0,n.jsx)(n.Fragment,{children:s})}function l(e){let{userType:t,children:s,fallback:a=null}=e,{user:l,loading:i}=(0,r.a)();return i?null:l&&l.user_type===t?(0,n.jsx)(n.Fragment,{children:s}):(0,n.jsx)("div",{className:"auth-layout",children:(0,n.jsxs)("div",{className:"glass-card auth-card",children:[(0,n.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),a]})})}},1288:function(e,t,s){"use strict";s.d(t,{H:function(){return o},E:function(){return c}});var n=s(7437),r=s(2265),a=s(5139);let l={login:(e,t)=>(0,a.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,a.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,a.S)("/auth/logout",{method:"POST"}),me:()=>(0,a.S)("/auth/me"),startImpersonation:e=>(0,a.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,a.S)("/auth/impersonation/stop",{method:"POST"})},i=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,a]=(0,r.useState)(null),[o,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(null),[f,x]=(0,r.useState)(!0),p=(0,r.useCallback)(e=>{var t,s;a(e.user),c(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),h(null!==(s=e.impersonation)&&void 0!==s?s:null)},[]),v=(0,r.useCallback)(async()=>{try{let e=await l.me();p(e)}catch(e){try{let e=await l.refresh();p(e)}catch(e){a(null),c([]),d(null),h(null)}}finally{x(!1)}},[p]);(0,r.useEffect)(()=>{v()},[v]);let g=(0,r.useCallback)(async(e,t)=>{let s=await l.login(e,t);return p(s),s},[p]),j=(0,r.useCallback)(async()=>{await l.logout(),a(null),c([]),d(null),h(null)},[]),y=(0,r.useCallback)(async()=>{p(await l.refresh())},[p]),b=(0,r.useCallback)(async e=>{let t=await l.startImpersonation(e);return p(t),t},[p]),w=(0,r.useCallback)(async()=>{let e=await l.stopImpersonation();return p(e),e},[p]),N=(0,r.useMemo)(()=>({user:s,permissions:o,tenant:u,impersonation:m,loading:f,login:g,logout:j,refresh:y,startImpersonation:b,stopImpersonation:w}),[s,o,u,m,f,g,j,y,b,w]);return(0,n.jsx)(i.Provider,{value:N,children:t})}function c(){let e=(0,r.useContext)(i);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4631:function(e,t,s){"use strict";s.d(t,{W:function(){return a}});var n=s(7437),r=s(4839);function a(e){let{children:t,className:s}=e;return(0,n.jsx)("div",{className:(0,r.Z)("glass-card",s),children:t})}},2312:function(e,t,s){"use strict";s.d(t,{x:function(){return r}});var n=s(5139);let r={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,n.S)("/admin/users?page=".concat(e,"&limit=").concat(t))},get:e=>(0,n.S)("/admin/users/".concat(e)),create:e=>(0,n.S)("/admin/users",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,n.S)("/admin/users/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,n.S)("/admin/users/".concat(e),{method:"DELETE"}),roles:()=>(0,n.S)("/admin/users/roles")}},5139:function(e,t,s){"use strict";var n;s.d(t,{S:function(){return a}});let r=null!==(n=s(357).env.NEXT_PUBLIC_API_URL)&&void 0!==n?n:"http://localhost:8000/api";async function a(e){var t,s,n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l="".concat(r).concat(e),i=new Headers(null!==(s=a.headers)&&void 0!==s?s:{}),o=null!==(n=null===(t=a.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==n?n:"GET";if("GET"!==o&&"HEAD"!==o){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&i.set("X-CSRF-Token",e),i.has("Content-Type")||i.set("Content-Type","application/json")}let c=await fetch(l,{...a,headers:i,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let u=await c.text();if(u)return JSON.parse(u)}},3301:function(e,t,s){"use strict";s.d(t,{a:function(){return r}});var n=s(1288);function r(){return(0,n.E)()}},357:function(e,t,s){"use strict";var n,r;e.exports=(null==(n=s.g.process)?void 0:n.env)&&"object"==typeof(null==(r=s.g.process)?void 0:r.env)?s.g.process:s(8081)},8081:function(e){!function(){var t={229:function(e){var t,s,n,r=e.exports={};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{s="function"==typeof clearTimeout?clearTimeout:l}catch(e){s=l}}();var o=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?o=n.concat(o):u=-1,o.length&&m())}function m(){if(!c){var e=i(d);c=!0;for(var t=o.length;t;){for(n=o,o=[];++u<t;)n&&n[u].run();u=-1,t=o.length}n=null,c=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===l||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];o.push(new h(e,t)),1!==o.length||c||i(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},s={};function n(e){var r=s[e];if(void 0!==r)return r.exports;var a=s[e]={exports:{}},l=!0;try{t[e](a,a.exports,n),l=!1}finally{l&&delete s[e]}return a.exports}n.ab="//";var r=n(229);e.exports=r}()},4839:function(e,t,s){"use strict";t.Z=function(){for(var e,t,s=0,n="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=function e(t){var s,n,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t){if(Array.isArray(t)){var a=t.length;for(s=0;s<a;s++)t[s]&&(n=e(t[s]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n)}return r}(e))&&(n&&(n+=" "),n+=t);return n}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=3283)}),_N_E=e.O()}]);