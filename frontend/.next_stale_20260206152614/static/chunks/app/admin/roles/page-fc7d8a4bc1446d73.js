(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3717],{2569:function(e,t,n){Promise.resolve().then(n.bind(n,2039))},2039:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var s=n(7437),r=n(7138),i=n(2265),l=n(5854),a=n(2145),c=n(6572),o=n(6053),u=n(22),d=n(4024),m=n(5205),h=n(4631),f=n(5427),x=n(6205);function p(){let[e,t]=(0,i.useState)([]),[n,p]=(0,i.useState)(!0),[j,v]=(0,i.useState)(null),y=(0,i.useCallback)(async()=>{p(!0),v(null);try{let e=await x.S.list();t(e)}catch(e){v(e instanceof Error?e.message:"Failed to load roles")}finally{p(!1)}},[]);(0,i.useEffect)(()=>{y()},[y]);let g=async e=>{if(e.is_system){v("System roles cannot be deleted");return}if(confirm("Delete ".concat(e.display_name,"? This cannot be undone.")))try{await x.S.remove(e.id),await y()}catch(e){v(e instanceof Error?e.message:"Failed to delete role")}};return(0,s.jsx)(l.n,{permission:"admin:roles:read",fallback:(0,s.jsxs)(h.W,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view admin roles."})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(a.m,{title:"Admin Roles",description:"Manage role definitions and open matrix editor for granular permissions.",count:e.length,countLabel:"Roles",rightSlot:(0,s.jsx)(l.n,{permission:"admin:roles:create",children:(0,s.jsx)(r.default,{href:"/admin/roles/new",className:"ui-btn ui-btn-primary ui-btn-sm ui-anim",children:"Add Role"})})}),j?(0,s.jsx)(d.o,{tone:"error",message:j}):null,n?(0,s.jsx)(d.o,{tone:"info",message:"Loading roles..."}):0===e.length?(0,s.jsx)(u.u,{description:"No roles created yet."}):(0,s.jsx)(o.r,{title:"Role Directory",table:(0,s.jsx)(c.w,{columns:[{key:"role",header:"Role",cellClassName:"font-medium",render:e=>e.display_name},{key:"key",header:"Key",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>e.name},{key:"system",header:"System",render:e=>e.is_system?"Yes":"No"},{key:"permissions",header:"Permissions",render:e=>e.permissions.length},{key:"updated",header:"Updated",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>e.updated_at?new Date(e.updated_at).toLocaleString():"N/A"},{key:"actions",header:"Actions",render:e=>(0,s.jsxs)(m.l,{children:[(0,s.jsx)(l.n,{permission:"admin:roles:update",children:(0,s.jsx)(r.default,{href:"/admin/roles/".concat(e.id),className:"ui-btn ui-btn-outline ui-btn-sm ui-anim",children:e.is_system?"View":"Edit"})}),(0,s.jsx)(l.n,{permission:"admin:roles:delete",children:(0,s.jsx)(f.z,{size:"sm",variant:"danger",onClick:()=>void g(e),disabled:e.is_system,children:"Delete"})})]})}],rows:e,rowKey:e=>e.id})})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return i},E:function(){return l}});var s=n(7437),r=n(3301);function i(e){let{permission:t,children:n,fallback:i=null}=e,{permissions:l,loading:a}=(0,r.a)();return a?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let s=0;s<e.length;s+=1)if("*"!==e[s]&&e[s]!==n[s]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(l,t)?(0,s.jsx)(s.Fragment,{children:i}):(0,s.jsx)(s.Fragment,{children:n})}function l(e){let{userType:t,children:n,fallback:i=null}=e,{user:l,loading:a}=(0,r.a)();return a?null:l&&l.user_type===t?(0,s.jsx)(s.Fragment,{children:n}):(0,s.jsx)("div",{className:"auth-layout",children:(0,s.jsxs)("div",{className:"glass-card auth-card",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),i]})})}},2145:function(e,t,n){"use strict";n.d(t,{m:function(){return l}});var s=n(7437),r=n(4839),i=n(7282);function l(e){let{title:t,description:n,rightSlot:l,count:a,countLabel:c,className:o}=e;return(0,s.jsxs)("div",{className:(0,r.Z)("ui-page-header",o),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"ui-page-title",children:t}),n?(0,s.jsx)("p",{className:"ui-page-subtitle",children:n}):null]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["number"==typeof a?(0,s.jsxs)(i.C,{variant:"accent",children:[a,c?" ".concat(c):""]}):null,l]})]})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return c},E:function(){return o}});var s=n(7437),r=n(2265),i=n(5139);let l={login:(e,t)=>(0,i.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,i.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,i.S)("/auth/logout",{method:"POST"}),me:()=>(0,i.S)("/auth/me"),startImpersonation:e=>(0,i.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,i.S)("/auth/impersonation/stop",{method:"POST"})},a=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[n,i]=(0,r.useState)(null),[c,o]=(0,r.useState)([]),[u,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(null),[f,x]=(0,r.useState)(!0),p=(0,r.useCallback)(e=>{var t,n;i(e.user),o(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),h(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),j=(0,r.useCallback)(async()=>{try{let e=await l.me();p(e)}catch(e){try{let e=await l.refresh();p(e)}catch(e){i(null),o([]),d(null),h(null)}}finally{x(!1)}},[p]);(0,r.useEffect)(()=>{j()},[j]);let v=(0,r.useCallback)(async(e,t)=>{let n=await l.login(e,t);return p(n),n},[p]),y=(0,r.useCallback)(async()=>{await l.logout(),i(null),o([]),d(null),h(null)},[]),g=(0,r.useCallback)(async()=>{p(await l.refresh())},[p]),N=(0,r.useCallback)(async e=>{let t=await l.startImpersonation(e);return p(t),t},[p]),b=(0,r.useCallback)(async()=>{let e=await l.stopImpersonation();return p(e),e},[p]),S=(0,r.useMemo)(()=>({user:n,permissions:c,tenant:u,impersonation:m,loading:f,login:v,logout:y,refresh:g,startImpersonation:N,stopImpersonation:b}),[n,c,u,m,f,v,y,g,N,b]);return(0,s.jsx)(a.Provider,{value:S,children:t})}function o(){let e=(0,r.useContext)(a);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},6572:function(e,t,n){"use strict";n.d(t,{w:function(){return i}});var s=n(7437),r=n(4839);function i(e){let{columns:t,rows:n,rowKey:i,emptyFallback:l=null,className:a}=e;return 0===n.length?(0,s.jsx)(s.Fragment,{children:l}):(0,s.jsxs)("table",{className:(0,r.Z)("ui-table",a),children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:t.map(e=>(0,s.jsx)("th",{className:(0,r.Z)("pb-3",e.headerClassName),children:e.header},e.key))})}),(0,s.jsx)("tbody",{children:n.map((e,n)=>(0,s.jsx)("tr",{children:t.map(t=>(0,s.jsx)("td",{className:(0,r.Z)("py-3",t.cellClassName),children:t.render(e,n)},t.key))},i(e,n)))})]})}},6053:function(e,t,n){"use strict";n.d(t,{r:function(){return l}});var s=n(7437),r=n(6430),i=n(7606);function l(e){let{title:t,table:n,footer:l}=e;return(0,s.jsxs)(i.q,{title:t,children:[(0,s.jsx)(r.K,{children:n}),l?(0,s.jsx)("div",{className:"mt-3",children:l}):null]})}},22:function(e,t,n){"use strict";n.d(t,{u:function(){return i}});var s=n(7437),r=n(4631);function i(e){let{title:t="Nothing here yet",description:n}=e;return(0,s.jsxs)(r.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:t}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:n})]})}},4024:function(e,t,n){"use strict";n.d(t,{o:function(){return i}});var s=n(7437),r=n(4839);function i(e){let{tone:t="info",message:n,className:i}=e;return(0,s.jsx)("p",{className:(0,r.Z)("ui-inline-alert","ui-inline-alert-".concat(t),i),children:n})}},6430:function(e,t,n){"use strict";n.d(t,{K:function(){return i}});var s=n(7437),r=n(4839);function i(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("ui-table-wrap",n),children:t})}},7606:function(e,t,n){"use strict";n.d(t,{q:function(){return l}});var s=n(7437),r=n(4839),i=n(4631);function l(e){let{title:t,actions:n,children:l,className:a}=e;return(0,s.jsxs)(i.W,{className:(0,r.Z)("p-6 ui-reveal",a),children:[(t||n)&&(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t?(0,s.jsx)("h3",{className:"text-lg",children:t}):(0,s.jsx)("span",{}),n]}),(0,s.jsx)("div",{className:(0,r.Z)((t||n)&&"mt-4"),children:l})]})}},5205:function(e,t,n){"use strict";n.d(t,{l:function(){return i}});var s=n(7437),r=n(4839);function i(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("flex flex-wrap gap-2",n),children:t})}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return i}});var s=n(7437),r=n(4839);function i(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("glass-card",n),children:t})}},7282:function(e,t,n){"use strict";n.d(t,{C:function(){return i}});var s=n(7437),r=n(4839);function i(e){let{variant:t="accent",className:n,children:i,...l}=e;return(0,s.jsx)("span",{className:(0,r.Z)("badge","badge-".concat(t),n),...l,children:i})}},5427:function(e,t,n){"use strict";n.d(t,{z:function(){return i}});var s=n(7437),r=n(4839);function i(e){let{className:t,variant:n="secondary",size:i="md",children:l,...a}=e;return(0,s.jsx)("button",{className:(0,r.Z)("ui-btn ui-anim","ui-btn-".concat(n),"sm"===i&&"ui-btn-sm","md"===i&&"ui-btn-md","lg"===i&&"ui-btn-lg",t),...a,children:l})}},6205:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var s=n(5139);let r={list:()=>(0,s.S)("/admin/roles"),get:e=>(0,s.S)("/admin/roles/".concat(e)),create:e=>(0,s.S)("/admin/roles",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,s.S)("/admin/roles/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,s.S)("/admin/roles/".concat(e),{method:"DELETE"}),permissions:()=>(0,s.S)("/admin/roles/permissions")}},5139:function(e,t,n){"use strict";var s;n.d(t,{S:function(){return i}});let r=null!==(s=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api";async function i(e){var t,n,s;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l="".concat(r).concat(e),a=new Headers(null!==(n=i.headers)&&void 0!==n?n:{}),c=null!==(s=null===(t=i.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==s?s:"GET";if("GET"!==c&&"HEAD"!==c){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&a.set("X-CSRF-Token",e),a.has("Content-Type")||a.set("Content-Type","application/json")}let o=await fetch(l,{...i,headers:a,credentials:"include"});if(!o.ok)throw Error(await o.text()||o.statusText);if(204===o.status)return;let u=await o.text();if(u)return JSON.parse(u)}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var s=n(1288);function r(){return(0,s.E)()}}},function(e){e.O(0,[3751,2971,7023,1744],function(){return e(e.s=2569)}),_N_E=e.O()}]);