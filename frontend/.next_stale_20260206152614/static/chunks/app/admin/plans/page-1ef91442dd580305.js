(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9366],{6074:function(e,t,n){Promise.resolve().then(n.bind(n,978))},978:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n(7437),s=n(2265),l=n(5854),a=n(4631),i=n(6209);let c={name:"",code:"",description:"",price_cents:0,currency:"USD",billing_interval:"monthly",is_active:!0};function o(){let[e,t]=(0,s.useState)([]),[n,o]=(0,s.useState)(!0),[u,d]=(0,s.useState)(c),[h,m]=(0,s.useState)(null),[p,x]=(0,s.useState)(null),f=async()=>{o(!0);try{let e=await i.D.list(1,50);t(e.items)}catch(e){x(e instanceof Error?e.message:"Failed to load plans")}finally{o(!1)}};(0,s.useEffect)(()=>{f()},[]);let v=(e,t)=>{d(n=>({...n,[e]:t}))},g=()=>{d(c),m(null)},b=(0,s.useMemo)(()=>({name:u.name,code:u.code||void 0,description:u.description||void 0,price_cents:Number(u.price_cents),currency:u.currency||void 0,billing_interval:u.billing_interval||void 0,is_active:u.is_active}),[u]),y=async e=>{e.preventDefault(),x(null);try{h?await i.D.update(h.id,b):await i.D.create(b),g(),await f()}catch(e){x(e instanceof Error?e.message:"Failed to save plan")}},j=e=>{var t;m(e),d({name:e.name,code:e.code,description:null!==(t=e.description)&&void 0!==t?t:"",price_cents:e.price_cents,currency:e.currency,billing_interval:e.billing_interval,is_active:e.is_active})},N=async e=>{if(confirm("Delete ".concat(e.name,"? This cannot be undone.")))try{await i.D.remove(e.id),await f()}catch(e){x(e instanceof Error?e.message:"Failed to delete plan")}};return(0,r.jsx)(l.n,{permission:"admin:plans:read",fallback:(0,r.jsxs)(a.W,{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have permission to view plans."})]}),children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Plans"}),(0,r.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Manage subscription plans and pricing tiers."})]}),(0,r.jsxs)("span",{className:"badge",children:[e.length," Plans"]})]}),(0,r.jsx)(l.n,{permission:h?"admin:plans:update":"admin:plans:create",children:(0,r.jsxs)(a.W,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg",children:h?"Edit Plan":"Create Plan"}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:y,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"Plan Name"}),(0,r.jsx)("input",{value:u.name,onChange:e=>v("name",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"Pro",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"Code"}),(0,r.jsx)("input",{value:u.code,onChange:e=>v("code",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"pro"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"Price (cents)"}),(0,r.jsx)("input",{type:"number",min:0,value:u.price_cents,onChange:e=>v("price_cents",Number(e.target.value)),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"9900"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"Currency"}),(0,r.jsx)("input",{value:u.currency,onChange:e=>v("currency",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"USD"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm",children:"Billing Interval"}),(0,r.jsx)("input",{value:u.billing_interval,onChange:e=>v("billing_interval",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"monthly"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:u.is_active,onChange:e=>v("is_active",e.target.checked)}),(0,r.jsx)("span",{className:"text-sm",children:"Active"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"text-sm",children:"Description"}),(0,r.jsx)("textarea",{value:u.description,onChange:e=>v("description",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"Best for growing hotel groups",rows:3})]}),(0,r.jsxs)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:[(0,r.jsx)("button",{type:"submit",className:"rounded-xl bg-[color:var(--accent)] px-6 py-3 text-sm font-semibold text-black shadow-glow",children:h?"Save Changes":"Create Plan"}),h&&(0,r.jsx)("button",{type:"button",className:"rounded-xl border border-white/20 px-6 py-3 text-sm",onClick:g,children:"Cancel"})]})]})]})}),(0,r.jsxs)(a.W,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg",children:"Plan Directory"}),p&&(0,r.jsx)("p",{className:"mt-2 text-sm text-red-400",children:p}),n?(0,r.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"Loading plans..."}):0===e.length?(0,r.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No plans created yet."}):(0,r.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"text-left text-[color:var(--muted)]",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"pb-3",children:"Name"}),(0,r.jsx)("th",{className:"pb-3",children:"Code"}),(0,r.jsx)("th",{className:"pb-3",children:"Price"}),(0,r.jsx)("th",{className:"pb-3",children:"Interval"}),(0,r.jsx)("th",{className:"pb-3",children:"Status"}),(0,r.jsx)("th",{className:"pb-3",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/10",children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"py-3 font-medium",children:e.name}),(0,r.jsx)("td",{className:"py-3 text-[color:var(--muted)]",children:e.code}),(0,r.jsxs)("td",{className:"py-3",children:[(e.price_cents/100).toFixed(2)," ",e.currency]}),(0,r.jsx)("td",{className:"py-3",children:e.billing_interval}),(0,r.jsx)("td",{className:"py-3",children:e.is_active?"Active":"Inactive"}),(0,r.jsxs)("td",{className:"py-3 flex flex-wrap gap-2",children:[(0,r.jsx)(l.n,{permission:"admin:plans:update",children:(0,r.jsx)("button",{className:"rounded-full border border-white/20 px-3 py-1 text-xs",onClick:()=>j(e),children:"Edit"})}),(0,r.jsx)(l.n,{permission:"admin:plans:delete",children:(0,r.jsx)("button",{className:"rounded-full border border-red-400/40 px-3 py-1 text-xs text-red-300",onClick:()=>N(e),children:"Delete"})})]})]},e.id))})]})})]})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return l},E:function(){return a}});var r=n(7437),s=n(3301);function l(e){let{permission:t,children:n,fallback:l=null}=e,{permissions:a,loading:i}=(0,s.a)();return i?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let r=0;r<e.length;r+=1)if("*"!==e[r]&&e[r]!==n[r]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(a,t)?(0,r.jsx)(r.Fragment,{children:l}):(0,r.jsx)(r.Fragment,{children:n})}function a(e){let{userType:t,children:n,fallback:l=null}=e,{user:a,loading:i}=(0,s.a)();return i?null:a&&a.user_type===t?(0,r.jsx)(r.Fragment,{children:n}):(0,r.jsx)("div",{className:"auth-layout",children:(0,r.jsxs)("div",{className:"glass-card auth-card",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),l]})})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return c},E:function(){return o}});var r=n(7437),s=n(2265),l=n(5139);let a={login:(e,t)=>(0,l.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,l.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,l.S)("/auth/logout",{method:"POST"}),me:()=>(0,l.S)("/auth/me"),startImpersonation:e=>(0,l.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,l.S)("/auth/impersonation/stop",{method:"POST"})},i=(0,s.createContext)(void 0);function c(e){let{children:t}=e,[n,l]=(0,s.useState)(null),[c,o]=(0,s.useState)([]),[u,d]=(0,s.useState)(null),[h,m]=(0,s.useState)(null),[p,x]=(0,s.useState)(!0),f=(0,s.useCallback)(e=>{var t,n;l(e.user),o(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),m(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),v=(0,s.useCallback)(async()=>{try{let e=await a.me();f(e)}catch(e){try{let e=await a.refresh();f(e)}catch(e){l(null),o([]),d(null),m(null)}}finally{x(!1)}},[f]);(0,s.useEffect)(()=>{v()},[v]);let g=(0,s.useCallback)(async(e,t)=>{let n=await a.login(e,t);return f(n),n},[f]),b=(0,s.useCallback)(async()=>{await a.logout(),l(null),o([]),d(null),m(null)},[]),y=(0,s.useCallback)(async()=>{f(await a.refresh())},[f]),j=(0,s.useCallback)(async e=>{let t=await a.startImpersonation(e);return f(t),t},[f]),N=(0,s.useCallback)(async()=>{let e=await a.stopImpersonation();return f(e),e},[f]),w=(0,s.useMemo)(()=>({user:n,permissions:c,tenant:u,impersonation:h,loading:p,login:g,logout:b,refresh:y,startImpersonation:j,stopImpersonation:N}),[n,c,u,h,p,g,b,y,j,N]);return(0,r.jsx)(i.Provider,{value:w,children:t})}function o(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return l}});var r=n(7437),s=n(4839);function l(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,s.Z)("glass-card",n),children:t})}},6209:function(e,t,n){"use strict";n.d(t,{D:function(){return s}});var r=n(5139);let s={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,r.S)("/admin/plans?page=".concat(e,"&limit=").concat(t))},get:e=>(0,r.S)("/admin/plans/".concat(e)),create:e=>(0,r.S)("/admin/plans",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,r.S)("/admin/plans/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,r.S)("/admin/plans/".concat(e),{method:"DELETE"})}},5139:function(e,t,n){"use strict";var r;n.d(t,{S:function(){return l}});let s=null!==(r=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:8000/api";async function l(e){var t,n,r;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(s).concat(e),i=new Headers(null!==(n=l.headers)&&void 0!==n?n:{}),c=null!==(r=null===(t=l.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==r?r:"GET";if("GET"!==c&&"HEAD"!==c){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&i.set("X-CSRF-Token",e),i.has("Content-Type")||i.set("Content-Type","application/json")}let o=await fetch(a,{...l,headers:i,credentials:"include"});if(!o.ok)throw Error(await o.text()||o.statusText);if(204===o.status)return;let u=await o.text();if(u)return JSON.parse(u)}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return s}});var r=n(1288);function s(){return(0,r.E)()}},357:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function l(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c=[],o=!1,u=-1;function d(){o&&r&&(o=!1,r.length?c=r.concat(c):u=-1,c.length&&h())}function h(){if(!o){var e=i(d);o=!0;for(var t=c.length;t;){for(r=c,c=[];++u<t;)r&&r[u].run();u=-1,t=c.length}r=null,o=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new m(e,t)),1!==c.length||o||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var l=n[e]={exports:{}},a=!0;try{t[e](l,l.exports,r),a=!1}finally{a&&delete n[e]}return l.exports}r.ab="//";var s=r(229);e.exports=s}()},4839:function(e,t,n){"use strict";t.Z=function(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=function e(t){var n,r,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(n=0;n<l;n++)t[n]&&(r=e(t[n]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r)}return s}(e))&&(r&&(r+=" "),r+=t);return r}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=6074)}),_N_E=e.O()}]);