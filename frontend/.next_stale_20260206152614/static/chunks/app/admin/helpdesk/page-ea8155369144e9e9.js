(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5253],{4298:function(e,t,s){Promise.resolve().then(s.bind(s,1765))},1765:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var a=s(7437),i=s(2265),n=s(5854),r=s(2145),l=s(4862),o=s(6572),d=s(6053),c=s(22),u=s(4024),m=s(5205),h=s(4631),p=s(5427),g=s(7032),v=s(9465),x=s(7868),j=s(6243),y=s(5139);let k={list:e=>{let t=new URLSearchParams;(null==e?void 0:e.page)&&t.set("page",e.page.toString()),(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString()),(null==e?void 0:e.status)&&t.set("status",e.status),(null==e?void 0:e.priority)&&t.set("priority",e.priority),(null==e?void 0:e.tenant_id)&&t.set("tenant_id",e.tenant_id);let s=t.toString();return(0,y.S)("/admin/helpdesk".concat(s?"?".concat(s):""))},create:e=>(0,y.S)("/admin/helpdesk",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,y.S)("/admin/helpdesk/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,y.S)("/admin/helpdesk/".concat(e),{method:"DELETE"})};var _=s(3828),b=s(2312);let f={tenant_id:"",requester_name:"",requester_email:"",subject:"",description:"",status:"open",priority:"normal",assigned_to:""};function S(){let[e,t]=(0,i.useState)([]),[s,y]=(0,i.useState)([]),[S,C]=(0,i.useState)([]),[q,N]=(0,i.useState)(!0),[w,E]=(0,i.useState)(f),[T,P]=(0,i.useState)(null),[D,O]=(0,i.useState)(null),z=(0,i.useCallback)(async()=>{N(!0),O(null);try{let[e,s,a]=await Promise.all([k.list({page:1,limit:50}),_.B.list(1,100),b.x.list(1,100)]);t(e.items),y(s.items),C(a.items)}catch(e){O(e instanceof Error?e.message:"Failed to load helpdesk tickets")}finally{N(!1)}},[]);(0,i.useEffect)(()=>{z()},[z]);let J=(e,t)=>{E(s=>({...s,[e]:t}))},L=()=>{E(f),P(null)},U=(0,i.useMemo)(()=>({tenant_id:w.tenant_id||void 0,requester_name:w.requester_name||void 0,requester_email:w.requester_email||void 0,subject:w.subject,description:w.description||void 0,status:w.status||void 0,priority:w.priority||void 0,assigned_to:w.assigned_to||void 0}),[w]),A=async e=>{e.preventDefault(),O(null);try{T?await k.update(T.id,U):await k.create(U),L(),await z()}catch(e){O(e instanceof Error?e.message:"Failed to save ticket")}},F=e=>{var t,s,a,i,n;P(e),E({tenant_id:null!==(t=e.tenant_id)&&void 0!==t?t:"",requester_name:null!==(s=e.requester_name)&&void 0!==s?s:"",requester_email:null!==(a=e.requester_email)&&void 0!==a?a:"",subject:e.subject,description:null!==(i=e.description)&&void 0!==i?i:"",status:e.status,priority:e.priority,assigned_to:null!==(n=e.assigned_to)&&void 0!==n?n:""})},H=async e=>{if(confirm('Delete ticket "'.concat(e.subject,'"? This cannot be undone.')))try{await k.remove(e.id),await z()}catch(e){O(e instanceof Error?e.message:"Failed to delete ticket")}};return(0,a.jsx)(n.n,{permission:"admin:helpdesk:read",fallback:(0,a.jsxs)(h.W,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view HelpDesk tickets."})]}),children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(r.m,{title:"HelpDesk",description:"Track support requests from hotels and internal teams.",count:e.length,countLabel:"Tickets"}),(0,a.jsx)(n.n,{permission:T?"admin:helpdesk:update":"admin:helpdesk:create",children:(0,a.jsx)(l.y,{title:T?"Edit Ticket":"Create Ticket",children:(0,a.jsxs)("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:A,children:[(0,a.jsx)(g.g,{label:"Hotel",children:(0,a.jsxs)(v.l,{value:w.tenant_id,onChange:e=>J("tenant_id",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Platform / Internal"}),s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,a.jsx)(g.g,{label:"Assigned To",children:(0,a.jsxs)(v.l,{value:w.assigned_to,onChange:e=>J("assigned_to",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Unassigned"}),S.map(e=>(0,a.jsx)("option",{value:e.id,children:e.email},e.id))]})}),(0,a.jsx)(g.g,{label:"Requester Name",children:(0,a.jsx)(j.o,{value:w.requester_name,onChange:e=>J("requester_name",e.target.value),placeholder:"Jane Doe"})}),(0,a.jsx)(g.g,{label:"Requester Email",children:(0,a.jsx)(j.o,{value:w.requester_email,onChange:e=>J("requester_email",e.target.value),placeholder:"jane@example.com"})}),(0,a.jsx)(g.g,{label:"Subject",required:!0,className:"md:col-span-2",children:(0,a.jsx)(j.o,{value:w.subject,onChange:e=>J("subject",e.target.value),placeholder:"Issue with booking sync",required:!0})}),(0,a.jsx)(g.g,{label:"Description",className:"md:col-span-2",children:(0,a.jsx)(x.F,{value:w.description,onChange:e=>J("description",e.target.value),rows:3,placeholder:"Describe the issue or request"})}),(0,a.jsx)(g.g,{label:"Status",children:(0,a.jsx)(j.o,{value:w.status,onChange:e=>J("status",e.target.value),placeholder:"open"})}),(0,a.jsx)(g.g,{label:"Priority",children:(0,a.jsx)(j.o,{value:w.priority,onChange:e=>J("priority",e.target.value),placeholder:"normal"})}),(0,a.jsxs)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:[(0,a.jsx)(p.z,{type:"submit",variant:"primary",children:T?"Save Changes":"Create Ticket"}),T?(0,a.jsx)(p.z,{type:"button",variant:"secondary",onClick:L,children:"Cancel"}):null]})]})})}),D?(0,a.jsx)(u.o,{tone:"error",message:D}):null,q?(0,a.jsx)(u.o,{tone:"info",message:"Loading tickets..."}):0===e.length?(0,a.jsx)(c.u,{description:"No tickets created yet."}):(0,a.jsx)(d.r,{title:"Ticket Queue",table:(0,a.jsx)(o.w,{columns:[{key:"subject",header:"Subject",cellClassName:"font-medium",render:e=>e.subject},{key:"hotel",header:"Hotel",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.tenant_name)&&void 0!==t?t:"Platform"}},{key:"status",header:"Status",render:e=>e.status},{key:"priority",header:"Priority",render:e=>e.priority},{key:"assignee",header:"Assignee",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.assignee_email)&&void 0!==t?t:"Unassigned"}},{key:"actions",header:"Actions",render:e=>(0,a.jsxs)(m.l,{children:[(0,a.jsx)(n.n,{permission:"admin:helpdesk:update",children:(0,a.jsx)(p.z,{size:"sm",variant:"outline",onClick:()=>F(e),children:"Edit"})}),(0,a.jsx)(n.n,{permission:"admin:helpdesk:delete",children:(0,a.jsx)(p.z,{size:"sm",variant:"danger",onClick:()=>void H(e),children:"Delete"})})]})}],rows:e,rowKey:e=>e.id})})]})})}},2312:function(e,t,s){"use strict";s.d(t,{x:function(){return i}});var a=s(5139);let i={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,a.S)("/admin/users?page=".concat(e,"&limit=").concat(t))},get:e=>(0,a.S)("/admin/users/".concat(e)),create:e=>(0,a.S)("/admin/users",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,a.S)("/admin/users/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,a.S)("/admin/users/".concat(e),{method:"DELETE"}),roles:()=>(0,a.S)("/admin/users/roles")}}},function(e){e.O(0,[9898,2971,7023,1744],function(){return e(e.s=4298)}),_N_E=e.O()}]);