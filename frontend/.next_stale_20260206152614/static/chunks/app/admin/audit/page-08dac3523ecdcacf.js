(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3708],{632:function(e,t,n){Promise.resolve().then(n.bind(n,13))},13:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var r=n(7437),a=n(2265),i=n(5854),s=n(2145),l=n(4862),o=n(6572),c=n(6053),u=n(22),d=n(4024),f=n(4631),h=n(5427),m=n(7032),p=n(6243),x=n(5139);let v={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.set("page",String(e.page)),e.limit&&t.set("limit",String(e.limit)),e.user_id&&t.set("user_id",e.user_id),e.tenant_id&&t.set("tenant_id",e.tenant_id),e.action&&t.set("action",e.action),e.resource_type&&t.set("resource_type",e.resource_type),e.date_from&&t.set("date_from",e.date_from),e.date_to&&t.set("date_to",e.date_to);let n=t.toString();return(0,x.S)("/admin/audit?".concat(n))}},g={action:"",resource_type:"",user_id:"",tenant_id:"",date_from:"",date_to:""};function y(){let[e,t]=(0,a.useState)([]),[n,x]=(0,a.useState)(g),[y,j]=(0,a.useState)(!0),[_,b]=(0,a.useState)(null),N=(0,a.useCallback)(async e=>{j(!0),b(null);try{let n=await v.list({page:1,limit:50,action:e.action||void 0,resource_type:e.resource_type||void 0,user_id:e.user_id||void 0,tenant_id:e.tenant_id||void 0,date_from:e.date_from||void 0,date_to:e.date_to||void 0});t(n.items)}catch(e){b(e instanceof Error?e.message:"Failed to load audit logs")}finally{j(!1)}},[]);(0,a.useEffect)(()=>{N(g)},[N]);let w=(e,t)=>{x(n=>({...n,[e]:t}))},C=(0,a.useMemo)(()=>e.length>0,[e]);return(0,r.jsx)(i.n,{permission:"admin:audit:read",fallback:(0,r.jsxs)(f.W,{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:"You do not have permission to view audit logs."})]}),children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(s.m,{title:"Audit Logs",description:"Immutable activity trail for platform actions.",count:e.length,countLabel:"Records"}),(0,r.jsx)(l.y,{title:"Filters",children:(0,r.jsxs)("form",{className:"grid gap-4 md:grid-cols-3",onSubmit:e=>{e.preventDefault(),N(n)},children:[(0,r.jsx)(m.g,{label:"Action",children:(0,r.jsx)(p.o,{value:n.action,onChange:e=>w("action",e.target.value),placeholder:"auth.login"})}),(0,r.jsx)(m.g,{label:"Resource Type",children:(0,r.jsx)(p.o,{value:n.resource_type,onChange:e=>w("resource_type",e.target.value),placeholder:"tenant"})}),(0,r.jsx)(m.g,{label:"User ID",children:(0,r.jsx)(p.o,{value:n.user_id,onChange:e=>w("user_id",e.target.value),placeholder:"UUID"})}),(0,r.jsx)(m.g,{label:"Tenant ID",children:(0,r.jsx)(p.o,{value:n.tenant_id,onChange:e=>w("tenant_id",e.target.value),placeholder:"UUID"})}),(0,r.jsx)(m.g,{label:"From",children:(0,r.jsx)(p.o,{type:"date",value:n.date_from,onChange:e=>w("date_from",e.target.value)})}),(0,r.jsx)(m.g,{label:"To",children:(0,r.jsx)(p.o,{type:"date",value:n.date_to,onChange:e=>w("date_to",e.target.value)})}),(0,r.jsxs)("div",{className:"md:col-span-3 flex flex-wrap gap-3",children:[(0,r.jsx)(h.z,{type:"submit",variant:"primary",children:"Apply Filters"}),(0,r.jsx)(h.z,{type:"button",variant:"secondary",onClick:()=>{x(g),N(g)},children:"Reset"})]})]})}),_?(0,r.jsx)(d.o,{tone:"error",message:_}):null,y?(0,r.jsx)(d.o,{tone:"info",message:"Loading audit logs..."}):C?(0,r.jsx)(c.r,{title:"Recent Activity",table:(0,r.jsx)(o.w,{columns:[{key:"action",header:"Action",cellClassName:"font-medium",render:e=>e.action},{key:"resource",header:"Resource",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.resource_type)&&void 0!==t?t:"-"}},{key:"user",header:"User",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.user_id)&&void 0!==t?t:"-"}},{key:"tenant",header:"Tenant",cellClassName:"text-[color:var(--color-text-muted)]",render:e=>{var t;return null!==(t=e.tenant_id)&&void 0!==t?t:"-"}},{key:"when",header:"When",render:e=>e.created_at?new Date(e.created_at).toLocaleString():"-"}],rows:e,rowKey:e=>e.id})}):(0,r.jsx)(u.u,{description:"No audit activity yet."})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return i},E:function(){return s}});var r=n(7437),a=n(3301);function i(e){let{permission:t,children:n,fallback:i=null}=e,{permissions:s,loading:l}=(0,a.a)();return l?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let r=0;r<e.length;r+=1)if("*"!==e[r]&&e[r]!==n[r]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(s,t)?(0,r.jsx)(r.Fragment,{children:i}):(0,r.jsx)(r.Fragment,{children:n})}function s(e){let{userType:t,children:n,fallback:i=null}=e,{user:s,loading:l}=(0,a.a)();return l?null:s&&s.user_type===t?(0,r.jsx)(r.Fragment,{children:n}):(0,r.jsx)("div",{className:"auth-layout",children:(0,r.jsxs)("div",{className:"glass-card auth-card",children:[(0,r.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),i]})})}},2145:function(e,t,n){"use strict";n.d(t,{m:function(){return s}});var r=n(7437),a=n(4839),i=n(7282);function s(e){let{title:t,description:n,rightSlot:s,count:l,countLabel:o,className:c}=e;return(0,r.jsxs)("div",{className:(0,a.Z)("ui-page-header",c),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"ui-page-title",children:t}),n?(0,r.jsx)("p",{className:"ui-page-subtitle",children:n}):null]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:["number"==typeof l?(0,r.jsxs)(i.C,{variant:"accent",children:[l,o?" ".concat(o):""]}):null,s]})]})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return o},E:function(){return c}});var r=n(7437),a=n(2265),i=n(5139);let s={login:(e,t)=>(0,i.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,i.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,i.S)("/auth/logout",{method:"POST"}),me:()=>(0,i.S)("/auth/me"),startImpersonation:e=>(0,i.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,i.S)("/auth/impersonation/stop",{method:"POST"})},l=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[n,i]=(0,a.useState)(null),[o,c]=(0,a.useState)([]),[u,d]=(0,a.useState)(null),[f,h]=(0,a.useState)(null),[m,p]=(0,a.useState)(!0),x=(0,a.useCallback)(e=>{var t,n;i(e.user),c(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),h(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),v=(0,a.useCallback)(async()=>{try{let e=await s.me();x(e)}catch(e){try{let e=await s.refresh();x(e)}catch(e){i(null),c([]),d(null),h(null)}}finally{p(!1)}},[x]);(0,a.useEffect)(()=>{v()},[v]);let g=(0,a.useCallback)(async(e,t)=>{let n=await s.login(e,t);return x(n),n},[x]),y=(0,a.useCallback)(async()=>{await s.logout(),i(null),c([]),d(null),h(null)},[]),j=(0,a.useCallback)(async()=>{x(await s.refresh())},[x]),_=(0,a.useCallback)(async e=>{let t=await s.startImpersonation(e);return x(t),t},[x]),b=(0,a.useCallback)(async()=>{let e=await s.stopImpersonation();return x(e),e},[x]),N=(0,a.useMemo)(()=>({user:n,permissions:o,tenant:u,impersonation:f,loading:m,login:g,logout:y,refresh:j,startImpersonation:_,stopImpersonation:b}),[n,o,u,f,m,g,y,j,_,b]);return(0,r.jsx)(l.Provider,{value:N,children:t})}function c(){let e=(0,a.useContext)(l);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4862:function(e,t,n){"use strict";n.d(t,{y:function(){return i}});var r=n(7437),a=n(7606);function i(e){let{title:t,children:n}=e;return(0,r.jsx)(a.q,{title:t,children:n})}},6572:function(e,t,n){"use strict";n.d(t,{w:function(){return i}});var r=n(7437),a=n(4839);function i(e){let{columns:t,rows:n,rowKey:i,emptyFallback:s=null,className:l}=e;return 0===n.length?(0,r.jsx)(r.Fragment,{children:s}):(0,r.jsxs)("table",{className:(0,a.Z)("ui-table",l),children:[(0,r.jsx)("thead",{children:(0,r.jsx)("tr",{children:t.map(e=>(0,r.jsx)("th",{className:(0,a.Z)("pb-3",e.headerClassName),children:e.header},e.key))})}),(0,r.jsx)("tbody",{children:n.map((e,n)=>(0,r.jsx)("tr",{children:t.map(t=>(0,r.jsx)("td",{className:(0,a.Z)("py-3",t.cellClassName),children:t.render(e,n)},t.key))},i(e,n)))})]})}},6053:function(e,t,n){"use strict";n.d(t,{r:function(){return s}});var r=n(7437),a=n(6430),i=n(7606);function s(e){let{title:t,table:n,footer:s}=e;return(0,r.jsxs)(i.q,{title:t,children:[(0,r.jsx)(a.K,{children:n}),s?(0,r.jsx)("div",{className:"mt-3",children:s}):null]})}},22:function(e,t,n){"use strict";n.d(t,{u:function(){return i}});var r=n(7437),a=n(4631);function i(e){let{title:t="Nothing here yet",description:n}=e;return(0,r.jsxs)(a.W,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg",children:t}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--color-text-muted)]",children:n})]})}},4024:function(e,t,n){"use strict";n.d(t,{o:function(){return i}});var r=n(7437),a=n(4839);function i(e){let{tone:t="info",message:n,className:i}=e;return(0,r.jsx)("p",{className:(0,a.Z)("ui-inline-alert","ui-inline-alert-".concat(t),i),children:n})}},6430:function(e,t,n){"use strict";n.d(t,{K:function(){return i}});var r=n(7437),a=n(4839);function i(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,a.Z)("ui-table-wrap",n),children:t})}},7606:function(e,t,n){"use strict";n.d(t,{q:function(){return s}});var r=n(7437),a=n(4839),i=n(4631);function s(e){let{title:t,actions:n,children:s,className:l}=e;return(0,r.jsxs)(i.W,{className:(0,a.Z)("p-6 ui-reveal",l),children:[(t||n)&&(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t?(0,r.jsx)("h3",{className:"text-lg",children:t}):(0,r.jsx)("span",{}),n]}),(0,r.jsx)("div",{className:(0,a.Z)((t||n)&&"mt-4"),children:s})]})}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return i}});var r=n(7437),a=n(4839);function i(e){let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,a.Z)("glass-card",n),children:t})}},7282:function(e,t,n){"use strict";n.d(t,{C:function(){return i}});var r=n(7437),a=n(4839);function i(e){let{variant:t="accent",className:n,children:i,...s}=e;return(0,r.jsx)("span",{className:(0,a.Z)("badge","badge-".concat(t),n),...s,children:i})}},5427:function(e,t,n){"use strict";n.d(t,{z:function(){return i}});var r=n(7437),a=n(4839);function i(e){let{className:t,variant:n="secondary",size:i="md",children:s,...l}=e;return(0,r.jsx)("button",{className:(0,a.Z)("ui-btn ui-anim","ui-btn-".concat(n),"sm"===i&&"ui-btn-sm","md"===i&&"ui-btn-md","lg"===i&&"ui-btn-lg",t),...l,children:s})}},7032:function(e,t,n){"use strict";n.d(t,{g:function(){return i}});var r=n(7437),a=n(4839);function i(e){let{label:t,required:n,hint:i,error:s,className:l,children:o}=e;return(0,r.jsxs)("div",{className:(0,a.Z)("space-y-2",l),children:[(0,r.jsxs)("label",{className:"text-sm",children:[t,n&&(0,r.jsx)("span",{className:"ml-1 text-[color:var(--color-accent)]",children:"*"})]}),o,s?(0,r.jsx)("p",{className:"text-xs text-red-400",children:s}):i?(0,r.jsx)("p",{className:"text-xs text-[color:var(--color-text-muted)]",children:i}):null]})}},6243:function(e,t,n){"use strict";n.d(t,{o:function(){return i}});var r=n(7437),a=n(4839);function i(e){let{className:t,...n}=e;return(0,r.jsx)("input",{className:(0,a.Z)("ui-input",t),...n})}},5139:function(e,t,n){"use strict";var r;n.d(t,{S:function(){return i}});let a=null!==(r=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==r?r:"http://localhost:8000/api";async function i(e){var t,n,r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(a).concat(e),l=new Headers(null!==(n=i.headers)&&void 0!==n?n:{}),o=null!==(r=null===(t=i.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==r?r:"GET";if("GET"!==o&&"HEAD"!==o){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&l.set("X-CSRF-Token",e),l.has("Content-Type")||l.set("Content-Type","application/json")}let c=await fetch(s,{...i,headers:l,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let u=await c.text();if(u)return JSON.parse(u)}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return a}});var r=n(1288);function a(){return(0,r.E)()}},357:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function i(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var o=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?o=r.concat(o):u=-1,o.length&&f())}function f(){if(!c){var e=l(d);c=!0;for(var t=o.length;t;){for(r=o,o=[];++u<t;)r&&r[u].run();u=-1,t=o.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new h(e,t)),1!==o.length||c||l(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}},s=!0;try{t[e](i,i.exports,r),s=!1}finally{s&&delete n[e]}return i.exports}r.ab="//";var a=r(229);e.exports=a}()},4839:function(e,t,n){"use strict";t.Z=function(){for(var e,t,n=0,r="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=function e(t){var n,r,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t){if(Array.isArray(t)){var i=t.length;for(n=0;n<i;n++)t[n]&&(r=e(t[n]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r)}return a}(e))&&(r&&(r+=" "),r+=t);return r}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=632)}),_N_E=e.O()}]);