(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3065],{2169:function(e,t,n){Promise.resolve().then(n.bind(n,6540))},6540:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var s=n(7437),i=n(2265),a=n(5854),r=n(4631),l=n(5139);let o={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,l.S)("/admin/kiosks?page=".concat(e,"&limit=").concat(t))},create:e=>(0,l.S)("/admin/kiosks",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,l.S)("/admin/kiosks/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,l.S)("/admin/kiosks/".concat(e),{method:"DELETE"})};var c=n(3828);let d={tenant_id:"",name:"",location:"",status:"active",device_id:""};function u(){let[e,t]=(0,i.useState)([]),[n,l]=(0,i.useState)([]),[u,m]=(0,i.useState)(!0),[h,x]=(0,i.useState)(d),[f,p]=(0,i.useState)(null),[v,b]=(0,i.useState)(null),[g,y]=(0,i.useState)(null),k=async()=>{m(!0);try{let[e,n]=await Promise.all([o.list(1,50),c.B.list(1,100)]);t(e.items),l(n.items)}catch(e){b(e instanceof Error?e.message:"Failed to load kiosks")}finally{m(!1)}};(0,i.useEffect)(()=>{k()},[]);let j=(e,t)=>{x(n=>({...n,[e]:t}))},N=()=>{x(d),p(null)},w=(0,i.useMemo)(()=>({tenant_id:h.tenant_id,name:h.name,location:h.location||void 0,status:h.status||void 0,device_id:h.device_id||void 0}),[h]),S=(0,i.useMemo)(()=>({name:h.name||void 0,location:h.location||void 0,status:h.status||void 0,device_id:h.device_id||void 0}),[h]),T=async e=>{e.preventDefault(),b(null),y(null);try{let e=f?await o.update(f.id,S):await o.create(w);e.issued_token&&y(e.issued_token),N(),await k()}catch(e){b(e instanceof Error?e.message:"Failed to save kiosk")}},_=e=>{var t,n;p(e),x({tenant_id:e.tenant_id,name:e.name,location:null!==(t=e.location)&&void 0!==t?t:"",status:e.status,device_id:null!==(n=e.device_id)&&void 0!==n?n:""})},C=async e=>{if(confirm("Delete ".concat(e.name,"? This cannot be undone.")))try{await o.remove(e.id),await k()}catch(e){b(e instanceof Error?e.message:"Failed to delete kiosk")}},E=async e=>{b(null),y(null);try{let t=await o.update(e.id,{rotate_token:!0});t.issued_token&&y(t.issued_token),await k()}catch(e){b(e instanceof Error?e.message:"Failed to rotate token")}};return(0,s.jsx)(a.n,{permission:"admin:kiosks:read",fallback:(0,s.jsxs)(r.W,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have permission to view the kiosk fleet."})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Kiosk Fleet"}),(0,s.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Register kiosk devices and manage access tokens."})]}),(0,s.jsxs)("span",{className:"badge",children:[e.length," Kiosks"]})]}),g&&(0,s.jsxs)(r.W,{className:"p-6 border border-emerald-400/40",children:[(0,s.jsx)("h3",{className:"text-lg",children:"New Kiosk Token"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"Copy this token now. It will not be shown again."}),(0,s.jsx)("div",{className:"mt-3 rounded-xl border border-white/20 bg-white/5 px-4 py-3 font-mono text-sm",children:g})]}),(0,s.jsx)(a.n,{permission:f?"admin:kiosks:update":"admin:kiosks:create",children:(0,s.jsxs)(r.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:f?"Edit Kiosk":"Add Kiosk"}),(0,s.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:T,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Hotel"}),(0,s.jsxs)("select",{value:h.tenant_id,onChange:e=>j("tenant_id",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",required:!0,disabled:!!f,children:[(0,s.jsx)("option",{value:"",children:"Select hotel"}),n.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Kiosk Name"}),(0,s.jsx)("input",{value:h.name,onChange:e=>j("name",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"Lobby Check-in",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Location"}),(0,s.jsx)("input",{value:h.location,onChange:e=>j("location",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"Main lobby"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Status"}),(0,s.jsx)("input",{value:h.status,onChange:e=>j("status",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"active"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Device ID"}),(0,s.jsx)("input",{value:h.device_id,onChange:e=>j("device_id",e.target.value),className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm",placeholder:"kiosk-001"})]}),(0,s.jsxs)("div",{className:"md:col-span-2 flex flex-wrap gap-3",children:[(0,s.jsx)("button",{type:"submit",className:"rounded-xl bg-[color:var(--accent)] px-6 py-3 text-sm font-semibold text-black shadow-glow",children:f?"Save Changes":"Create Kiosk"}),f&&(0,s.jsx)("button",{type:"button",className:"rounded-xl border border-white/20 px-6 py-3 text-sm",onClick:N,children:"Cancel"})]})]})]})}),(0,s.jsxs)(r.W,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg",children:"Kiosk Directory"}),v&&(0,s.jsx)("p",{className:"mt-2 text-sm text-red-400",children:v}),u?(0,s.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"Loading kiosks..."}):0===e.length?(0,s.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No kiosks registered yet."}):(0,s.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"text-left text-[color:var(--muted)]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"pb-3",children:"Name"}),(0,s.jsx)("th",{className:"pb-3",children:"Hotel"}),(0,s.jsx)("th",{className:"pb-3",children:"Status"}),(0,s.jsx)("th",{className:"pb-3",children:"Device ID"}),(0,s.jsx)("th",{className:"pb-3",children:"Token"}),(0,s.jsx)("th",{className:"pb-3",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/10",children:e.map(e=>{var t,n;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-3 font-medium",children:e.name}),(0,s.jsx)("td",{className:"py-3 text-[color:var(--muted)]",children:null!==(t=e.tenant_name)&&void 0!==t?t:e.tenant_id}),(0,s.jsx)("td",{className:"py-3",children:e.status}),(0,s.jsx)("td",{className:"py-3 text-[color:var(--muted)]",children:null!==(n=e.device_id)&&void 0!==n?n:"-"}),(0,s.jsx)("td",{className:"py-3 text-[color:var(--muted)]",children:e.token_last4?"****".concat(e.token_last4):"-"}),(0,s.jsxs)("td",{className:"py-3 flex flex-wrap gap-2",children:[(0,s.jsx)(a.n,{permission:"admin:kiosks:update",children:(0,s.jsx)("button",{className:"rounded-full border border-white/20 px-3 py-1 text-xs",onClick:()=>_(e),children:"Edit"})}),(0,s.jsx)(a.n,{permission:"admin:kiosks:update",children:(0,s.jsx)("button",{className:"rounded-full border border-white/20 px-3 py-1 text-xs",onClick:()=>E(e),children:"Rotate Token"})}),(0,s.jsx)(a.n,{permission:"admin:kiosks:delete",children:(0,s.jsx)("button",{className:"rounded-full border border-red-400/40 px-3 py-1 text-xs text-red-300",onClick:()=>C(e),children:"Delete"})})]})]},e.id)})})]})})]})]})})}},5854:function(e,t,n){"use strict";n.d(t,{n:function(){return a},E:function(){return r}});var s=n(7437),i=n(3301);function a(e){let{permission:t,children:n,fallback:a=null}=e,{permissions:r,loading:l}=(0,i.a)();return l?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let s=0;s<e.length;s+=1)if("*"!==e[s]&&e[s]!==n[s]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(r,t)?(0,s.jsx)(s.Fragment,{children:a}):(0,s.jsx)(s.Fragment,{children:n})}function r(e){let{userType:t,children:n,fallback:a=null}=e,{user:r,loading:l}=(0,i.a)();return l?null:r&&r.user_type===t?(0,s.jsx)(s.Fragment,{children:n}):(0,s.jsx)("div",{className:"auth-layout",children:(0,s.jsxs)("div",{className:"glass-card auth-card",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),a]})})}},1288:function(e,t,n){"use strict";n.d(t,{H:function(){return o},E:function(){return c}});var s=n(7437),i=n(2265),a=n(5139);let r={login:(e,t)=>(0,a.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,a.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,a.S)("/auth/logout",{method:"POST"}),me:()=>(0,a.S)("/auth/me"),startImpersonation:e=>(0,a.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,a.S)("/auth/impersonation/stop",{method:"POST"})},l=(0,i.createContext)(void 0);function o(e){let{children:t}=e,[n,a]=(0,i.useState)(null),[o,c]=(0,i.useState)([]),[d,u]=(0,i.useState)(null),[m,h]=(0,i.useState)(null),[x,f]=(0,i.useState)(!0),p=(0,i.useCallback)(e=>{var t,n;a(e.user),c(e.permissions),u(null!==(t=e.tenant)&&void 0!==t?t:null),h(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),v=(0,i.useCallback)(async()=>{try{let e=await r.me();p(e)}catch(e){try{let e=await r.refresh();p(e)}catch(e){a(null),c([]),u(null),h(null)}}finally{f(!1)}},[p]);(0,i.useEffect)(()=>{v()},[v]);let b=(0,i.useCallback)(async(e,t)=>{let n=await r.login(e,t);return p(n),n},[p]),g=(0,i.useCallback)(async()=>{await r.logout(),a(null),c([]),u(null),h(null)},[]),y=(0,i.useCallback)(async()=>{p(await r.refresh())},[p]),k=(0,i.useCallback)(async e=>{let t=await r.startImpersonation(e);return p(t),t},[p]),j=(0,i.useCallback)(async()=>{let e=await r.stopImpersonation();return p(e),e},[p]),N=(0,i.useMemo)(()=>({user:n,permissions:o,tenant:d,impersonation:m,loading:x,login:b,logout:g,refresh:y,startImpersonation:k,stopImpersonation:j}),[n,o,d,m,x,b,g,y,k,j]);return(0,s.jsx)(l.Provider,{value:N,children:t})}function c(){let e=(0,i.useContext)(l);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4631:function(e,t,n){"use strict";n.d(t,{W:function(){return a}});var s=n(7437),i=n(4839);function a(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,i.Z)("glass-card",n),children:t})}},3828:function(e,t,n){"use strict";n.d(t,{B:function(){return i}});var s=n(5139);let i={list:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,s.S)("/admin/hotels?page=".concat(e,"&limit=").concat(t))},get:e=>(0,s.S)("/admin/hotels/".concat(e)),create:e=>(0,s.S)("/admin/hotels",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,s.S)("/admin/hotels/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,s.S)("/admin/hotels/".concat(e),{method:"DELETE"})}},5139:function(e,t,n){"use strict";var s;n.d(t,{S:function(){return a}});let i=null!==(s=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api";async function a(e){var t,n,s;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(i).concat(e),l=new Headers(null!==(n=a.headers)&&void 0!==n?n:{}),o=null!==(s=null===(t=a.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==s?s:"GET";if("GET"!==o&&"HEAD"!==o){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&l.set("X-CSRF-Token",e),l.has("Content-Type")||l.set("Content-Type","application/json")}let c=await fetch(r,{...a,headers:l,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let d=await c.text();if(d)return JSON.parse(d)}},3301:function(e,t,n){"use strict";n.d(t,{a:function(){return i}});var s=n(1288);function i(){return(0,s.E)()}},357:function(e,t,n){"use strict";var s,i;e.exports=(null==(s=n.g.process)?void 0:s.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,s,i=e.exports={};function a(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(e){n=r}}();var o=[],c=!1,d=-1;function u(){c&&s&&(c=!1,s.length?o=s.concat(o):d=-1,o.length&&m())}function m(){if(!c){var e=l(u);c=!0;for(var t=o.length;t;){for(s=o,o=[];++d<t;)s&&s[d].run();d=-1,t=o.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function x(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new h(e,t)),1!==o.length||c||l(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=x,i.addListener=x,i.once=x,i.off=x,i.removeListener=x,i.removeAllListeners=x,i.emit=x,i.prependListener=x,i.prependOnceListener=x,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}},r=!0;try{t[e](a,a.exports,s),r=!1}finally{r&&delete n[e]}return a.exports}s.ab="//";var i=s(229);e.exports=i}()},4839:function(e,t,n){"use strict";t.Z=function(){for(var e,t,n=0,s="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=function e(t){var n,s,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t){if(Array.isArray(t)){var a=t.length;for(n=0;n<a;n++)t[n]&&(s=e(t[n]))&&(i&&(i+=" "),i+=s)}else for(s in t)t[s]&&(i&&(i+=" "),i+=s)}return i}(e))&&(s&&(s+=" "),s+=t);return s}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=2169)}),_N_E=e.O()}]);