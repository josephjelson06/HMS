"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6570],{5854:function(e,t,n){n.d(t,{n:function(){return a},E:function(){return l}});var s=n(7437),r=n(3301);function a(e){let{permission:t,children:n,fallback:a=null}=e,{permissions:l,loading:i}=(0,r.a)();return i?null:!function(e,t){if(e.includes(t))return!0;let n=t.split(":");for(let t of e){if("*"===t)return!0;let e=t.split(":");if(e.length===n.length){let t=!0;for(let s=0;s<e.length;s+=1)if("*"!==e[s]&&e[s]!==n[s]){t=!1;break}if(t)return!0}if(e.length<n.length&&"*"===e[e.length-1]&&e.slice(0,e.length-1).join(":")===n.slice(0,e.length-1).join(":"))return!0}return!1}(l,t)?(0,s.jsx)(s.Fragment,{children:a}):(0,s.jsx)(s.Fragment,{children:n})}function l(e){let{userType:t,children:n,fallback:a=null}=e,{user:l,loading:i}=(0,r.a)();return i?null:l&&l.user_type===t?(0,s.jsx)(s.Fragment,{children:n}):(0,s.jsx)("div",{className:"auth-layout",children:(0,s.jsxs)("div",{className:"glass-card auth-card",children:[(0,s.jsx)("h2",{className:"text-2xl",children:"Access denied"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"You do not have access to this workspace."}),a]})})}},5528:function(e,t,n){n.d(t,{B:function(){return N}});var s=n(7437),r=n(7138),a=n(6463),l=n(2265),i=n(2145),o=n(4862),c=n(4024),u=n(6430),d=n(7606),m=n(7282),h=n(5427),p=n(7032),f=n(7868),x=n(6243),g=n(6205),v=n(8802);let j=["read","create","update","delete","export","start","stop"],y={read:"View",create:"Add",update:"Edit",delete:"Delete",export:"Export",start:"Start",stop:"Stop"},S={name:"",display_name:"",description:""};function b(e){return e.replace(/[_-]/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase())}function N(e){let{scope:t,roleId:n}=e,N=(0,a.useRouter)(),w=(0,l.useMemo)(()=>"admin"===t?{listPermissions:g.S.permissions,getRole:g.S.get,createRole:g.S.create,updateRole:g.S.update,listPath:"/admin/roles"}:{listPermissions:v.X.permissions,getRole:v.X.get,createRole:v.X.create,updateRole:v.X.update,listPath:"/hotel/roles"},[t]),[C,E]=(0,l.useState)(S),[k,P]=(0,l.useState)([]),[R,T]=(0,l.useState)([]),[_,O]=(0,l.useState)(null),[Z,A]=(0,l.useState)(!0),[D,F]=(0,l.useState)(!1),[M,q]=(0,l.useState)(null),I=!!n,J=!!(null==_?void 0:_.is_system),U=(0,l.useCallback)(async()=>{A(!0),q(null);try{let t=await w.listPermissions();if(T(t),n){var e;let t=await w.getRole(n);O(t),E({name:t.name,display_name:t.display_name,description:null!==(e=t.description)&&void 0!==e?e:""}),P(t.permissions)}}catch(e){q(e instanceof Error?e.message:"Failed to load role form")}finally{A(!1)}},[w,n]);(0,l.useEffect)(()=>{U()},[U]);let X=(0,l.useMemo)(()=>{let e=new Map,t=[];for(let s of R){var n;if(s.code.includes("*"))continue;let{resource:r,action:a}=function(e){let t=e.code.split(":");return{resource:e.resource||t[1]||"general",action:e.action||t[2]||"read"}}(s);"*"!==r&&"*"!==a&&(e.has(r)||e.set(r,new Map),null===(n=e.get(r))||void 0===n||n.set(a,s),t.push(a))}let s=function(e){let t=Array.from(new Set(e));return t.sort((e,t)=>{let n=j.indexOf(e),s=j.indexOf(t);return n>=0&&s>=0?n-s:n>=0?-1:s>=0?1:e.localeCompare(t)}),t}(t),r=Array.from(e.entries()).map(e=>{let[t,n]=e;return{resource:t,permissions:s.map(e=>{var t;return{action:e,permission:null!==(t=n.get(e))&&void 0!==t?t:null}})}});return{actions:s,rows:r}},[R]),L=(0,l.useMemo)(()=>new Set(k),[k]),B=e=>{J||P(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},H=e=>{let t=X.rows.find(t=>t.resource===e);if(!t)return{allSelected:!1,codes:[]};let n=t.permissions.filter(e=>e.permission).map(e=>e.permission.code);return{allSelected:n.length>0&&n.every(e=>L.has(e)),codes:n}},z=e=>{J||P(t=>{let n=new Set(t),s=X.rows.find(t=>t.resource===e);if(!s)return t;let r=s.permissions.filter(e=>e.permission).map(e=>e.permission.code);return r.length>0&&r.every(e=>n.has(e))?r.forEach(e=>n.delete(e)):r.forEach(e=>n.add(e)),Array.from(n)})},G=async e=>{if(e.preventDefault(),!J){F(!0),q(null);try{let e={name:C.name.trim(),display_name:C.display_name.trim(),description:C.description.trim()||void 0,permissions:k};I&&n?await w.updateRole(n,e):await w.createRole(e),N.push(w.listPath),N.refresh()}catch(e){q(e instanceof Error?e.message:"Failed to save role")}finally{F(!1)}}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(i.m,{title:I?"Edit Role":"Create New Role",description:"Configure role details and permission matrix.",rightSlot:(0,s.jsx)(r.default,{href:w.listPath,className:"ui-btn ui-btn-secondary ui-btn-sm ui-anim",children:"Back to Roles"})}),Z?(0,s.jsx)(c.o,{tone:"info",message:"Loading role editor..."}):(0,s.jsxs)("form",{className:"space-y-6",onSubmit:G,children:[(0,s.jsxs)(o.y,{title:"Role Details",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsx)(p.g,{label:"Role Name",required:!0,children:(0,s.jsx)(x.o,{value:C.name,onChange:e=>E(t=>({...t,name:e.target.value})),placeholder:"admin"===t?"operations-manager":"front-desk",required:!0,disabled:J})}),(0,s.jsx)(p.g,{label:"Display Name",required:!0,children:(0,s.jsx)(x.o,{value:C.display_name,onChange:e=>E(t=>({...t,display_name:e.target.value})),placeholder:"admin"===t?"Operations Manager":"Front Desk",required:!0,disabled:J})}),(0,s.jsx)(p.g,{label:"Description",className:"md:col-span-2",children:(0,s.jsx)(f.F,{value:C.description,onChange:e=>E(t=>({...t,description:e.target.value})),rows:3,placeholder:"Describe what this role is responsible for.",disabled:J})})]}),J?(0,s.jsx)(c.o,{tone:"warning",message:"System roles are read-only and cannot be modified.",className:"mt-3"}):null]}),(0,s.jsx)(d.q,{title:"Permission Matrix",actions:(0,s.jsxs)(m.C,{variant:"neutral",children:[k.length," selected"]}),children:0===X.rows.length?(0,s.jsx)(c.o,{tone:"info",message:"No permissions available."}):(0,s.jsx)(u.K,{children:(0,s.jsxs)("table",{className:"ui-table min-w-[760px]",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"pb-3",children:"Module"}),(0,s.jsx)("th",{className:"pb-3",children:"Select All"}),X.actions.map(e=>{var t;return(0,s.jsx)("th",{className:"pb-3",children:null!==(t=y[e])&&void 0!==t?t:b(e)},e)})]})}),(0,s.jsx)("tbody",{children:X.rows.map(e=>{let t=H(e.resource);return(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"py-3",children:[(0,s.jsx)("p",{className:"font-medium",children:b(e.resource)}),(0,s.jsx)("p",{className:"text-xs text-[color:var(--color-text-muted)]",children:e.resource})]}),(0,s.jsx)("td",{className:"py-3",children:(0,s.jsx)("input",{type:"checkbox",checked:t.allSelected,onChange:()=>z(e.resource),disabled:J||0===t.codes.length})}),e.permissions.map(t=>(0,s.jsx)("td",{className:"py-3",children:t.permission?(0,s.jsx)("input",{type:"checkbox",checked:L.has(t.permission.code),onChange:()=>B(t.permission.code),disabled:J,title:t.permission.code}):(0,s.jsx)("span",{className:"text-[color:var(--color-text-muted)]",children:"-"})},"".concat(e.resource,"-").concat(t.action)))]},e.resource)})})]})})}),M?(0,s.jsx)(c.o,{tone:"error",message:M}):null,(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsx)(h.z,{type:"submit",variant:"primary",disabled:D||J,children:D?"Saving...":"Save Role"}),(0,s.jsx)(r.default,{href:w.listPath,className:"ui-btn ui-btn-secondary ui-btn-md ui-anim",children:"Cancel"})]})]})]})}},2145:function(e,t,n){n.d(t,{m:function(){return l}});var s=n(7437),r=n(4839),a=n(7282);function l(e){let{title:t,description:n,rightSlot:l,count:i,countLabel:o,className:c}=e;return(0,s.jsxs)("div",{className:(0,r.Z)("ui-page-header",c),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"ui-page-title",children:t}),n?(0,s.jsx)("p",{className:"ui-page-subtitle",children:n}):null]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["number"==typeof i?(0,s.jsxs)(a.C,{variant:"accent",children:[i,o?" ".concat(o):""]}):null,l]})]})}},1288:function(e,t,n){n.d(t,{H:function(){return o},E:function(){return c}});var s=n(7437),r=n(2265),a=n(5139);let l={login:(e,t)=>(0,a.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})}),refresh:()=>(0,a.S)("/auth/refresh",{method:"POST"}),logout:()=>(0,a.S)("/auth/logout",{method:"POST"}),me:()=>(0,a.S)("/auth/me"),startImpersonation:e=>(0,a.S)("/auth/impersonation/start",{method:"POST",body:JSON.stringify(e)}),stopImpersonation:()=>(0,a.S)("/auth/impersonation/stop",{method:"POST"})},i=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[n,a]=(0,r.useState)(null),[o,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(!0),x=(0,r.useCallback)(e=>{var t,n;a(e.user),c(e.permissions),d(null!==(t=e.tenant)&&void 0!==t?t:null),h(null!==(n=e.impersonation)&&void 0!==n?n:null)},[]),g=(0,r.useCallback)(async()=>{try{let e=await l.me();x(e)}catch(e){try{let e=await l.refresh();x(e)}catch(e){a(null),c([]),d(null),h(null)}}finally{f(!1)}},[x]);(0,r.useEffect)(()=>{g()},[g]);let v=(0,r.useCallback)(async(e,t)=>{let n=await l.login(e,t);return x(n),n},[x]),j=(0,r.useCallback)(async()=>{await l.logout(),a(null),c([]),d(null),h(null)},[]),y=(0,r.useCallback)(async()=>{x(await l.refresh())},[x]),S=(0,r.useCallback)(async e=>{let t=await l.startImpersonation(e);return x(t),t},[x]),b=(0,r.useCallback)(async()=>{let e=await l.stopImpersonation();return x(e),e},[x]),N=(0,r.useMemo)(()=>({user:n,permissions:o,tenant:u,impersonation:m,loading:p,login:v,logout:j,refresh:y,startImpersonation:S,stopImpersonation:b}),[n,o,u,m,p,v,j,y,S,b]);return(0,s.jsx)(i.Provider,{value:N,children:t})}function c(){let e=(0,r.useContext)(i);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},4862:function(e,t,n){n.d(t,{y:function(){return a}});var s=n(7437),r=n(7606);function a(e){let{title:t,children:n}=e;return(0,s.jsx)(r.q,{title:t,children:n})}},4024:function(e,t,n){n.d(t,{o:function(){return a}});var s=n(7437),r=n(4839);function a(e){let{tone:t="info",message:n,className:a}=e;return(0,s.jsx)("p",{className:(0,r.Z)("ui-inline-alert","ui-inline-alert-".concat(t),a),children:n})}},6430:function(e,t,n){n.d(t,{K:function(){return a}});var s=n(7437),r=n(4839);function a(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("ui-table-wrap",n),children:t})}},7606:function(e,t,n){n.d(t,{q:function(){return l}});var s=n(7437),r=n(4839),a=n(4631);function l(e){let{title:t,actions:n,children:l,className:i}=e;return(0,s.jsxs)(a.W,{className:(0,r.Z)("p-6 ui-reveal",i),children:[(t||n)&&(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t?(0,s.jsx)("h3",{className:"text-lg",children:t}):(0,s.jsx)("span",{}),n]}),(0,s.jsx)("div",{className:(0,r.Z)((t||n)&&"mt-4"),children:l})]})}},4631:function(e,t,n){n.d(t,{W:function(){return a}});var s=n(7437),r=n(4839);function a(e){let{children:t,className:n}=e;return(0,s.jsx)("div",{className:(0,r.Z)("glass-card",n),children:t})}},7282:function(e,t,n){n.d(t,{C:function(){return a}});var s=n(7437),r=n(4839);function a(e){let{variant:t="accent",className:n,children:a,...l}=e;return(0,s.jsx)("span",{className:(0,r.Z)("badge","badge-".concat(t),n),...l,children:a})}},5427:function(e,t,n){n.d(t,{z:function(){return a}});var s=n(7437),r=n(4839);function a(e){let{className:t,variant:n="secondary",size:a="md",children:l,...i}=e;return(0,s.jsx)("button",{className:(0,r.Z)("ui-btn ui-anim","ui-btn-".concat(n),"sm"===a&&"ui-btn-sm","md"===a&&"ui-btn-md","lg"===a&&"ui-btn-lg",t),...i,children:l})}},7032:function(e,t,n){n.d(t,{g:function(){return a}});var s=n(7437),r=n(4839);function a(e){let{label:t,required:n,hint:a,error:l,className:i,children:o}=e;return(0,s.jsxs)("div",{className:(0,r.Z)("space-y-2",i),children:[(0,s.jsxs)("label",{className:"text-sm",children:[t,n&&(0,s.jsx)("span",{className:"ml-1 text-[color:var(--color-accent)]",children:"*"})]}),o,l?(0,s.jsx)("p",{className:"text-xs text-red-400",children:l}):a?(0,s.jsx)("p",{className:"text-xs text-[color:var(--color-text-muted)]",children:a}):null]})}},6243:function(e,t,n){n.d(t,{o:function(){return a}});var s=n(7437),r=n(4839);function a(e){let{className:t,...n}=e;return(0,s.jsx)("input",{className:(0,r.Z)("ui-input",t),...n})}},7868:function(e,t,n){n.d(t,{F:function(){return a}});var s=n(7437),r=n(4839);function a(e){let{className:t,...n}=e;return(0,s.jsx)("textarea",{className:(0,r.Z)("ui-textarea",t),...n})}},6205:function(e,t,n){n.d(t,{S:function(){return r}});var s=n(5139);let r={list:()=>(0,s.S)("/admin/roles"),get:e=>(0,s.S)("/admin/roles/".concat(e)),create:e=>(0,s.S)("/admin/roles",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,s.S)("/admin/roles/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,s.S)("/admin/roles/".concat(e),{method:"DELETE"}),permissions:()=>(0,s.S)("/admin/roles/permissions")}},5139:function(e,t,n){var s;n.d(t,{S:function(){return a}});let r=null!==(s=n(357).env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8000/api";async function a(e){var t,n,s;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l="".concat(r).concat(e),i=new Headers(null!==(n=a.headers)&&void 0!==n?n:{}),o=null!==(s=null===(t=a.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==s?s:"GET";if("GET"!==o&&"HEAD"!==o){let e=function(){if("undefined"==typeof document)return null;let e=document.cookie.match(/csrf_token=([^;]+)/);return e?decodeURIComponent(e[1]):null}();e&&i.set("X-CSRF-Token",e),i.has("Content-Type")||i.set("Content-Type","application/json")}let c=await fetch(l,{...a,headers:i,credentials:"include"});if(!c.ok)throw Error(await c.text()||c.statusText);if(204===c.status)return;let u=await c.text();if(u)return JSON.parse(u)}},8802:function(e,t,n){n.d(t,{X:function(){return r}});var s=n(5139);let r={list:()=>(0,s.S)("/hotel/roles"),get:e=>(0,s.S)("/hotel/roles/".concat(e)),create:e=>(0,s.S)("/hotel/roles",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>(0,s.S)("/hotel/roles/".concat(e),{method:"PUT",body:JSON.stringify(t)}),remove:e=>(0,s.S)("/hotel/roles/".concat(e),{method:"DELETE"}),permissions:()=>(0,s.S)("/hotel/roles/permissions")}},3301:function(e,t,n){n.d(t,{a:function(){return r}});var s=n(1288);function r(){return(0,s.E)()}},6463:function(e,t,n){var s=n(1169);n.o(s,"useParams")&&n.d(t,{useParams:function(){return s.useParams}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})}}]);