"use strict";exports.id=896,exports.ids=[896],exports.modules={896:(e,s,t)=>{t.d(s,{B:()=>S});var r=t(326),a=t(434),i=t(5047),l=t(7577),n=t(4863),o=t(6126),d=t(6062),c=t(6184),m=t(4612),u=t(3118),p=t(7759),h=t(7118),x=t(4909),f=t(5495),j=t(6799),g=t(2116);let v=["read","create","update","delete","export","start","stop"],b={read:"View",create:"Add",update:"Edit",delete:"Delete",export:"Export",start:"Start",stop:"Stop"},y={name:"",display_name:"",description:""};function N(e){return e.replace(/[_-]/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase())}function S({scope:e,roleId:s}){let t=(0,i.useRouter)(),S=(0,l.useMemo)(()=>"admin"===e?{listPermissions:j.S.permissions,getRole:j.S.get,createRole:j.S.create,updateRole:j.S.update,listPath:"/admin/roles"}:{listPermissions:g.X.permissions,getRole:g.X.get,createRole:g.X.create,updateRole:g.X.update,listPath:"/hotel/roles"},[e]),[w,R]=(0,l.useState)(y),[C,E]=(0,l.useState)([]),[P,$]=(0,l.useState)([]),[Z,D]=(0,l.useState)(null),[O,_]=(0,l.useState)(!0),[k,M]=(0,l.useState)(!1),[q,T]=(0,l.useState)(null),A=!!s,F=!!Z?.is_system;(0,l.useCallback)(async()=>{_(!0),T(null);try{let e=await S.listPermissions();if($(e),s){let e=await S.getRole(s);D(e),R({name:e.name,display_name:e.display_name,description:e.description??""}),E(e.permissions)}}catch(e){T(e instanceof Error?e.message:"Failed to load role form")}finally{_(!1)}},[S,s]);let X=(0,l.useMemo)(()=>{let e=new Map,s=[];for(let t of P){if(t.code.includes("*"))continue;let{resource:r,action:a}=function(e){let s=e.code.split(":");return{resource:e.resource||s[1]||"general",action:e.action||s[2]||"read"}}(t);"*"!==r&&"*"!==a&&(e.has(r)||e.set(r,new Map),e.get(r)?.set(a,t),s.push(a))}let t=function(e){let s=Array.from(new Set(e));return s.sort((e,s)=>{let t=v.indexOf(e),r=v.indexOf(s);return t>=0&&r>=0?t-r:t>=0?-1:r>=0?1:e.localeCompare(s)}),s}(s),r=Array.from(e.entries()).map(([e,s])=>({resource:e,permissions:t.map(e=>({action:e,permission:s.get(e)??null}))}));return{actions:t,rows:r}},[P]),J=(0,l.useMemo)(()=>new Set(C),[C]),L=e=>{F||E(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},U=e=>{let s=X.rows.find(s=>s.resource===e);if(!s)return{allSelected:!1,codes:[]};let t=s.permissions.filter(e=>e.permission).map(e=>e.permission.code);return{allSelected:t.length>0&&t.every(e=>J.has(e)),codes:t}},z=e=>{F||E(s=>{let t=new Set(s),r=X.rows.find(s=>s.resource===e);if(!r)return s;let a=r.permissions.filter(e=>e.permission).map(e=>e.permission.code);return a.length>0&&a.every(e=>t.has(e))?a.forEach(e=>t.delete(e)):a.forEach(e=>t.add(e)),Array.from(t)})},B=async e=>{if(e.preventDefault(),!F){M(!0),T(null);try{let e={name:w.name.trim(),display_name:w.display_name.trim(),description:w.description.trim()||void 0,permissions:C};A&&s?await S.updateRole(s,e):await S.createRole(e),t.push(S.listPath),t.refresh()}catch(e){T(e instanceof Error?e.message:"Failed to save role")}finally{M(!1)}}};return(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx(n.m,{title:A?"Edit Role":"Create New Role",description:"Configure role details and permission matrix.",rightSlot:r.jsx(a.default,{href:S.listPath,className:"ui-btn ui-btn-secondary ui-btn-sm ui-anim",children:"Back to Roles"})}),O?r.jsx(d.o,{tone:"info",message:"Loading role editor..."}):(0,r.jsxs)("form",{className:"space-y-6",onSubmit:B,children:[(0,r.jsxs)(o.y,{title:"Role Details",children:[(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[r.jsx(h.g,{label:"Role Name",required:!0,children:r.jsx(f.o,{value:w.name,onChange:e=>R(s=>({...s,name:e.target.value})),placeholder:"admin"===e?"operations-manager":"front-desk",required:!0,disabled:F})}),r.jsx(h.g,{label:"Display Name",required:!0,children:r.jsx(f.o,{value:w.display_name,onChange:e=>R(s=>({...s,display_name:e.target.value})),placeholder:"admin"===e?"Operations Manager":"Front Desk",required:!0,disabled:F})}),r.jsx(h.g,{label:"Description",className:"md:col-span-2",children:r.jsx(x.F,{value:w.description,onChange:e=>R(s=>({...s,description:e.target.value})),rows:3,placeholder:"Describe what this role is responsible for.",disabled:F})})]}),F?r.jsx(d.o,{tone:"warning",message:"System roles are read-only and cannot be modified.",className:"mt-3"}):null]}),r.jsx(m.q,{title:"Permission Matrix",actions:(0,r.jsxs)(u.C,{variant:"neutral",children:[C.length," selected"]}),children:0===X.rows.length?r.jsx(d.o,{tone:"info",message:"No permissions available."}):r.jsx(c.K,{children:(0,r.jsxs)("table",{className:"ui-table min-w-[760px]",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"pb-3",children:"Module"}),r.jsx("th",{className:"pb-3",children:"Select All"}),X.actions.map(e=>r.jsx("th",{className:"pb-3",children:b[e]??N(e)},e))]})}),r.jsx("tbody",{children:X.rows.map(e=>{let s=U(e.resource);return(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{className:"py-3",children:[r.jsx("p",{className:"font-medium",children:N(e.resource)}),r.jsx("p",{className:"text-xs text-[color:var(--color-text-muted)]",children:e.resource})]}),r.jsx("td",{className:"py-3",children:r.jsx("input",{type:"checkbox",checked:s.allSelected,onChange:()=>z(e.resource),disabled:F||0===s.codes.length})}),e.permissions.map(s=>r.jsx("td",{className:"py-3",children:s.permission?r.jsx("input",{type:"checkbox",checked:J.has(s.permission.code),onChange:()=>L(s.permission.code),disabled:F,title:s.permission.code}):r.jsx("span",{className:"text-[color:var(--color-text-muted)]",children:"-"})},`${e.resource}-${s.action}`))]},e.resource)})})]})})}),q?r.jsx(d.o,{tone:"error",message:q}):null,(0,r.jsxs)("div",{className:"flex flex-wrap gap-3",children:[r.jsx(p.z,{type:"submit",variant:"primary",disabled:k||F,children:k?"Saving...":"Save Role"}),r.jsx(a.default,{href:S.listPath,className:"ui-btn ui-btn-secondary ui-btn-md ui-anim",children:"Cancel"})]})]})]})}},4863:(e,s,t)=>{t.d(s,{m:()=>l});var r=t(326),a=t(1135),i=t(3118);function l({title:e,description:s,rightSlot:t,count:l,countLabel:n,className:o}){return(0,r.jsxs)("div",{className:(0,a.Z)("ui-page-header",o),children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"ui-page-title",children:e}),s?r.jsx("p",{className:"ui-page-subtitle",children:s}):null]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:["number"==typeof l?(0,r.jsxs)(i.C,{variant:"accent",children:[l,n?` ${n}`:""]}):null,t]})]})}},6126:(e,s,t)=>{t.d(s,{y:()=>i});var r=t(326),a=t(4612);function i({title:e,children:s}){return r.jsx(a.q,{title:e,children:s})}},6062:(e,s,t)=>{t.d(s,{o:()=>i});var r=t(326),a=t(1135);function i({tone:e="info",message:s,className:t}){return r.jsx("p",{className:(0,a.Z)("ui-inline-alert",`ui-inline-alert-${e}`,t),children:s})}},6184:(e,s,t)=>{t.d(s,{K:()=>i});var r=t(326),a=t(1135);function i({children:e,className:s}){return r.jsx("div",{className:(0,a.Z)("ui-table-wrap",s),children:e})}},4612:(e,s,t)=>{t.d(s,{q:()=>l});var r=t(326),a=t(1135),i=t(5430);function l({title:e,actions:s,children:t,className:l}){return(0,r.jsxs)(i.W,{className:(0,a.Z)("p-6 ui-reveal",l),children:[(e||s)&&(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e?r.jsx("h3",{className:"text-lg",children:e}):r.jsx("span",{}),s]}),r.jsx("div",{className:(0,a.Z)((e||s)&&"mt-4"),children:t})]})}},5430:(e,s,t)=>{t.d(s,{W:()=>i});var r=t(326),a=t(1135);function i({children:e,className:s}){return r.jsx("div",{className:(0,a.Z)("glass-card",s),children:e})}},3118:(e,s,t)=>{t.d(s,{C:()=>i});var r=t(326),a=t(1135);function i({variant:e="accent",className:s,children:t,...i}){return r.jsx("span",{className:(0,a.Z)("badge",`badge-${e}`,s),...i,children:t})}},7759:(e,s,t)=>{t.d(s,{z:()=>i});var r=t(326),a=t(1135);function i({className:e,variant:s="secondary",size:t="md",children:i,...l}){return r.jsx("button",{className:(0,a.Z)("ui-btn ui-anim",`ui-btn-${s}`,"sm"===t&&"ui-btn-sm","md"===t&&"ui-btn-md","lg"===t&&"ui-btn-lg",e),...l,children:i})}},7118:(e,s,t)=>{t.d(s,{g:()=>i});var r=t(326),a=t(1135);function i({label:e,required:s,hint:t,error:i,className:l,children:n}){return(0,r.jsxs)("div",{className:(0,a.Z)("space-y-2",l),children:[(0,r.jsxs)("label",{className:"text-sm",children:[e,s&&r.jsx("span",{className:"ml-1 text-[color:var(--color-accent)]",children:"*"})]}),n,i?r.jsx("p",{className:"text-xs text-red-400",children:i}):t?r.jsx("p",{className:"text-xs text-[color:var(--color-text-muted)]",children:t}):null]})}},5495:(e,s,t)=>{t.d(s,{o:()=>i});var r=t(326),a=t(1135);function i({className:e,...s}){return r.jsx("input",{className:(0,a.Z)("ui-input",e),...s})}},4909:(e,s,t)=>{t.d(s,{F:()=>i});var r=t(326),a=t(1135);function i({className:e,...s}){return r.jsx("textarea",{className:(0,a.Z)("ui-textarea",e),...s})}},6799:(e,s,t)=>{t.d(s,{S:()=>a});var r=t(9684);let a={list:()=>(0,r.S)("/admin/roles"),get:e=>(0,r.S)(`/admin/roles/${e}`),create:e=>(0,r.S)("/admin/roles",{method:"POST",body:JSON.stringify(e)}),update:(e,s)=>(0,r.S)(`/admin/roles/${e}`,{method:"PUT",body:JSON.stringify(s)}),remove:e=>(0,r.S)(`/admin/roles/${e}`,{method:"DELETE"}),permissions:()=>(0,r.S)("/admin/roles/permissions")}},2116:(e,s,t)=>{t.d(s,{X:()=>a});var r=t(9684);let a={list:()=>(0,r.S)("/hotel/roles"),get:e=>(0,r.S)(`/hotel/roles/${e}`),create:e=>(0,r.S)("/hotel/roles",{method:"POST",body:JSON.stringify(e)}),update:(e,s)=>(0,r.S)(`/hotel/roles/${e}`,{method:"PUT",body:JSON.stringify(s)}),remove:e=>(0,r.S)(`/hotel/roles/${e}`,{method:"DELETE"}),permissions:()=>(0,r.S)("/hotel/roles/permissions")}}};